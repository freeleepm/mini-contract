<script>
import { 
  getTemplateList, 
  getFrequentlyUsedTemplates,
  getHotTemplates,
  recordTemplateUsage,
  getTemplateCategories
} from '../../api/templates/index';
import type { Template, TemplateCategory, TemplateListParams } from '../../api/templates/index';
import { getSealToken } from '../../utils/sealTokenManager';

export default {
  data() {
    return {
      // æ¨¡æ¿åˆ—è¡¨
      templateList: [] as Template[],
      // å¸¸ç”¨æ¨¡æ¿
      frequentTemplates: [] as Template[],
      // çƒ­é—¨æ¨¡æ¿
      hotTemplates: [] as Template[],
      // åˆ†ç±»åˆ—è¡¨ï¼ˆä»æ•°æ®åº“åŠ¨æ€åŠ è½½ï¼‰
      categories: [] as Array<{ id: string; name: string; icon: string; code: string; templateCount?: number }>,
      // å½“å‰é€‰ä¸­çš„åˆ†ç±»
      currentCategory: 'all' as TemplateCategory,
      // æœç´¢å…³é”®å­—
      searchText: '',
      // åŠ è½½çŠ¶æ€
      isLoading: false,
      // åˆ†é¡µ
      page: 1,
      pageSize: 10,
      hasMore: true,
      // æç¤ºæ–‡æœ¬
      loadingText: 'åŠ è½½ä¸­...'
    }
  },
  async onLoad() {
    // ğŸ”§ å…³é”®ä¿®å¤ï¼šå…ˆç¡®ä¿ sealToken å­˜åœ¨ä¸”æœ‰æ•ˆï¼Œå†å‘èµ·APIè¯·æ±‚
    // å‚è€ƒ PC ç«¯ SealTokenManager å®ç°ï¼šæ£€æŸ¥ç¼“å­˜ã€éªŒè¯æœ‰æ•ˆæœŸã€è‡ªåŠ¨åˆ·æ–°
    try {
      await getSealToken();
      console.log('[æ¨¡æ¿å¸‚åœº] âœ… sealToken å·²å°±ç»ªï¼Œå¼€å§‹åŠ è½½æ•°æ®');
    } catch (error) {
      console.error('[æ¨¡æ¿å¸‚åœº] âŒ sealToken è·å–å¤±è´¥:', error);
      uni.showToast({
        title: 'è¯·å…ˆç™»å½•',
        icon: 'none'
      });
      return;
    }
    
    // å¹¶è¡ŒåŠ è½½åˆ†ç±»åˆ—è¡¨ã€å¸¸ç”¨ã€çƒ­é—¨ã€åˆ†ç±»æ¨¡æ¿
    this.loadCategories();
    this.loadFrequentTemplates();
    this.loadHotTemplates();
    this.loadTemplates(true);
  },
  onPullDownRefresh() {
    // ä¸‹æ‹‰åˆ·æ–°
    this.refreshList();
  },
  onReachBottom() {
    // ä¸Šæ‹‰åŠ è½½æ›´å¤š
    if (this.hasMore && !this.isLoading) {
      this.loadMoreTemplates();
    }
  },
  methods: {
    // æ–°å¢ï¼šåŠ è½½å¸¸ç”¨æ¨¡æ¿
    async loadFrequentTemplates(): Promise<void> {
      try {
        const result = await getFrequentlyUsedTemplates(8);
        this.frequentTemplates = result || [];
        console.log('å¸¸ç”¨æ¨¡æ¿åŠ è½½æˆåŠŸ:', this.frequentTemplates.length);
      } catch (error) {
        console.error('åŠ è½½å¸¸ç”¨æ¨¡æ¿å¤±è´¥:', error);
        // å¤±è´¥æ—¶ä¸å½±å“å…¶ä»–åŠŸèƒ½
      }
    },
    
    // æ–°å¢ï¼šåŠ è½½çƒ­é—¨æ¨¡æ¿
    async loadHotTemplates(): Promise<void> {
      try {
        const result = await getHotTemplates(6);
        this.hotTemplates = result || [];
        console.log('çƒ­é—¨æ¨¡æ¿åŠ è½½æˆåŠŸ:', this.hotTemplates.length);
      } catch (error) {
        console.error('åŠ è½½çƒ­é—¨æ¨¡æ¿å¤±è´¥:', error);
        // å¤±è´¥æ—¶ä¸å½±å“å…¶ä»–åŠŸèƒ½
      }
    },
    
    // æ–°å¢ï¼šåŠ è½½æ¨¡æ¿åˆ†ç±»åˆ—è¡¨
    async loadCategories(): Promise<void> {
      try {
        const result = await getTemplateCategories();
        
        // å›¾æ ‡æ˜ å°„ï¼šæ ¹æ®åˆ†ç±»codeæ˜ å°„åˆ°å¯¹åº”çš„icon class
        const iconMap: Record<string, string> = {
          'employment': 'icon-user',        // åŠ³åŠ¨åˆåŒ
          'lease': 'icon-building',         // ç§ŸèµåˆåŒ
          'purchase': 'icon-package',       // é‡‡è´­åˆåŒ
          'sales': 'icon-chart-line',       // é”€å”®åˆåŒ
          'service': 'icon-settings',       // æœåŠ¡åˆåŒ
          'agency': 'icon-user-check',      // ä»£ç†åˆåŒ
          'cooperation': 'icon-users',      // åˆä½œåˆåŒ
          'confidentiality': 'icon-shield', // ä¿å¯†åè®®
          'authorization': 'icon-key',      // æˆæƒä¹¦
          'other': 'icon-file'              // å…¶ä»–
        };
        
        // è½¬æ¢åˆ†ç±»æ•°æ®ï¼Œæ·»åŠ å›¾æ ‡
        const categories = (result || []).map((item: any) => ({
          id: item.code,  // ä½¿ç”¨codeä½œä¸ºid
          name: item.name,
          icon: iconMap[item.code] || 'icon-file',  // ä½¿ç”¨æ˜ å°„çš„å›¾æ ‡ï¼Œé»˜è®¤ä¸ºfileå›¾æ ‡
          code: item.code,
          templateCount: item.templateCount || 0
        }));
        
        // åœ¨æœ€å‰é¢æ·»åŠ "å…¨éƒ¨"åˆ†ç±»
        this.categories = [
          { id: 'all', name: 'å…¨éƒ¨', icon: 'icon-file', code: 'all' },
          ...categories
        ];
        
        console.log('åˆ†ç±»åˆ—è¡¨åŠ è½½æˆåŠŸ:', this.categories.length);
      } catch (error) {
        console.error('åŠ è½½åˆ†ç±»åˆ—è¡¨å¤±è´¥:', error);
        // å¤±è´¥æ—¶ä½¿ç”¨é»˜è®¤çš„åˆ†ç±»åˆ—è¡¨
        this.categories = [
          { id: 'all', name: 'å…¨éƒ¨', icon: 'icon-file', code: 'all' }
        ];
      }
    },
    
    // é€‰æ‹©åˆ†ç±»
    selectCategory(category: string): void {
      if (this.currentCategory === category) {
        return;
      }
      
      this.currentCategory = category as TemplateCategory;
      this.refreshList();
    },
    
    
    // æœç´¢æ¨¡æ¿
    searchTemplates(): void {
      if (!this.searchText.trim()) {
        uni.showToast({
          title: 'è¯·è¾“å…¥æœç´¢å…³é”®è¯',
          icon: 'none'
        });
        return;
      }
      
      this.refreshList();
    },
    
    // åˆ·æ–°åˆ—è¡¨
    refreshList(): void {
      this.page = 1;
      this.templateList = [];
      this.hasMore = true;
      this.loadTemplates(true);
      
      // åœæ­¢ä¸‹æ‹‰åˆ·æ–°
      uni.stopPullDownRefresh();
    },
    
    // åŠ è½½æ›´å¤š
    loadMoreTemplates(): void {
      if (this.isLoading) return;
      
      this.page++;
      this.loadTemplates(false);
    },
    
    // åŠ è½½æ¨¡æ¿åˆ—è¡¨
    async loadTemplates(showLoading: boolean): Promise<void> {
      if (this.isLoading) return;
      
      this.isLoading = true;
      
      if (showLoading) {
        uni.showLoading({
          title: 'åŠ è½½ä¸­'
        });
      }
      
      try {
        // æ„å»ºè¯·æ±‚å‚æ•°
        const params: TemplateListParams = {
          category: this.currentCategory,
          keyword: this.searchText,
          page: this.page,
          pageSize: this.pageSize
        };
        
        console.log('åŠ è½½æ¨¡æ¿åˆ—è¡¨å‚æ•°:', params);
        
        // ä½¿ç”¨çœŸå®API
        const result = await getTemplateList(params);
        
        // è¿½åŠ æ•°æ®
        if (result.list && result.list.length > 0) {
          this.templateList = [...this.templateList, ...result.list];
        }
        
        // æ›´æ–°æ˜¯å¦æœ‰æ›´å¤šæ•°æ®
        this.hasMore = result.hasMore;
        
        // å¦‚æœæ²¡æœ‰æ›´å¤šæ•°æ®ä¸”åˆ—è¡¨ä¸ºç©ºï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€
        if (!this.hasMore && this.templateList.length === 0) {
          this.loadingText = 'æš‚æ— æ¨¡æ¿';
        }
        
      } catch (error) {
        console.error('åŠ è½½æ¨¡æ¿åˆ—è¡¨å¤±è´¥:', error);
        uni.showToast({
          title: 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•',
          icon: 'none'
        });
      } finally {
        this.isLoading = false;
        if (showLoading) {
          uni.hideLoading();
        }
      }
    },
    
    // æŸ¥çœ‹æ¨¡æ¿è¯¦æƒ…
    viewTemplateDetail(template: Template): void {
      // è®°å½•æ¨¡æ¿ä½¿ç”¨
      recordTemplateUsage(template.id).catch(err => {
        console.error('è®°å½•æ¨¡æ¿ä½¿ç”¨å¤±è´¥:', err);
      });
      
      // è·³è½¬åˆ°æ¨¡æ¿è¯¦æƒ…é¡µ
      uni.navigateTo({
        url: `/pages/template-detail/index?id=${template.id}`
      });
    },
    
    
    // è·å–åˆ†ç±»åç§°
    getCategoryName(categoryId: string): string {
      const category = this.categories.find(c => c.id === categoryId);
      return category ? category.name : categoryId;
    },
    
    // è·å–åˆ†ç±»é¢œè‰²
    getTypeColor(categoryId: string): string {
      const colorMap: Record<string, string> = {
        'loan': '#4A6FE3',
        'purchase': '#F56C6C',
        'employment': '#E6A23C',
        'lease': '#67C23A',
        'service': '#909399',
        'other': '#9254DE',
        'all': '#00C28A'
      };
      return colorMap[categoryId] || '#909399';
    },
    
    // è·å–åˆ†ç±»é¢œè‰²ï¼ˆåˆ«åæ–¹æ³•ï¼‰
    getCategoryColor(categoryId: string): string {
      return this.getTypeColor(categoryId);
    },
    
    // æ ¼å¼åŒ–æ•°å­—
    formatNumber(num: number): string {
      if (num >= 10000) {
        return (num / 10000).toFixed(1) + 'w';
      }
      return num.toString();
    },
    
    // æ ¼å¼åŒ–æ—¥æœŸ
    formatDate(dateStr: string): string {
      if (!dateStr) return '';
      
      const date = new Date(dateStr);
      const now = new Date();
      const diff = now.getTime() - date.getTime();
      
      // å°äº1å¤©
      if (diff < 86400000) {
        const hours = Math.floor(diff / 3600000);
        if (hours < 1) {
          const minutes = Math.floor(diff / 60000);
          return `${minutes}åˆ†é’Ÿå‰`;
        }
        return `${hours}å°æ—¶å‰`;
      }
      
      // å°äº7å¤©
      if (diff < 604800000) {
        const days = Math.floor(diff / 86400000);
        return `${days}å¤©å‰`;
      }
      
      // æ˜¾ç¤ºæ—¥æœŸ
      const month = date.getMonth() + 1;
      const day = date.getDate();
      return `${month}æœˆ${day}æ—¥`;
    }
  }
}
</script>
  
<template>
  <view class="page">
    <!-- æœç´¢æ  -->
    <view class="search-bar">
      <view class="search-input-box">
        <text class="icon icon-search search-icon"></text>
        <input
          class="search-input"
          type="text"
          v-model="searchText"
          placeholder="æœç´¢åˆåŒæ¨¡æ¿"
          placeholder-class="search-placeholder"
          confirm-type="search"
          @confirm="searchTemplates"
        />
        <text v-if="searchText" class="icon icon-clear clear-icon" @click="searchText = ''"></text>
        </view>
      <text class="search-btn" @click="searchTemplates">æœç´¢</text>
    </view>
    
    <!-- å†…å®¹åŒºåŸŸ -->
    <scroll-view 
      scroll-y="true" 
      class="content"
      enable-back-to-top="true"
      @scrolltolower="loadMoreTemplates"
    >
      <!-- å¸¸ç”¨æ¨¡æ¿ -->
      <view v-if="frequentTemplates.length > 0" class="section">
        <view class="section-header">
          <text class="section-title">å¸¸ç”¨æ¨¡æ¿</text>
          <text class="section-desc">ä¸ºæ‚¨æ¨èå¸¸ç”¨çš„åˆåŒæ¨¡æ¿</text>
        </view>
        <scroll-view scroll-x="true" class="frequent-scroll" show-scrollbar="false">
          <view class="frequent-list">
        <view
              v-for="(template, index) in frequentTemplates"
          :key="index"
              class="frequent-item"
          @click="viewTemplateDetail(template)"
        >
              <view class="frequent-icon" :style="{ backgroundColor: getTypeColor(template.category) + '20' }">
                <text class="icon icon-file" :style="{ color: getTypeColor(template.category) }"></text>
            </view>
              <text class="frequent-name">{{ template.name }}</text>
              <text class="frequent-count">{{ formatNumber(template.useCount || 0) }}æ¬¡</text>
        </view>
      </view>
    </scroll-view>
          </view>
          
      <!-- çƒ­é—¨æ¨¡æ¿ -->
      <view v-if="hotTemplates.length > 0" class="section">
        <view class="section-header">
          <text class="section-title">çƒ­é—¨æ¨è</text>
          <text class="section-desc">å¤§å®¶éƒ½åœ¨ç”¨çš„åˆåŒæ¨¡æ¿</text>
                </view>
        <view class="hot-grid">
        <view
            v-for="(template, index) in hotTemplates"
          :key="index"
            class="hot-item"
          @click="viewTemplateDetail(template)"
        >
            <view class="hot-header">
              <view class="hot-tag" :style="{ color: getTypeColor(template.category) }">
                {{ getCategoryName(template.category) }}
            </view>
              <text v-if="template.isHot" class="icon icon-fire hot-badge"></text>
              </view>
            <text class="hot-name">{{ template.name }}</text>
            <text class="hot-desc">{{ template.description }}</text>
            <view class="hot-footer">
              <text class="icon icon-chart hot-icon"></text>
              <text class="hot-count">{{ formatNumber(template.useCount || 0) }}æ¬¡ä½¿ç”¨</text>
            </view>
              </view>
            </view>
          </view>
          
      <!-- åˆ†ç±»é€‰æ‹© -->
      <view class="section category-section">
        <view class="section-header">
          <text class="section-title">é€‰æ‹©åˆ†ç±»</text>
          <text class="section-desc">å¿«é€ŸæŸ¥æ‰¾æ‚¨éœ€è¦çš„åˆåŒæ¨¡æ¿</text>
                </view>
        <view class="category-grid">
          <view
            v-for="(category, index) in categories"
            :key="index"
            class="category-card"
            :class="{ active: currentCategory === category.id }"
            @click="selectCategory(category.id)"
          >
            <view class="category-card-icon" :style="{ backgroundColor: getCategoryColor(category.id) }">
              <text :class="'icon ' + category.icon"></text>
                </view>
            <text class="category-card-name">{{ category.name }}</text>
              </view>
            </view>
          </view>
          
      <!-- å…¨éƒ¨æ¨¡æ¿ -->
      <view class="section">
        <view v-if="currentCategory !== 'all'" class="section-header">
          <text class="section-title">{{ getCategoryName(currentCategory) }}</text>
            </view>
          
        <view class="template-list">
          <view
            v-for="(template, index) in templateList"
            :key="index"
            class="template-item"
            @click="viewTemplateDetail(template)"
          >
            <view class="template-header">
              <view class="template-tag" :style="{ color: getTypeColor(template.category) }">
                {{ getCategoryName(template.category) }}
              </view>
              <view class="template-badges">
                <text v-if="template.isOfficial" class="badge official">å®˜æ–¹</text>
                <text v-if="template.isHot" class="badge hot">çƒ­é—¨</text>
              </view>
            </view>
            
            <text class="template-name">{{ template.name }}</text>
            <text class="template-desc">{{ template.description }}</text>
            
            <view class="template-footer">
              <view class="template-meta">
                <text class="icon icon-eye meta-icon"></text>
                <text class="meta-text">{{ formatNumber(template.useCount || 0) }}</text>
              </view>
              <text class="template-time">{{ formatDate(template.updateTime) }}</text>
            </view>
          </view>
        </view>
        
        <!-- ç©ºçŠ¶æ€ -->
        <view v-if="!isLoading && templateList.length === 0" class="empty">
          <text class="icon icon-empty empty-icon"></text>
          <text class="empty-text">æš‚æ— æ¨¡æ¿</text>
          <text class="empty-desc">è¯¥åˆ†ç±»ä¸‹æš‚æ— åˆåŒæ¨¡æ¿</text>
        </view>
        
        <!-- åŠ è½½ä¸­ -->
        <view v-if="isLoading" class="loading">
          <view class="loading-spinner"></view>
          <text class="loading-text">åŠ è½½ä¸­...</text>
        </view>
        
        <!-- åˆ°åº•äº† -->
        <view v-if="!isLoading && !hasMore && templateList.length > 0" class="bottom">
          <text class="bottom-text">å·²æ˜¾ç¤ºå…¨éƒ¨</text>
        </view>
      </view>
    </scroll-view>
  </view>
</template>
  
<style>
/* ========== é¡µé¢å®¹å™¨ ========== */
.page {
  flex: 1;
  background-color: #F7F8FA;
}

/* ========== å›¾æ ‡å­—ä½“ ========== */
/* å›¾æ ‡æ ·å¼å·²åœ¨å…¨å±€ App.uvue ä¸­é€šè¿‡ fontawesome.css å¼•å…¥ */
/* æ— éœ€åœ¨é¡µé¢å†…é‡å¤å®šä¹‰ï¼Œç›´æ¥ä½¿ç”¨å…¨å±€å›¾æ ‡ç±»å³å¯ */

.empty-icon {
  font-size: 120rpx;
  color: #DDDDDD;
}

.hot-badge {
  color: #FF6B6B;
  font-size: 28rpx;
}

.hot-icon {
  font-size: 24rpx;
  color: #999999;
}

.meta-icon {
  font-size: 24rpx;
  color: #999999;
}

/* ========== æœç´¢æ  ========== */
.search-bar {
  background-color: #FFFFFF;
  padding: 20rpx 32rpx;
  flex-direction: row;
  align-items: center;
  border-bottom: 1rpx solid #F0F0F0;
}

.search-input-box {
  flex: 1;
  height: 72rpx;
  background-color: #F7F8FA;
  border-radius: 36rpx;
  flex-direction: row;
  align-items: center;
  padding: 0 24rpx;
  margin-right: 20rpx;
}

.search-input {
  flex: 1;
  height: 72rpx;
  font-size: 28rpx;
  color: #1A1A1A;
  margin-left: 16rpx;
}

.search-icon {
  font-size: 28rpx;
  color: #999999;
}

.clear-icon {
  font-size: 32rpx;
  color: #CCCCCC;
}

.search-placeholder {
  color: #999999;
}

.search-btn {
  font-size: 28rpx;
  color: #00C28A;
  font-weight: 500;
}

/* ========== åˆ†ç±»é€‰æ‹©åŒºåŸŸ ========== */
.category-section {
  margin-top: 24rpx;
  padding-top: 4rpx; /* å¢åŠ é¡¶éƒ¨å†…è¾¹è·ï¼Œé¿å…ç¬¬ä¸€è¡Œé€‰ä¸­æ—¶ä¸Šè¾¹æ¡†è¢«é®æŒ¡ */
}

.category-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20rpx;
}

.category-card {
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24rpx 16rpx;
  background-color: #FFFFFF;
  border-radius: 12rpx;
  border: 2rpx solid #F0F0F0;
  transition-property: border-color, background-color, box-shadow;
  transition-duration: 0.2s;
  transition-timing-function: ease;
}

.category-card.active {
  background-color: #E6F7FF;
  border-color: #00C28A;
  box-shadow: 0 2rpx 12rpx rgba(0, 194, 138, 0.15); /* ç”¨é˜´å½±ä»£æ›¿transformï¼Œé¿å…ä¸Šè¾¹æ¡†è¢«é®æŒ¡ */
}

.category-card-icon {
  width: 64rpx;
  height: 64rpx;
  border-radius: 50%;
  align-items: center;
  justify-content: center;
  margin-bottom: 12rpx;
}

.category-card-icon .icon {
  font-size: 32rpx;
  color: #FFFFFF;
}

.category-card-name {
  font-size: 24rpx;
  color: #666666;
  text-align: center;
  font-weight: 500;
}

.category-card.active .category-card-name {
  color: #00C28A;
  font-weight: 600;
}

/* ========== å†…å®¹åŒºåŸŸ ========== */
.content {
  flex: 1;
}

/* ========== åŒºå—å®¹å™¨ ========== */
.section {
  margin-top: 24rpx;
  padding: 0 32rpx;
}

.section-header {
  margin-bottom: 24rpx;
}

.section-title {
  font-size: 32rpx;
  font-weight: 600;
  color: #1A1A1A;
  margin-bottom: 8rpx;
}

.section-desc {
  font-size: 24rpx;
  color: #999999;
}

/* ========== å¸¸ç”¨æ¨¡æ¿ ========== */
.frequent-scroll {
  height: 220rpx; /* å¢åŠ é«˜åº¦ä»¥å®¹çº³å®Œæ•´å†…å®¹ */
  width: 100%;
}

.frequent-list {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: row;
  padding-bottom: 16rpx; /* åªä¿ç•™åº•éƒ¨å†…è¾¹è·ï¼Œå·¦å³è¾¹è·ç”±çˆ¶å®¹å™¨ .section æä¾› */
  white-space: nowrap; /* é˜²æ­¢æ¢è¡Œ */
}

.frequent-item {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: column; /* å‚ç›´æ’åˆ— */
  width: 240rpx;
  min-height: 180rpx; /* ä½¿ç”¨ min-height æ›¿ä»£å›ºå®š height */
  background-color: #FFFFFF;
  border-radius: 16rpx;
  padding: 24rpx;
  margin-right: 16rpx;
  box-shadow: 0 2rpx 16rpx rgba(0, 0, 0, 0.04);
  flex-shrink: 0; /* é˜²æ­¢åœ¨æ¨ªå‘æ»šåŠ¨æ—¶è¢«å‹ç¼© */
}

.frequent-item:last-child {
  margin-right: 0; /* æœ€åä¸€ä¸ªä¸éœ€è¦å³è¾¹è· */
}

.frequent-icon {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  width: 80rpx;
  height: 80rpx;
  border-radius: 12rpx;
  align-items: center;
  justify-content: center;
  margin-bottom: 16rpx;
}

.frequent-name {
  font-size: 26rpx;
  color: #1A1A1A;
  font-weight: 500;
  margin-bottom: 8rpx;
  lines: 2; /* æ”¹ä¸º2è¡Œæ˜¾ç¤º */
  text-overflow: ellipsis;
  overflow: hidden;
  word-break: break-all; /* å…è®¸å•è¯å†…æ¢è¡Œ */
  line-height: 1.4; /* æ·»åŠ è¡Œé«˜ä»¥æ”¹å–„å¯è¯»æ€§ */
  max-height: 72rpx; /* é™åˆ¶æœ€å¤§é«˜åº¦ä¸º2è¡Œ */
}

.frequent-count {
  font-size: 22rpx;
  color: #999999;
  margin-top: auto; /* è‡ªåŠ¨å°†æ¬¡æ•°æ¨åˆ°åº•éƒ¨ */
}

/* ========== çƒ­é—¨æ¨¡æ¿ ========== */
.hot-grid {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: row;
  flex-wrap: wrap;
  gap: 20rpx; /* ä½¿ç”¨ gap å±æ€§ç»Ÿä¸€è®¾ç½®é—´è· */
  /* å·¦å³è¾¹è·ç”±çˆ¶å®¹å™¨ .section æä¾›ï¼Œä¸éœ€è¦é‡å¤è®¾ç½® */
}

.hot-item {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: column; /* å‚ç›´æ’åˆ— */
  width: 333rpx; /* å®½åº¦è®¡ç®—ï¼š(750 - 32*2 - 20) / 2 = 333rpxï¼Œä¸€è¡Œæ˜¾ç¤º2ä¸ªï¼Œä¸­é—´é—´è·20rpx */
  flex-shrink: 0; /* é˜²æ­¢è¢«å‹ç¼© */
  background-color: #FFFFFF;
  border-radius: 16rpx;
  padding: 24rpx;
  margin-bottom: 0; /* ç§»é™¤ margin-bottomï¼Œæ”¹ç”¨ gap */
  box-shadow: 0 2rpx 16rpx rgba(0, 0, 0, 0.04);
}

.hot-header {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16rpx;
}

.hot-tag {
  font-size: 22rpx;
  font-weight: 500;
}

.hot-badge {
  font-size: 28rpx;
}

.hot-name {
  font-size: 28rpx;
  color: #1A1A1A;
  font-weight: 500;
  margin-bottom: 12rpx;
  lines: 2; /* æ”¹ä¸º2è¡Œæ˜¾ç¤ºï¼Œä¸å¸¸ç”¨æ¨¡æ¿ä¿æŒä¸€è‡´ */
  text-overflow: ellipsis;
  overflow: hidden;
  word-break: break-all; /* å…è®¸å•è¯å†…æ¢è¡Œ */
  line-height: 1.4; /* æ·»åŠ è¡Œé«˜ */
  max-height: 78rpx; /* é™åˆ¶æœ€å¤§é«˜åº¦ä¸º2è¡Œ */
}

.hot-desc {
  font-size: 24rpx;
  color: #666666;
  margin-bottom: 16rpx;
  lines: 2;
  text-overflow: ellipsis;
  overflow: hidden;
  line-height: 1.5;
  max-height: 72rpx; /* é™åˆ¶æœ€å¤§é«˜åº¦ */
}

.hot-footer {
  flex-direction: row;
  align-items: center;
}

.hot-icon {
  margin-right: 8rpx;
}

.hot-count {
  font-size: 22rpx;
  color: #999999;
}

/* ========== æ¨¡æ¿åˆ—è¡¨ ========== */
.template-list {
  margin-top: 16rpx;
  /* å·¦å³è¾¹è·ç”±çˆ¶å®¹å™¨ .section æä¾›ï¼Œä¸éœ€è¦é‡å¤è®¾ç½® */
}

.template-item {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: column; /* å‚ç›´æ’åˆ— */
  background-color: #FFFFFF;
  border-radius: 16rpx;
  padding: 24rpx;
  margin-bottom: 16rpx;
  box-shadow: 0 2rpx 16rpx rgba(0, 0, 0, 0.04);
}

.template-header {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16rpx;
}

.template-tag {
  font-size: 22rpx;
  font-weight: 500;
}

.template-badges {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: row;
  align-items: center;
}

.badge {
  padding: 4rpx 12rpx;
  border-radius: 4rpx;
  font-size: 20rpx;
  margin-left: 8rpx;
}

.badge.official {
  background-color: #FFF7E6;
  color: #FA8C16;
}

.badge.hot {
  background-color: #FFF1F0;
  color: #FF4D4F;
}

.template-name {
  font-size: 30rpx;
  color: #1A1A1A;
  font-weight: 500;
  margin-bottom: 12rpx;
  lines: 2; /* æ”¹ä¸º2è¡Œæ˜¾ç¤º */
  text-overflow: ellipsis;
  overflow: hidden;
  word-break: break-all; /* å…è®¸å•è¯å†…æ¢è¡Œ */
  line-height: 1.4; /* æ·»åŠ è¡Œé«˜ */
  max-height: 84rpx; /* é™åˆ¶æœ€å¤§é«˜åº¦ä¸º2è¡Œ */
}

.template-desc {
  font-size: 26rpx;
  color: #666666;
  margin-bottom: 16rpx;
  lines: 2;
  text-overflow: ellipsis;
  overflow: hidden;
  line-height: 1.5;
  max-height: 78rpx; /* é™åˆ¶æœ€å¤§é«˜åº¦ä¸º2è¡Œ */
}

.template-footer {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
}

.template-meta {
  display: flex; /* æ·»åŠ  flex å¸ƒå±€ */
  flex-direction: row;
  align-items: center;
}

.meta-icon {
  margin-right: 8rpx;
}

.meta-text {
  font-size: 22rpx;
  color: #999999;
}

.template-time {
  font-size: 22rpx;
  color: #CCCCCC;
}

/* ========== ç©ºçŠ¶æ€ ========== */
.empty {
  align-items: center;
  padding: 120rpx 0;
}

.empty-icon {
  margin-bottom: 24rpx;
}

.empty-text {
  font-size: 28rpx;
  color: #999999;
  margin-bottom: 12rpx;
}

.empty-desc {
  font-size: 24rpx;
  color: #CCCCCC;
}

/* ========== åŠ è½½çŠ¶æ€ ========== */
.loading {
  flex-direction: row;
  align-items: center;
  justify-content: center;
  padding: 40rpx 0;
}

.loading-spinner {
  width: 40rpx;
  height: 40rpx;
  border: 3rpx solid #F0F0F0;
  border-top-color: #00C28A;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

.loading-text {
  font-size: 24rpx;
  color: #999999;
  margin-left: 16rpx;
}

/* ========== åº•éƒ¨æç¤º ========== */
.bottom {
  padding: 48rpx 0;
  align-items: center;
}

.bottom-text {
  font-size: 24rpx;
  color: #CCCCCC;
}
</style>
 