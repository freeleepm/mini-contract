<script lang="uts">
import { 
	getContract, 
	cancelContract, 
	deleteContract,
	downloadContract,
	ContractStatus,
	ParticipantStatus,
	getContractStatusName,
	getContractStatusColor,
	getParticipantStatusName
} from '../../api/contracts/index';
import type { Contract } from '../../api/contracts/index';
// å·²ä¸å†éœ€è¦å•ç‹¬è°ƒç”¨æ¨¡æ¿æ¥å£ï¼Œæ¨¡æ¿åç§°ä»ç­¾ç½²ä»»åŠ¡ä¸­è·å–
// import { getTemplateDetail } from '../../api/templates/index';
import { downloadContractFile } from '../../api/utils/download.uts';
import { post } from '../../api/index';
	
	export default {
		data() {
			return {
				// åˆåŒID
				contractId: '',
			
				// åˆåŒè¯¦æƒ…æ•°æ®
			contract: null as Contract | null,
			
			// ğŸ”§ åˆåŒçŠ¶æ€å¸¸é‡ï¼ˆæ³¨æ„ï¼šåç«¯çŠ¶æ€ä»1å¼€å§‹ï¼Œä¸æ˜¯0ï¼ï¼‰
			STATUS_DRAFT: 1,
			STATUS_SIGNING: 2,
			STATUS_COMPLETED: 3,
			STATUS_CANCELLED: 4,
			STATUS_REJECTED: 5,
			STATUS_EXPIRED: 6,
			
		// ğŸ”§ å‚ä¸äººçŠ¶æ€å¸¸é‡ï¼ˆä¸åç«¯ SealSignTaskParticipantStatusEnum ä¿æŒä¸€è‡´ï¼‰
		PARTICIPANT_PENDING: 0,         // å¾…å¤„ç†
		PARTICIPANT_FORM_FILLED: 1,     // è¡¨å•å·²å¡«å†™
		PARTICIPANT_SIGNED: 2,          // å·²ç­¾ç½²
		PARTICIPANT_REJECTED: 3,        // å·²æ‹’ç»
		PARTICIPANT_CANCELLED: 4,       // å·²å–æ¶ˆ
			
		// å½“å‰ç”¨æˆ·IDï¼ˆç”¨äºæƒé™åˆ¤æ–­ï¼‰
		currentUserId: '' as string,
		
	// ğŸ¨ å¤´åƒé¢œè‰²æ± ï¼ˆä¼˜é›…çš„ä¸­æ€§è‰²ç³» + æŸ”å’Œè‰²è°ƒï¼‰
	avatarColors: [
		['#8B9DC3'],  // ä¼˜é›…è“ç°
		['#9BA3AF'],  // ç»å…¸ç°
		['#8BA3A3'],  // é›¾éœ¾è“
		['#A8B5C7'],  // æµ…çŸ³æ¿è“
		['#97A7B3'],  // ä¸­æ€§è“ç°
		['#9CA9B3'],  // å†·ç°è“
		['#8D9BA8'],  // é“ç°è“
		['#A2B1C2'],  // æŸ”å’Œè“
	] as string[][],
		
		// åŠ è½½çŠ¶æ€
		loading: true,
		
		// æ¨¡æ¿åç§°
		templateName: '',
		
		// ğŸ”§ é¦–æ¬¡åŠ è½½æ ‡è®°ï¼ˆé¿å… onShow é‡å¤è°ƒç”¨æ¥å£ï¼‰
		isFirstLoad: true
	}
},
	
	onLoad(options: any) {
		// ğŸ”§ è·å–å½“å‰ç”¨æˆ·ID
		try {
			const userInfo = uni.getStorageSync('userInfo');
			if (userInfo && userInfo.id) {
				this.currentUserId = String(userInfo.id);
				console.log('âœ… å½“å‰ç”¨æˆ·ID:', this.currentUserId);
			} else {
				console.warn('âš ï¸ æœªæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œä½¿ç”¨é»˜è®¤ç”¨æˆ·ID: 1');
				this.currentUserId = '1';
			}
		} catch (error) {
			console.error('è·å–ç”¨æˆ·IDå¤±è´¥:', error);
			this.currentUserId = '1';
		}
		
		// ä»è·¯ç”±å‚æ•°ä¸­è·å–åˆåŒID
		if (options && options.id) {
		this.contractId = options.id;
		console.log('åŠ è½½åˆåŒè¯¦æƒ…ï¼ŒID:', this.contractId);
		this.loadContractDetail();
		} else {
			uni.showToast({
				title: 'åˆåŒIDä¸å­˜åœ¨',
				icon: 'none'
		});
			// å»¶è¿Ÿè¿”å›
				setTimeout(() => {
				uni.navigateBack();
			}, 1500);
			}
		},
	
onShow() {
	// ğŸ”§ é¡µé¢æ˜¾ç¤ºæ—¶åˆ·æ–°æ•°æ®ï¼ˆä»…åœ¨éé¦–æ¬¡åŠ è½½æ—¶ï¼Œå³ä»å…¶ä»–é¡µé¢è¿”å›æ—¶ï¼‰
	if (this.isFirstLoad) {
		// é¦–æ¬¡åŠ è½½ï¼Œç”± onLoad å¤„ç†ï¼Œè¿™é‡Œè·³è¿‡
		this.isFirstLoad = false;
		console.log('ğŸ“± é¦–æ¬¡åŠ è½½ï¼Œè·³è¿‡ onShow ä¸­çš„æ¥å£è°ƒç”¨');
	} else if (this.contractId) {
		// ä»å…¶ä»–é¡µé¢è¿”å›ï¼Œåˆ·æ–°æ•°æ®
		console.log('ğŸ“± é¡µé¢é‡æ–°æ˜¾ç¤ºï¼ˆä»å…¶ä»–é¡µé¢è¿”å›ï¼‰ï¼Œåˆ·æ–°åˆåŒè¯¦æƒ…');
		this.loadContractDetail();
	}
},
	
		methods: {
		/**
		 * åŠ è½½åˆåŒè¯¦æƒ…
		 */
		async loadContractDetail(): Promise<void> {
			try {
				this.loading = true;
				
				uni.showLoading({
					title: 'åŠ è½½ä¸­'
				});
				
			// è°ƒç”¨çœŸå®APIè·å–åˆåŒè¯¦æƒ…
			const detail: Contract = await getContract(this.contractId);
			
			console.log('åˆåŒè¯¦æƒ…:', JSON.stringify(detail));
			console.log('å‚ä¸äººä¿¡æ¯:', detail.participants);
			console.log('å‚ä¸äººæ•°é‡:', detail.participants ? detail.participants.length : 0);
			
			// ğŸ”§ è¯¦ç»†æ‰“å°æ¯ä¸ªå‚ä¸äººçš„ä¿¡æ¯ï¼ˆåŒ…æ‹¬çŠ¶æ€è¯Šæ–­ï¼‰
			if (detail.participants && detail.participants.length > 0) {
				console.log(`ğŸ“‹ å‘ç° ${detail.participants.length} ä¸ªå‚ä¸äºº`);
				detail.participants.forEach((p: any, index: number) => {
					console.log(`\nğŸ‘¤ å‚ä¸äºº${index + 1}:`, JSON.stringify(p));
					console.log(`  - userId: ${p.userId}`);
					console.log(`  - name: ${p.name || p.nickname || 'æœªçŸ¥'}`);
					console.log(`  - mobile: ${p.mobile || 'æ— '}`);
					console.log(`  - status: ${p.status} (ç±»å‹: ${typeof p.status}) â† åç«¯å­—æ®µå`);
					console.log(`  - signTime: ${p.signTime || 'æ— '}`);
					console.log(`  - order: ${p.order}`);
					console.log(`  - rejectReason: ${p.rejectReason || 'æ— '}`);
					
					// ğŸ”§ æ˜¾ç¤ºçŠ¶æ€æ˜ å°„ç»“æœ
					const statusName = this.getParticipantStatus(p.status);
					console.log(`  - âœ… çŠ¶æ€åç§°: ${statusName}`);
					
					if (statusName === 'æœªçŸ¥') {
						console.warn(`âš ï¸ è­¦å‘Šï¼šå‚ä¸äºº ${index + 1} çš„çŠ¶æ€å€¼ "${p.status}" (ç±»å‹: ${typeof p.status}) æ— æ³•è¯†åˆ«ï¼`);
						console.warn(`  é¢„æœŸå€¼: 0(å¾…ç­¾ç½²), 1(å·²ç­¾ç½²), 2(å·²æ‹’ç»), 3(å·²å–æ¶ˆ)`);
					}
					
					console.log(`  - æ‰€æœ‰å­—æ®µ:`, Object.keys(p).join(', '));
				});
				console.log(`\nâœ… å‚ä¸äººä¿¡æ¯åŠ è½½å®Œæˆ\n`);
			}
			
			this.contract = detail;
				
			// ğŸ”§ ä¼˜åŒ–ï¼šæ¨¡æ¿åç§°ç›´æ¥ä»ç­¾ç½²ä»»åŠ¡ä¸­è·å–ï¼ˆåç«¯å·²åŒ…å« templateName å­—æ®µï¼‰
			if (detail.templateName) {
				this.templateName = detail.templateName;
				console.log('æ¨¡æ¿åç§°:', this.templateName);
			} else if (detail.templateId) {
				// å…œåº•æ–¹æ¡ˆï¼šå¦‚æœåç«¯æ²¡æœ‰è¿”å› templateNameï¼Œæ˜¾ç¤ºæ¨¡æ¿ID
				this.templateName = `æ¨¡æ¿ ${detail.templateId}`;
				console.log('æœªè·å–åˆ°æ¨¡æ¿åç§°ï¼Œä½¿ç”¨å…œåº•æ–¹æ¡ˆ');
			}
				
				uni.hideLoading();
				
				} catch (error) {
				console.error('åŠ è½½åˆåŒè¯¦æƒ…å¤±è´¥:', error);
				
				uni.hideLoading();
				
				uni.showModal({
					title: 'åŠ è½½å¤±è´¥',
					content: 'åˆåŒè¯¦æƒ…åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•',
					showCancel: true,
					confirmText: 'é‡è¯•',
					cancelText: 'è¿”å›',
					success: (res) => {
						if (res.confirm) {
							// é‡è¯•
							this.loadContractDetail();
						} else {
							// è¿”å›
							uni.navigateBack();
						}
					}
					});
				} finally {
				this.loading = false;
			}
		},
		
	/**
	 * ğŸ†• å¡«å†™è¡¨å•ï¼ˆè·³è½¬H5ç­¾ç½²é¡µé¢-è¡¨å•æ¨¡å¼ï¼‰
	 */
	handleFillForm(): void {
		if (!this.contract) return;
		
		console.log('å¡«å†™è¡¨å•:', this.contract.id);
		
		// è·³è½¬åˆ°H5è¡¨å•å¡«å†™é¡µé¢
		uni.navigateTo({
			url: `/pages/contract-form/h5-fill?taskId=${this.contract.id}`
		});
	},
	
	/**
	 * ç­¾ç½²åˆåŒï¼ˆè·³è½¬H5ç­¾ç½²é¡µé¢ï¼‰
	 */
handleSign(): void {
	if (!this.contract) return;
	
	console.log('ç­¾ç½²åˆåŒ:', this.contract.id);
	
	// è·³è½¬åˆ°H5ç­¾ç½²é¡µé¢
	uni.navigateTo({
		url: `/pages/contract-sign/h5-sign?taskId=${this.contract.id}`
	});
},
		
		/**
		 * æ’¤é”€åˆåŒ
		 */
		async handleCancel(): Promise<void> {
			if (!this.contract) return;
			
			uni.showModal({
				title: 'æ’¤é”€åˆåŒ',
				content: 'ç¡®å®šè¦æ’¤é”€è¯¥åˆåŒå—ï¼Ÿæ’¤é”€åå°†æ— æ³•æ¢å¤ã€‚',
				success: async (res) => {
					if (res.confirm) {
						try {
							uni.showLoading({
								title: 'æ’¤é”€ä¸­...'
							});
							
							// è°ƒç”¨æ’¤é”€API
							await cancelContract(this.contract!.id);
							
							uni.hideLoading();
							
							// æˆåŠŸæç¤º
				uni.showToast({
								title: 'åˆåŒå·²æ’¤é”€',
								icon: 'success'
							});
							
							// å»¶è¿Ÿè¿”å›ä¸Šä¸€é¡µ
							setTimeout(() => {
								uni.navigateBack();
							}, 1500);
							
						} catch (error) {
							uni.hideLoading();
							console.error('æ’¤é”€å¤±è´¥:', error);
						uni.showToast({
								title: 'æ’¤é”€å¤±è´¥',
								icon: 'none'
							});
						}
					}
				}
			});
		},
		
		/**
		 * åˆ é™¤åˆåŒ
		 */
		async handleDelete(): Promise<void> {
			if (!this.contract) return;
			
				uni.showModal({
				title: 'åˆ é™¤åˆåŒ',
				content: 'ç¡®å®šè¦åˆ é™¤è¯¥åˆåŒå—ï¼Ÿåˆ é™¤åå°†æ— æ³•æ¢å¤ã€‚',
				success: async (res) => {
						if (res.confirm) {
						try {
							uni.showLoading({
								title: 'åˆ é™¤ä¸­...'
							});
							
							// è°ƒç”¨åˆ é™¤API
							await deleteContract(this.contract!.id);
							
							uni.hideLoading();
							
			// æˆåŠŸæç¤º
								uni.showToast({
								title: 'åˆåŒå·²åˆ é™¤',
									icon: 'success'
							});
								
							// å»¶è¿Ÿè¿”å›ä¸Šä¸€é¡µ
								setTimeout(() => {
								uni.navigateBack();
							}, 1500);
							
						} catch (error) {
							uni.hideLoading();
							console.error('åˆ é™¤å¤±è´¥:', error);
							uni.showToast({
								title: 'åˆ é™¤å¤±è´¥',
								icon: 'none'
							});
						}
					}
				}
			});
		},
		
	/**
	 * ä¸‹è½½åˆåŒ
	 */
	async handleDownload(): Promise<void> {
		if (!this.contract) return;
		
		try {
			console.log('ğŸ“¥ ä¸‹è½½åˆåŒ:', this.contract.id);
			
			// ä½¿ç”¨å·²ç­¾ç½²çš„æ–‡ä»¶æˆ–åŸæ–‡ä»¶
			const fileUrl = this.contract.signedFileUrl || this.contract.fileUrl;
			
			if (!fileUrl) {
				uni.showToast({
					title: 'æ–‡ä»¶ä¸å­˜åœ¨',
					icon: 'none',
					duration: 2000
				});
				return;
			}
			
			// ç”Ÿæˆæ–‡ä»¶å
			const fileName = `${this.contract.name || 'åˆåŒ'}_${this.contract.id}.pdf`;
			
			// ä½¿ç”¨ç»Ÿä¸€çš„ä¸‹è½½å·¥å…·
			await downloadContractFile(fileUrl, fileName);
			
		} catch (error) {
			console.error('âŒ ä¸‹è½½åˆåŒå¤±è´¥:', error);
			uni.showToast({
				title: 'ä¸‹è½½å¤±è´¥',
				icon: 'none',
				duration: 2000
			});
		}
	},
	
	/**
	 * AIå®¡æŸ¥åˆåŒ
	 */
	async handleAIAudit(): Promise<void> {
		if (!this.contract) return;
		
		try {
			uni.showLoading({
				title: 'æ­£åœ¨å¯åŠ¨AIå®¡æŸ¥...'
			});
			
			// è°ƒç”¨åç«¯æ¥å£å‘èµ·AIå®¡æŸ¥
			const taskId = await post<number>('/api/v1/seal/audit/start', {
				contractId: this.contract.id,
				auditType: 1 // æ ‡å‡†å®¡æŸ¥
		}, {
			timeout: 180000  // AIå®¡æŸ¥éœ€è¦3åˆ†é’Ÿè¶…æ—¶
			});
			
			uni.hideLoading();
			
			uni.showToast({
				title: 'AIå®¡æŸ¥å·²å¯åŠ¨',
				icon: 'success'
			});
			
			// è·³è½¬åˆ°å®¡æŸ¥è¿›åº¦é¡µ
			setTimeout(() => {
				uni.navigateTo({
					url: `/pages/contract-audit/progress?taskId=${taskId}`
				});
			}, 1000);
		} catch (error) {
			uni.hideLoading();
			console.error('AIå®¡æŸ¥å¯åŠ¨å¤±è´¥:', error);
			uni.showToast({
				title: error.message || 'ç½‘ç»œé”™è¯¯',
				icon: 'none',
				duration: 2000
			});
		}
	},
	
	/**
	 * é¢„è§ˆåˆåŒ
	 */
	handlePreview(): void {
			if (!this.contract) return;
			
			console.log('é¢„è§ˆåˆåŒ:', this.contract.id);
			console.log('åˆåŒçŠ¶æ€:', this.contract.status);
			console.log('fileUrl:', this.contract.fileUrl);
			
			// ğŸ”§ åç«¯å·²ç»è‡ªåŠ¨å¤„ç†ï¼šå·²å®Œæˆæ—¶ fileUrl = signedFileUrlï¼Œå…¶ä»–çŠ¶æ€ fileUrl = åŸæ–‡ä»¶
			// æ‰€ä»¥å‰ç«¯ç›´æ¥ä½¿ç”¨ fileUrl å³å¯
			const previewUrl = this.contract.fileUrl;
			console.log('âœ… ä½¿ç”¨åç«¯è¿”å›çš„æ–‡ä»¶URL:', previewUrl);
			
			// è·³è½¬åˆ°H5é¢„è§ˆé¡µé¢ï¼Œä¼ é€’æ–‡ä»¶URLå’ŒçŠ¶æ€ï¼ˆé¿å…é‡å¤è°ƒç”¨æ¥å£ï¼‰
			const encodedUrl = encodeURIComponent(previewUrl);
			const jumpUrl = `/pages/contract-view/h5-view?taskId=${this.contract.id}&fileUrl=${encodedUrl}&status=${this.contract.status}`;
			
			console.log('ğŸš€ è·³è½¬URL:', jumpUrl);
			console.log('ğŸ“„ æ–‡ä»¶URL:', previewUrl);
			console.log('ğŸ” ç¼–ç åçš„URL:', encodedUrl);
			
			uni.navigateTo({
				url: jumpUrl
			});
		},
		
		/**
		 * è·å–çŠ¶æ€åç§°
		 */
		getStatusName(status: ContractStatus): string {
			return getContractStatusName(status);
		},
		
		/**
		 * è·å–çŠ¶æ€é¢œè‰²
		 */
		getStatusColor(status: ContractStatus): string {
			return getContractStatusColor(status);
		},
		
	/**
	 * è·å–å‚ä¸äººçŠ¶æ€åç§°ï¼ˆå¢å¼ºç‰ˆï¼Œè€ƒè™‘æµç¨‹æ¨¡å¼ï¼‰
	 */
	getParticipantStatus(status: ParticipantStatus): string {
		// ä½¿ç”¨APIä¸­çš„ç»Ÿä¸€çŠ¶æ€åç§°æ˜ å°„
		return getParticipantStatusName(status);
	},
	
	/**
	 * ğŸ”§ è·å–å‚ä¸äººçŠ¶æ€æ–‡æœ¬ï¼ˆè€ƒè™‘æµç¨‹æ¨¡å¼ï¼‰
	 * ä¸PCç«¯ä¿æŒä¸€è‡´çš„å®ç°
	 */
	getParticipantStatusText(participant: any): string {
		const status = participant.status;
		const flowMode = participant.flowMode || null;
		
		// å¦‚æœæ˜¯å¾…å¤„ç†çŠ¶æ€ï¼Œéœ€è¦æ ¹æ®æµç¨‹æ¨¡å¼åŒºåˆ†
		if (status === this.PARTICIPANT_PENDING) {
			// ä¸¤é˜¶æ®µæ¨¡å¼ï¼šå…ˆå¡«è¡¨åç­¾ç½²
			if (flowMode === 'TWO_STAGE') {
				return 'å¾…å¡«è¡¨';
			}
			// ç›´æ¥ç­¾ç½²æ¨¡å¼
			return 'å¾…ç­¾ç½²';
		}
		
		// å…¶ä»–çŠ¶æ€ï¼šä½¿ç”¨æ ‡å‡†çŠ¶æ€åç§°
		return getParticipantStatusName(status);
	},
		
	/**
	 * è·å–å‚ä¸äººå§“åï¼ˆå‚è€ƒåå°ä»£ç å®ç°ï¼‰
	 */
	getParticipantName(participant: any): string {
		// å‚è€ƒåå° seal/signTask/index.vue ç¬¬446è¡Œçš„å®ç°
		return participant.userName || participant.nickname || 'æœªçŸ¥';
	},
	
	/**
	 * ğŸ”§ æ ¹æ®ç”¨æˆ·IDè·å–å¤´åƒé¢œè‰²ï¼ˆéšæœºä½†å›ºå®šï¼‰
	 */
	getAvatarColor(userId: any): string[] {
		// å°†ç”¨æˆ·IDè½¬æ¢ä¸ºæ•°å­—
		const id = String(userId || '0');
		let hash = 0;
		for (let i = 0; i < id.length; i++) {
			hash = id.charCodeAt(i) + ((hash << 5) - hash);
		}
		// ä½¿ç”¨ hash å€¼é€‰æ‹©é¢œè‰²
		const index = Math.abs(hash) % this.avatarColors.length;
		return this.avatarColors[index];
	},
		
	/**
	 * ğŸ”§ æ‰‹æœºå·è„±æ•å¤„ç†
	 * @param phone æ‰‹æœºå·
	 * @returns è„±æ•åçš„æ‰‹æœºå·ï¼ˆä¾‹å¦‚ï¼š136****6666ï¼‰
	 */
	maskPhone(phone: string): string {
		if (!phone || phone.length < 11) return phone;
		return phone.substring(0, 3) + '****' + phone.substring(7);
	},
	
	/**
	 * æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´
	 */
	formatDateTime(dateStr: string | null): string {
			if (!dateStr) return '';
			
			try {
				let date: Date;
				// åˆ¤æ–­æ˜¯æ—¶é—´æˆ³è¿˜æ˜¯æ—¥æœŸå­—ç¬¦ä¸²
				if (/^\d+$/.test(dateStr)) {
					// æ—¶é—´æˆ³
					date = new Date(parseInt(dateStr));
				} else {
					// æ—¥æœŸå­—ç¬¦ä¸²
					date = new Date(dateStr);
				}
				
				// æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
				if (isNaN(date.getTime())) {
					return dateStr;
				}
				
				const year = date.getFullYear();
				const month = String(date.getMonth() + 1).padStart(2, '0');
				const day = String(date.getDate()).padStart(2, '0');
				const hours = String(date.getHours()).padStart(2, '0');
				const minutes = String(date.getMinutes()).padStart(2, '0');
				
				return `${year}-${month}-${day} ${hours}:${minutes}`;
			} catch (error) {
				console.error('æ—¥æœŸæ ¼å¼åŒ–å¤±è´¥:', error);
				return dateStr || '';
			}
		},
		
	/**
	 * ğŸ†• åˆ¤æ–­æ˜¯å¦å¯ä»¥å¡«å†™è¡¨å•
	 * æ¡ä»¶ï¼šä»»åŠ¡çŠ¶æ€=è¡¨å•å¡«å†™ä¸­(7) ä¸” å½“å‰ç”¨æˆ·çš„å‚ä¸äººæ¨¡å¼=TWO_STAGE ä¸” çŠ¶æ€=PENDING(0)
	 */
	canFillForm(): boolean {
		if (!this.contract) return false;
		if (this.contract.status !== 7) return false;  // STATUS_FORM_FILLING
		
		// ğŸ”§ ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„isCurrentUserå­—æ®µï¼Œæ”¯æŒuserIdå’Œæ‰‹æœºå·ä¸¤ç§åŒ¹é…æ–¹å¼
		const myParticipant = this.contract.participants?.find(
			(p: any) => p.isCurrentUser === true
		);
		
		if (!myParticipant) return false;
		
		// å¿…é¡»æ˜¯ä¸¤é˜¶æ®µæ¨¡å¼ä¸”çŠ¶æ€ä¸ºå¾…å¤„ç†
		return myParticipant.flowMode === 'TWO_STAGE' && myParticipant.status === this.PARTICIPANT_PENDING;
	},
	
	/**
	 * ğŸ”§ åˆ¤æ–­æ˜¯å¦å¯ä»¥ç­¾ç½²ï¼ˆä¸PCç«¯é€»è¾‘åŒæ­¥ï¼‰
	 * 
	 * ç­¾ç½²æƒé™è§„åˆ™ï¼š
	 * 1. FORM_FILLING(7)çŠ¶æ€ï¼šåªæœ‰DIRECTæ¨¡å¼ä¸”çŠ¶æ€ä¸ºPENDINGçš„å‚ä¸è€…å¯ä»¥ç­¾ç½²
	 * 2. SIGNING(2)çŠ¶æ€ï¼šæ‰€æœ‰çŠ¶æ€ä¸ºPENDINGæˆ–FORM_FILLEDçš„å‚ä¸è€…éƒ½å¯ä»¥ç­¾ç½²
	 */
	canSign(): boolean {
		if (!this.contract) return false;
		
		// çŠ¶æ€æ£€æŸ¥ï¼šç­¾ç½²ä¸­æˆ–è¡¨å•å¡«å†™ä¸­éƒ½å¯èƒ½éœ€è¦ç­¾ç½²
		if (this.contract.status !== this.STATUS_SIGNING && this.contract.status !== 7) return false;
		
		// ğŸ”§ ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„isCurrentUserå­—æ®µï¼Œæ”¯æŒuserIdå’Œæ‰‹æœºå·ä¸¤ç§åŒ¹é…æ–¹å¼
		const myParticipant = this.contract.participants?.find(
			(p: any) => p.isCurrentUser === true
		);
		
		if (!myParticipant) return false;
		
		// ğŸ¯ FORM_FILLING(7)é˜¶æ®µï¼šåªæœ‰DIRECTæ¨¡å¼çš„å‚ä¸è€…å¯ä»¥ç­¾ç½²ï¼ˆæ— éœ€å¡«è¡¨ï¼‰
		if (this.contract.status === 7) {
			return myParticipant.flowMode === 'DIRECT' && myParticipant.status === this.PARTICIPANT_PENDING;
		}
		
		// ğŸ¯ SIGNING(2)é˜¶æ®µï¼šçŠ¶æ€ä¸ºPENDINGæˆ–FORM_FILLEDçš„å‚ä¸è€…éƒ½å¯ä»¥ç­¾ç½²
		// PENDING: ç›´æ¥è¿›å…¥ç­¾ç½²é˜¶æ®µçš„å‚ä¸è€…ï¼ˆSIMPLE/DIRECTæ¨¡å¼ï¼‰
		// FORM_FILLED: å·²å®Œæˆè¡¨å•å¡«å†™çš„å‚ä¸è€…ï¼ˆTWO_STAGEæ¨¡å¼ï¼‰
		return myParticipant.status === this.PARTICIPANT_PENDING || 
		       myParticipant.status === this.PARTICIPANT_FORM_FILLED;
	},
		
	/**
	 * ğŸ”§ åˆ¤æ–­æ˜¯å¦å¯ä»¥æ’¤é”€ï¼ˆåŠ å…¥æƒé™åˆ¤æ–­ï¼‰
	 */
	canCancel(): boolean {
		if (!this.contract) return false;
		
		// åªæœ‰è‰ç¨¿ã€è¡¨å•å¡«å†™ä¸­æˆ–ç­¾ç½²ä¸­çš„åˆåŒå¯ä»¥æ’¤é”€
		if (this.contract.status !== this.STATUS_DRAFT && 
		    this.contract.status !== this.STATUS_SIGNING &&
		    this.contract.status !== 7) {  // STATUS_FORM_FILLING
			return false;
		}
		
		// åªæœ‰åˆ›å»ºè€…å¯ä»¥æ’¤é”€
		return String(this.contract.creator) === String(this.currentUserId);
	},
		
		/**
		 * ğŸ”§ åˆ¤æ–­æ˜¯å¦å¯ä»¥åˆ é™¤ï¼ˆåŠ å…¥æƒé™åˆ¤æ–­ï¼‰
		 */
		canDelete(): boolean {
			if (!this.contract) return false;
			
			// åªæœ‰ç»ˆæ€çš„åˆåŒå¯ä»¥åˆ é™¤
			const deletableStatuses = [
				this.STATUS_COMPLETED,
				this.STATUS_CANCELLED,
				this.STATUS_REJECTED,
				this.STATUS_EXPIRED
			];
			
			if (!deletableStatuses.includes(this.contract.status)) return false;
			
			// åªæœ‰åˆ›å»ºè€…å¯ä»¥åˆ é™¤
			return String(this.contract.creator) === String(this.currentUserId);
			}
		}
	}
</script>

<template>
	<view class="contract-detail">
		<!-- åŠ è½½ä¸­ -->
		<view v-if="loading" class="loading-container">
			<view class="loading-spinner"></view>
			<text class="loading-text">åŠ è½½ä¸­...</text>
		</view>
		
		<!-- åˆåŒå†…å®¹ -->
	<scroll-view v-if="!loading && contract" class="content-scroll" scroll-y="true">
		<view class="content-wrapper">
			<!-- ğŸ†• é˜¶æ®µæç¤ºå¡ç‰‡ï¼ˆè¡¨å•å¡«å†™ä¸­æ—¶æ˜¾ç¤ºï¼‰ -->
			<view v-if="contract && contract.status === 7" class="stage-hint-card">
				<view class="stage-hint-icon">
					<text class="fa fa-info-circle"></text>
				</view>
				<view class="stage-hint-content">
					<view class="stage-hint-title">ğŸ“ å½“å‰å¤„äºè¡¨å•å¡«å†™é˜¶æ®µ</view>
					<view class="stage-hint-desc">æ‰€æœ‰å‚ä¸äººå¡«å†™å®Œè¡¨å•åï¼Œå°†è‡ªåŠ¨è¿›å…¥ç­¾ç½²é˜¶æ®µ</view>
				</view>
			</view>
			
			<!-- åˆåŒåŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
			<view class="info-card">
				<!-- çŠ¶æ€æ ‡ç­¾ -->
				<view class="status-badge" :style="{ backgroundColor: getStatusColor(contract.status) }">
					<text class="status-text">{{ getStatusName(contract.status) }}</text>
				</view>
					
					<!-- åˆåŒæ ‡é¢˜ -->
					<view class="contract-header">
						<text class="contract-title">{{ contract.name }}</text>
					</view>
					
					<!-- åŸºæœ¬ä¿¡æ¯ -->
					<view class="detail-section">
						<view class="detail-row">
							<text class="fa fa-clock detail-icon"></text>
							<text class="detail-label">åˆ›å»ºæ—¶é—´</text>
							<text class="detail-value">{{ formatDateTime(contract.createTime) }}</text>
						</view>
						
						<view class="detail-row" v-if="contract.deadline">
							<text class="fa fa-calendar detail-icon"></text>
							<text class="detail-label">æˆªæ­¢æ—¶é—´</text>
							<text class="detail-value">{{ formatDateTime(contract.deadline) }}</text>
						</view>
						
						<view class="detail-row" v-if="contract.templateId">
							<text class="fa fa-file-text detail-icon"></text>
							<text class="detail-label">åˆåŒæ¨¡æ¿</text>
							<text class="detail-value">{{ templateName || 'åŠ è½½ä¸­...' }}</text>
						</view>
					</view>
				</view>
				
			<!-- å‚ä¸äººä¿¡æ¯å¡ç‰‡ -->
			<view class="info-card participants-card" v-if="contract">
				<view class="card-header">
					<view class="header-left">
						<text class="card-title">å‚ä¸æ–¹ä¿¡æ¯</text>
					</view>
					<view class="participant-count" v-if="contract.participants && contract.participants.length > 0">
						<text class="count-text">{{ contract.participants.length }}æ–¹</text>
					</view>
				</view>
				
				<!-- æœ‰å‚ä¸äººæ—¶æ˜¾ç¤ºåˆ—è¡¨ -->
				<view v-if="contract.participants && contract.participants.length > 0" class="participants-list">
		<view 
			v-for="(participant, index) in contract.participants" 
			:key="index"
			class="participant-item"
			:class="{
				'signed': participant.status === PARTICIPANT_SIGNED,
				'form-filled': participant.status === PARTICIPANT_FORM_FILLED,
				'rejected': participant.status === PARTICIPANT_REJECTED,
				'pending': participant.status === PARTICIPANT_PENDING
			}"
		>
				<!-- å·¦ä¾§ï¼šå¤´åƒåŒºåŸŸ -->
				<view class="participant-avatar">
					<view 
						class="avatar-circle" 
						:style="{ 
							backgroundColor: getAvatarColor(participant.userId)[0]
						}"
					>
						<!-- ğŸ”§ ä½¿ç”¨å§“åé¦–å­—ä½œä¸ºå¤´åƒ -->
						<text class="avatar-text">{{ getParticipantName(participant).substring(0, 1) }}</text>
					</view>
					<!-- ğŸ”§ ç­¾ç½²é¡ºåºå¾½ç«  -->
					<view class="order-badge" v-if="contract.participants && contract.participants.length > 1">
						<text class="order-num">{{ participant.order || (index + 1) }}</text>
					</view>
				</view>
						
						<!-- ä¸­é—´ï¼šå‚ä¸äººä¿¡æ¯ -->
						<view class="participant-content">
							<!-- å§“å -->
							<view class="name-row">
								<text class="participant-name">{{ getParticipantName(participant) }}</text>
				<!-- çŠ¶æ€æ ‡ç­¾ -->
				<view class="status-tag" :class="{
					'status-signed': participant.status === PARTICIPANT_SIGNED,
					'status-form-filled': participant.status === PARTICIPANT_FORM_FILLED,
					'status-form-filling': participant.status === PARTICIPANT_PENDING && participant.flowMode === 'TWO_STAGE',
					'status-pending': participant.status === PARTICIPANT_PENDING && (!participant.flowMode || participant.flowMode !== 'TWO_STAGE'),
					'status-rejected': participant.status === PARTICIPANT_REJECTED,
					'status-cancelled': participant.status === PARTICIPANT_CANCELLED
				}">
					<!-- å·²ç­¾ç½² -->
					<text class="fa fa-check-circle status-icon" v-if="participant.status === PARTICIPANT_SIGNED"></text>
					<!-- è¡¨å•å·²å¡«å†™ -->
					<text class="fa fa-file-check status-icon" v-if="participant.status === PARTICIPANT_FORM_FILLED"></text>
					<!-- å¾…å¡«è¡¨ï¼ˆä¸¤é˜¶æ®µæµç¨‹çš„å¾…å¤„ç†çŠ¶æ€ï¼‰ -->
					<text class="fa fa-edit status-icon" v-if="participant.status === PARTICIPANT_PENDING && participant.flowMode === 'TWO_STAGE'"></text>
					<!-- å¾…ç­¾ç½²ï¼ˆç›´æ¥ç­¾ç½²æµç¨‹çš„å¾…å¤„ç†çŠ¶æ€ï¼‰ -->
					<text class="fa fa-clock status-icon" v-if="participant.status === PARTICIPANT_PENDING && (!participant.flowMode || participant.flowMode !== 'TWO_STAGE')"></text>
					<!-- å·²æ‹’ç» -->
					<text class="fa fa-times-circle status-icon" v-if="participant.status === PARTICIPANT_REJECTED"></text>
					<!-- å·²å–æ¶ˆ -->
					<text class="fa fa-ban status-icon" v-if="participant.status === PARTICIPANT_CANCELLED"></text>
					<text class="status-text">{{ getParticipantStatusText(participant) }}</text>
				</view>
							</view>
							
				<!-- è”ç³»æ–¹å¼ï¼šæ‰‹æœºå·æˆ–ä¼ä¸šä¿¡æ¯ -->
				<view v-if="participant.userMobile || participant.enterpriseName" class="info-row contact-info">
					<text class="fa fa-phone info-icon" v-if="participant.userMobile"></text>
					<text class="fa fa-building info-icon" v-if="!participant.userMobile && participant.enterpriseName"></text>
					<text class="info-text">{{ participant.userMobile ? maskPhone(participant.userMobile) : participant.enterpriseName || '' }}</text>
				</view>
					
					<!-- ğŸ”§ ç­¾ç½²æ—¶é—´ï¼ˆåªåœ¨å·²ç­¾ç½²æ—¶æ˜¾ç¤ºï¼‰ -->
					<view v-if="participant.status === PARTICIPANT_SIGNED && participant.signTime" class="info-row">
						<text class="fa fa-calendar-check info-icon"></text>
						<text class="info-text">ç­¾ç½²äº {{ formatDateTime(participant.signTime) }}</text>
					</view>
					
					<!-- ğŸ”§ æ‹’ç­¾æ—¶é—´ï¼ˆå·²æ‹’ç­¾æ—¶æ˜¾ç¤ºï¼‰ -->
					<view v-if="participant.status === PARTICIPANT_REJECTED && participant.signTime" class="info-row">
						<text class="fa fa-calendar-times info-icon"></text>
						<text class="info-text">æ‹’ç­¾äº {{ formatDateTime(participant.signTime) }}</text>
					</view>
					
					<!-- ğŸ”§ æ‹’ç­¾åŸå› ï¼ˆå·²æ‹’ç­¾æ—¶æ˜¾ç¤ºï¼‰ -->
					<view v-if="participant.status === PARTICIPANT_REJECTED && participant.rejectReason" class="info-row">
						<text class="fa fa-comment-dots info-icon"></text>
						<text class="info-text">{{ participant.rejectReason }}</text>
					</view>
					
					<!-- ä½¿ç”¨çš„å°ç« ï¼ˆåªåœ¨å·²ç­¾ç½²æ—¶æ˜¾ç¤ºï¼‰ -->
					<view v-if="participant.status === PARTICIPANT_SIGNED && participant.sealName" class="info-row">
						<text class="fa fa-stamp info-icon"></text>
						<text class="info-text">{{ participant.sealName }}</text>
					</view>
						</view>
					</view>
				</view>
				
				<!-- æ— å‚ä¸äººæ—¶æ˜¾ç¤ºç©ºçŠ¶æ€ -->
				<view v-else class="empty-participants">
					<text class="fa fa-user-slash empty-icon"></text>
					<text class="empty-text">æš‚æ— å‚ä¸äººä¿¡æ¯</text>
				</view>
			</view>
			
			<!-- æ‹’ç»åŸå› ï¼ˆå¦‚æœæœ‰ï¼‰ -->
			<view class="info-card warning" v-if="contract && contract.status === STATUS_REJECTED && contract.reason">
				<view class="card-header">
					<text class="fa fa-exclamation-circle card-icon"></text>
					<text class="card-title">æ‹’ç»åŸå› </text>
				</view>
				<view class="reason-content">
					<text class="reason-text">{{ contract.reason }}</text>
				</view>
			</view>
			
			<!-- åº•éƒ¨å®‰å…¨é—´è· -->
			<view class="bottom-safe-area"></view>
		</view>
	</scroll-view>
		
	<!-- åº•éƒ¨æ“ä½œæ  -->
	<view v-if="!loading && contract" class="bottom-bar">
		<!-- é¢„è§ˆæŒ‰é’® -->
		<view class="action-btn secondary" @click="handlePreview">
			<text class="fa fa-eye"></text>
			<text class="action-text">é¢„è§ˆ</text>
		</view>
		
		<!-- ğŸ†• å¡«å†™è¡¨å•æŒ‰é’® -->
		<view v-if="canFillForm()" class="action-btn form" @click="handleFillForm">
			<text class="fa fa-edit"></text>
			<text class="action-text">å¡«å†™è¡¨å•</text>
		</view>
		
		<!-- ç­¾ç½²æŒ‰é’® -->
		<view v-if="canSign()" class="action-btn primary" @click="handleSign">
			<text class="fa fa-signature"></text>
			<text class="action-text">ç«‹å³ç­¾ç½²</text>
		</view>
		
		<!-- æ’¤é”€æŒ‰é’® -->
		<view v-if="canCancel()" class="action-btn danger" @click="handleCancel">
			<text class="fa fa-undo"></text>
			<text class="action-text">æ’¤é”€</text>
		</view>
		
	<!-- AIå®¡æŸ¥æŒ‰é’® -->
	<view v-if="contract && contract.status === STATUS_COMPLETED" class="action-btn audit" @click="handleAIAudit">
		<text class="fa fa-search"></text>
		<text class="action-text">AIå®¡æŸ¥</text>
	</view>
	
	<!-- ä¸‹è½½æŒ‰é’® -->
	<view v-if="contract && contract.status === STATUS_COMPLETED" class="action-btn primary" @click="handleDownload">
		<text class="fa fa-download"></text>
		<text class="action-text">ä¸‹è½½</text>
	</view>
	
	<!-- åˆ é™¤æŒ‰é’® -->
	<view v-if="canDelete()" class="action-btn danger" @click="handleDelete">
		<text class="fa fa-trash"></text>
		<text class="action-text">åˆ é™¤</text>
	</view>
	</view>
	</view>
</template>

<style>
/* å¼•å…¥FontAwesomeæ ·å¼ */
@import url("../../static/styles/fontawesome.css");

/* ğŸ”§ FontAwesomeåŸºç¡€æ ·å¼ï¼ˆç¡®ä¿å›¾æ ‡æ­£ç¡®æ˜¾ç¤ºï¼‰ */
.fa {
	font-family: 'Font Awesome 6 Free';
	font-weight: 900;
	font-style: normal;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

	.contract-detail {
		flex: 1;
	background-color: #F7F9FC;
}

/* ==================== åŠ è½½çŠ¶æ€ ==================== */
.loading-container {
		flex: 1;
		align-items: center;
	justify-content: center;
}

.loading-spinner {
		width: 80rpx;
		height: 80rpx;
	border: 4rpx solid #EBEEF5;
	border-top-color: #00C28A;
	border-radius: 50%;
	animation: spin 1s linear infinite;
	margin-bottom: 20rpx;
}

@keyframes spin {
	0% { transform: rotate(0deg); }
	100% { transform: rotate(360deg); }
}

.loading-text {
	font-size: 28rpx;
	color: #909399;
}

/* ==================== å†…å®¹åŒºåŸŸ ==================== */
.content-scroll {
	flex: 1;
}

.content-wrapper {
	padding: 30rpx;
}

/* ==================== ğŸ†• é˜¶æ®µæç¤ºå¡ç‰‡ ==================== */
.stage-hint-card {
	background: linear-gradient(135deg, #FFF7ED 0%, #FFEDD5 100%);
	border-radius: 16rpx;
	padding: 24rpx;
	margin-bottom: 24rpx;
	border: 2rpx solid rgba(245, 158, 11, 0.3);
	flex-direction: row;
	align-items: flex-start;
}

.stage-hint-icon {
	width: 48rpx;
	height: 48rpx;
	background-color: #F59E0B;
	border-radius: 24rpx;
	align-items: center;
	justify-content: center;
	margin-right: 20rpx;
	flex-shrink: 0;
}

.stage-hint-icon .fa {
	font-size: 26rpx;
	color: #FFFFFF;
}

.stage-hint-content {
	flex: 1;
}

.stage-hint-title {
	font-size: 28rpx;
	font-weight: 600;
	color: #92400E;
	margin-bottom: 8rpx;
}

.stage-hint-desc {
	font-size: 24rpx;
	color: #B45309;
	line-height: 1.5;
}

/* ==================== ä¿¡æ¯å¡ç‰‡ ==================== */
.info-card {
	background-color: #FFFFFF;
	border-radius: 16rpx;
	padding: 30rpx;
	margin-bottom: 24rpx;
	box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);
	position: relative;
}

.info-card.warning {
	border: 2rpx solid #F56C6C;
	background-color: #FEF0F0;
}

/* çŠ¶æ€æ ‡ç­¾ï¼ˆåˆåŒå¡ç‰‡å³ä¸Šè§’ï¼‰ */
.status-badge {
	position: absolute;
	top: 0;
	right: 0;
	padding: 10rpx 24rpx;
	border-bottom-left-radius: 16rpx;
}

/* ğŸ”§ åˆåŒçŠ¶æ€è§’æ ‡æ–‡å­—ï¼ˆç¡®ä¿ç™½è‰²ï¼‰ */
.status-badge .status-text {
	color: #FFFFFF !important;
	font-size: 24rpx;
	font-weight: 600;
}

/* åˆåŒæ ‡é¢˜ */
.contract-header {
	margin-bottom: 30rpx;
	padding-right: 100rpx;
}

.contract-title {
		font-size: 36rpx;
	font-weight: 600;
	color: #303133;
	line-height: 1.4;
}

/* è¯¦æƒ…è¡Œ */
.detail-section {
	margin-top: 20rpx;
}

.detail-row {
		flex-direction: row;
		align-items: center;
		margin-bottom: 24rpx;
	}
	
.detail-row:last-child {
	margin-bottom: 0;
}

.detail-icon {
		font-size: 26rpx;
	color: #909399;
	width: 40rpx;
}

.detail-label {
	font-size: 28rpx;
	color: #909399;
	width: 140rpx;
}

.detail-value {
		flex: 1;
	font-size: 28rpx;
	color: #303133;
}

/* ==================== å¡ç‰‡æ ‡é¢˜ ==================== */
.card-header {
		flex-direction: row;
		align-items: center;
	margin-bottom: 24rpx;
	padding-bottom: 16rpx;
	border-bottom: 1rpx solid #EBEEF5;
}

.card-icon {
	font-size: 32rpx;
	color: #00C28A;
	margin-right: 12rpx;
}

.card-title {
	font-size: 32rpx;
	font-weight: 600;
	color: #303133;
}

/* ==================== å‚ä¸äººä¿¡æ¯å¡ç‰‡ ==================== */
.participants-card .card-header {
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
}

.header-left {
	flex-direction: row;
	align-items: center;
}

.participant-count {
	background-color: rgba(0, 194, 138, 0.1);
	padding: 6rpx 16rpx;
	border-radius: 20rpx;
}

.count-text {
	font-size: 24rpx;
	color: #00C28A;
	font-weight: 600;
}

/* ==================== å‚ä¸äººåˆ—è¡¨ ==================== */
.participants-list {
	margin-top: 24rpx;
}

/* ğŸ¨ å‚ä¸äººå¡ç‰‡ï¼ˆä¼˜é›…ç®€çº¦ï¼‰ */
.participant-item {
	flex-direction: row;
	align-items: flex-start;
	padding: 24rpx;
	margin-bottom: 20rpx;
	background-color: #FFFFFF;
	border-radius: 16rpx;
	border: 1rpx solid #E5E7EB;
	transition: all 0.3s ease;
	position: relative;
}

.participant-item:last-child {
	margin-bottom: 0;
}

/* ğŸ¨ ä¸åŒçŠ¶æ€çš„å‚ä¸äººå¡ç‰‡æ ·å¼ï¼ˆä¼˜é›…æŸ”å’Œï¼‰ */
.participant-item.signed {
	border-color: rgba(16, 185, 129, 0.15);
	background-color: rgba(236, 253, 245, 0.5);
}

.participant-item.form-filled {
	border-color: rgba(59, 130, 246, 0.15);
	background-color: rgba(239, 246, 255, 0.5);
}

.participant-item.pending {
	border-color: rgba(148, 163, 184, 0.12);
	background-color: #FAFBFC;
}

.participant-item.rejected {
	border-color: rgba(239, 68, 68, 0.15);
	background-color: rgba(254, 242, 242, 0.5);
}

/* ==================== å¤´åƒåŒºåŸŸ ==================== */
.participant-avatar {
	position: relative;
	margin-right: 20rpx;
}

.avatar-circle {
	width: 88rpx;
	height: 88rpx;
	border-radius: 44rpx;
	align-items: center;
	justify-content: center;
	background-color: #E4E7ED;
}

/* ğŸ”§ å¤´åƒé¢œè‰²ç°åœ¨é€šè¿‡åŠ¨æ€ style è®¾ç½®ï¼Œä¸å†ä½¿ç”¨å›ºå®šçš„ç±» */
/* ä¿ç•™è¿™äº›ç±»ä»…ç”¨äºå…¼å®¹æ€§ï¼Œä½†ä¸è®¾ç½®èƒŒæ™¯è‰² */
.avatar-circle.avatar-signed,
.avatar-circle.avatar-pending,
.avatar-circle.avatar-rejected {
	/* èƒŒæ™¯è‰²ç”± style å±æ€§åŠ¨æ€è®¾ç½® */
}

.avatar-text {
	font-size: 40rpx;
	color: #FFFFFF;
	font-weight: 600;
	line-height: 1;
}

/* ğŸ¨ ç­¾ç½²é¡ºåºå¾½ç« ï¼ˆä½è°ƒä¼˜é›…ï¼‰ */
.order-badge {
	position: absolute;
	bottom: -4rpx;
	right: -4rpx;
	width: 36rpx;
	height: 36rpx;
	border-radius: 18rpx;
	background-color: #64748B;
	align-items: center;
	justify-content: center;
	border: 3rpx solid #FFFFFF;
}

.order-num {
	font-size: 20rpx;
	color: #FFFFFF;
	font-weight: 600;
	line-height: 1;
}

/* ==================== å‚ä¸äººå†…å®¹åŒº ==================== */
.participant-content {
	flex: 1;
}

.name-row {
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
	margin-bottom: 12rpx;
}

/* ğŸ¨ å‚ä¸äººå§“åï¼ˆä¼˜é›…é€‚ä¸­ï¼‰ */
.participant-name {
	font-size: 28rpx;
	font-weight: 500;
	color: #1F2937;
	flex: 1;
}

/* ==================== çŠ¶æ€æ ‡ç­¾ ==================== */
.status-tag {
	flex-direction: row;
	align-items: center;
	padding: 6rpx 16rpx;
	border-radius: 20rpx;
	background-color: #F5F7FA;
}

/* ğŸ¨ çŠ¶æ€æ ‡ç­¾èƒŒæ™¯ï¼ˆæŸ”å’Œä¼˜é›…ï¼‰ */
.status-tag.status-signed {
	background-color: rgba(16, 185, 129, 0.1);
}

.status-tag.status-form-filled {
	background-color: rgba(59, 130, 246, 0.1);
}

.status-tag.status-form-filling {
	background-color: rgba(245, 158, 11, 0.1);
}

.status-tag.status-pending {
	background-color: rgba(100, 116, 139, 0.08);
}

.status-tag.status-rejected {
	background-color: rgba(239, 68, 68, 0.1);
}

.status-tag.status-cancelled {
	background-color: rgba(100, 116, 139, 0.08);
}

.status-icon {
	font-family: 'Font Awesome 6 Free';
	font-weight: 900;
	font-size: 22rpx;
	margin-right: 6rpx;
}

/* ğŸ¨ çŠ¶æ€å›¾æ ‡é¢œè‰²ï¼ˆç°ä»£ä¼˜é›…ï¼‰ */
.status-tag.status-signed .status-icon {
	color: #10B981;
}

.status-tag.status-form-filled .status-icon {
	color: #3B82F6;
}

.status-tag.status-form-filling .status-icon {
	color: #F59E0B;
}

.status-tag.status-pending .status-icon {
	color: #64748B;
}

.status-tag.status-rejected .status-icon {
	color: #EF4444;
}

.status-tag.status-cancelled .status-icon {
	color: #64748B;
}

.status-text {
	font-size: 24rpx;
	font-weight: 500;
	color: #606266;
}

/* ğŸ¨ çŠ¶æ€æ–‡å­—é¢œè‰²ï¼ˆä¸å›¾æ ‡åè°ƒï¼‰ */
.status-tag.status-signed .status-text {
	color: #10B981;
}

.status-tag.status-form-filled .status-text {
	color: #3B82F6;
}

.status-tag.status-form-filling .status-text {
	color: #F59E0B;
}

.status-tag.status-pending .status-text {
	color: #64748B;
}

.status-tag.status-rejected .status-text {
	color: #EF4444;
}

.status-tag.status-cancelled .status-text {
	color: #64748B;
}

/* ==================== ä¿¡æ¯è¡Œ ==================== */
.info-row {
	display: flex;
	flex-direction: row;
	align-items: center;
	margin-top: 10rpx;
}

/* ğŸ¨ è”ç³»ä¿¡æ¯è¡Œæ ·å¼ï¼ˆæŸ”å’Œè“ï¼‰ */
.info-row.contact-info {
	margin-top: 8rpx;
}

.info-row.contact-info .info-icon {
	color: #3B82F6;
}

.info-row.contact-info .info-text {
	color: #3B82F6;
	font-weight: 500;
}

.info-icon {
	font-family: 'Font Awesome 6 Free';
	font-weight: 900;
	font-size: 24rpx;
	color: #909399;
	margin-right: 10rpx;
	width: 28rpx;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	flex-shrink: 0;
}

.info-text {
	font-size: 26rpx;
	color: #606266;
	flex: 1;
}


/* ==================== ç©ºçŠ¶æ€ ==================== */
.empty-participants {
	padding: 80rpx 0;
	align-items: center;
	justify-content: center;
}

.empty-icon {
	font-family: 'Font Awesome 6 Free';
	font-weight: 900;
	font-size: 80rpx;
	color: #DCDFE6;
	margin-bottom: 24rpx;
	opacity: 0.6;
}

.empty-text {
	font-size: 28rpx;
	color: #909399;
}

/* ==================== æ‹’ç»åŸå›  ==================== */
.reason-content {
	padding: 20rpx;
	background-color: #FFFFFF;
	border-radius: 8rpx;
}

.reason-text {
	font-size: 28rpx;
	color: #F56C6C;
	line-height: 1.6;
}

/* ==================== åº•éƒ¨å®‰å…¨åŒº ==================== */
.bottom-safe-area {
	height: 160rpx;
}

/* ==================== åº•éƒ¨æ“ä½œæ  ==================== */
.bottom-bar {
		position: fixed;
	bottom: 0;
		left: 0;
		right: 0;
	background-color: #FFFFFF;
	padding: 20rpx 30rpx;
	box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);
	flex-direction: row;
	justify-content: space-between;
	align-items: center;
}

.action-btn {
	flex: 1;
	height: 88rpx;
	border-radius: 44rpx;
		flex-direction: row;
		align-items: center;
	justify-content: center;
	margin: 0 8rpx;
}

.action-btn .fa {
	font-size: 28rpx;
	margin-right: 8rpx;
}

.action-text {
	font-size: 30rpx;
	font-weight: 500;
}

/* ä¸»è¦æŒ‰é’® */
.action-btn.primary {
	background-color: #10B981;
}

.action-btn.primary .fa,
.action-btn.primary .action-text {
	color: #FFFFFF;
}

.action-btn.primary:active {
	opacity: 0.9;
}

/* ğŸ†• å¡«å†™è¡¨å•æŒ‰é’® */
.action-btn.form {
	background-color: #F59E0B;
}

.action-btn.form .fa,
.action-btn.form .action-text {
	color: #FFFFFF;
}

.action-btn.form:active {
	opacity: 0.9;
}

/* AIå®¡æŸ¥æŒ‰é’® */
.action-btn.audit {
	background-color: #1890FF;
}

.action-btn.audit .fa,
.action-btn.audit .action-text {
	color: #FFFFFF;
}

.action-btn.audit:active {
	opacity: 0.9;
}

/* æ¬¡è¦æŒ‰é’® */
.action-btn.secondary {
	background-color: #F5F7FA;
	border: 1rpx solid #DCDFE6;
}

.action-btn.secondary .fa,
.action-btn.secondary .action-text {
	color: #606266;
}

/* å±é™©æŒ‰é’® */
.action-btn.danger {
	background-color: #FEF0F0;
	border: 1rpx solid #F56C6C;
}

.action-btn.danger .fa,
.action-btn.danger .action-text {
	color: #F56C6C;
	}
</style>
