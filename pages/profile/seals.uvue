<script>
	/**
	 * å°ç« ç®¡ç†é¡µé¢
	 * æ”¯æŒä¸ªäººå°ç« å’Œä¼ä¸šå°ç« çš„æŸ¥çœ‹å’Œç®¡ç†
	 */
	import { getSealPage, deleteSeal, getSealTypeName, SealType, SealInfo, PageParams } from '../../api/seals/index';
	import { getEnterpriseList, Enterprise, EnterpriseListResponse } from '../../api/enterprise/index';

	// ä¼ä¸šå°ç« åˆ†ç»„æ¥å£
	interface EnterpriseSealGroup {
		enterpriseId: string;
		enterpriseName: string;
		sealCount: number;
		seals: SealInfo[];
		isExpanded: boolean;
	}

export default {
	data() {
		return {
			// Tabåˆ‡æ¢ï¼š'personal' | 'enterprise'
			activeTab: 'personal' as string,
			
			// ä¸ªäººå°ç« åˆ—è¡¨
			personalSealList: [] as SealInfo[],
			
			// ä¼ä¸šå°ç« åˆ†ç»„åˆ—è¡¨
			enterpriseSealGroups: [] as EnterpriseSealGroup[],
			
			// æ˜¯å¦æ­£åœ¨åŠ è½½æ•°æ®
			loading: true,

			// åˆ†é¡µç›¸å…³ï¼ˆä¸ªäººå°ç« ï¼‰
			personalPageNo: 1,
			personalPageSize: 10,
			personalHasMore: false,
			personalTotal: 0,
			
		// ä¼ä¸šå°ç« åŠ è½½çŠ¶æ€
		enterpriseLoaded: false,
		
		// ğŸ¯ ä¼ä¸šå°ç« ç¼“å­˜ï¼ˆé¿å…é‡å¤åŠ è½½ï¼‰
		enterpriseSealCache: [] as EnterpriseSealGroup[],
		enterpriseCacheTime: 0,
		ENTERPRISE_CACHE_EXPIRY: 30 * 1000, // 30ç§’ç¼“å­˜è¿‡æœŸæ—¶é—´
			
			// æœç´¢æ–‡æœ¬
			searchText: '',
			
		// çŠ¶æ€ç­›é€‰ï¼ˆnullè¡¨ç¤ºæ˜¾ç¤ºå…¨éƒ¨ï¼Œ0=å¯ç”¨ï¼Œ1=åœç”¨ï¼Œ2=å·²ä½œåºŸï¼‰
		statusFilter: null as number | null,
		
		// é€‰ä¸­çš„å°ç« ï¼ˆç”¨äºæ˜¾ç¤ºè¯¦æƒ…å¼¹çª—ï¼‰
		selectedSeal: null as SealInfo | null,
		showDetailModal: false,
			
			// ä¸ªäººå°ç« æ•°é‡ä¸Šé™
			MAX_PERSONAL_SEALS: 10,
			
			// âœ… æ ‡è®°é¡µé¢æ˜¯å¦é¦–æ¬¡åŠ è½½ï¼ˆç”¨äºåŒºåˆ†onLoadå’ŒonShowï¼‰
			isFirstLoad: true,

			// æ–°å¢ï¼šæ§åˆ¶scroll-viewçš„ä¸‹æ‹‰åˆ·æ–°çŠ¶æ€
			isRefreshing: false,

			// åˆ†é¡µç›¸å…³
			personalListPage: {
				pageNo: 1,
				pageSize: 10,
				total: 0,
				loading: false,
				finished: false,
			},
		}
	},
	
	computed: {
		// æ˜¯å¦å·²è¾¾ä¸ªäººå°ç« ä¸Šé™
		isPersonalSealLimitReached(): boolean {
			return this.personalTotal >= this.MAX_PERSONAL_SEALS;
		},

		// åˆ¤æ–­ä¸ªäººå°ç« æ˜¯å¦åŠ è½½å®Œæˆ
		isPersonalSealFinished(): boolean {
			return this.personalSealList.length >= this.personalListPage.total;
		},
	},
		
	onLoad() {
		console.log('[å°ç« ç®¡ç†] onLoad: é¡µé¢åŠ è½½');
		// åŠ è½½ä¸ªäººå°ç« åˆ—è¡¨ï¼ˆé»˜è®¤Tabï¼‰
		this.loadPersonalSeals(true);
		
		// ç›‘å¬å…¨å±€åˆ·æ–°äº‹ä»¶ï¼ˆç”±å°ç« åˆ›å»ºé¡µé¢è§¦å‘ï¼‰
		uni.$on('refreshSealList', () => {
			console.log('[å°ç« ç®¡ç†] æ”¶åˆ°åˆ·æ–°äº‹ä»¶');
			this.refreshList();
		});
	},
	
	onReady() {
		console.log('[å°ç« ç®¡ç†] onReady: é¡µé¢å‡†å¤‡å®Œæ¯•');
		// ä½¿ç”¨ flex å¸ƒå±€ï¼Œä¸éœ€è¦æ‰‹åŠ¨è®¡ç®—é«˜åº¦
	},
	
	onShow() {
		console.log('[å°ç« ç®¡ç†] onShow: é¡µé¢æ˜¾ç¤º, isFirstLoad:', this.isFirstLoad);
		
		// âœ… å¦‚æœä¸æ˜¯é¦–æ¬¡åŠ è½½ï¼Œåˆ™åˆ·æ–°æ•°æ®ï¼ˆå¤„ç†ä»å…¶ä»–é¡µé¢è¿”å›çš„æƒ…å†µï¼‰
		if (!this.isFirstLoad) {
			console.log('[å°ç« ç®¡ç†] onShow: éé¦–æ¬¡åŠ è½½ï¼Œåˆ·æ–°åˆ—è¡¨');
			// ä½¿ç”¨çŸ­å»¶è¿Ÿç¡®ä¿é¡µé¢å®Œå…¨æ˜¾ç¤ºåå†åˆ·æ–°
			setTimeout(() => {
				this.refreshList();
			}, 100);
		} else {
			console.log('[å°ç« ç®¡ç†] onShow: é¦–æ¬¡åŠ è½½ï¼Œè·³è¿‡åˆ·æ–°ï¼ˆç”±onLoadå¤„ç†ï¼‰');
			// æ ‡è®°ä¸ºéé¦–æ¬¡åŠ è½½
			this.isFirstLoad = false;
		}
	},
	
	onUnload() {
		console.log('[å°ç« ç®¡ç†] onUnload: é¡µé¢å¸è½½');
		// å–æ¶ˆå…¨å±€äº‹ä»¶ç›‘å¬
		uni.$off('refreshSealList');
		// âœ… é‡ç½®é¦–æ¬¡åŠ è½½æ ‡è®°
		this.isFirstLoad = true;
	},
		
	onPullDownRefresh() {
		console.log('[å°ç« ç®¡ç†] onPullDownRefresh: ä¸‹æ‹‰åˆ·æ–°');
		this.refreshList();
	},
	
	// é¡µé¢æ»šåŠ¨åˆ°åº•éƒ¨
	onReachBottom() {
		console.log('[å°ç« ç®¡ç†] onReachBottom: é¡µé¢è§¦åº•');
		// åªæœ‰ä¸ªäººå°ç« Tabæ”¯æŒåˆ†é¡µåŠ è½½
		if (this.activeTab === 'personal') {
			this.loadMore();
		}
	},
	
	methods: {
			// Tabåˆ‡æ¢
			switchTab(tab: string) {
				if (this.activeTab === tab) return;
				
			console.log('[å°ç« ç®¡ç†] åˆ‡æ¢Tab:', tab);
				this.activeTab = tab;
				
				if (tab === 'personal') {
					// åˆ‡æ¢åˆ°ä¸ªäººå°ç« ï¼Œé‡æ–°åŠ è½½
					this.loadPersonalSeals(true);
				} else if (tab === 'enterprise') {
				// âœ… ä¿®å¤ï¼šæ¯æ¬¡åˆ‡æ¢åˆ°ä¼ä¸šå°ç« éƒ½é‡æ–°åŠ è½½ï¼Œç¡®ä¿æ•°æ®æœ€æ–°
				console.log('[å°ç« ç®¡ç†] åŠ è½½ä¼ä¸šå°ç« ');
						this.loadEnterpriseSeals();
				}
			},
			
			// æŒ‰çŠ¶æ€ç­›é€‰å°ç« 
			filterByStatus(status: number | null) {
				this.statusFilter = status;
				// é‡æ–°åŠ è½½å°ç« åˆ—è¡¨
				this.loadPersonalSeals(true);
			},
			
			// åŠ è½½ä¸ªäººå°ç« åˆ—è¡¨
			async loadPersonalSeals(refresh: boolean = false) {
				// é‡ç½®çŠ¶æ€
				if (refresh) {
					this.personalPageNo = 1;
					this.personalSealList = [];
				}
				
				this.loading = true;
				
				try {
				// âœ… ä¿®å¤ï¼šåç«¯é€šè¿‡ enterpriseId æ˜¯å¦ä¸ºnullæ¥åˆ¤æ–­æŸ¥è¯¢ä¸ªäººè¿˜æ˜¯ä¼ä¸šå°ç« 
				// - enterpriseId == null: æŸ¥è¯¢ä¸ªäººå°ç« ï¼ˆåç«¯ä¼šè‡ªåŠ¨è®¾ç½® userIdï¼‰
				// - enterpriseId != null: æŸ¥è¯¢ä¼ä¸šå°ç« 
					const params: PageParams = {
						pageNo: this.personalPageNo,
						pageSize: this.personalPageSize,
					// âŒ ä¸ä¼  ownerTypeï¼Œåç«¯ä¸æ”¯æŒæ­¤å‚æ•°
					// âŒ ä¸ä¼  enterpriseIdï¼Œåç«¯ä¼šè‡ªåŠ¨æŸ¥è¯¢ä¸ªäººå°ç« 
					};
					
					// æ·»åŠ å¯é€‰æœç´¢æ¡ä»¶
					if (this.searchText) {
						params.name = this.searchText;
					}
					
					// æ·»åŠ çŠ¶æ€ç­›é€‰
					if (this.statusFilter !== null) {
						params.status = this.statusFilter;
					}
				
				console.log('[ä¸ªäººå°ç« ] è¯·æ±‚å‚æ•°:', params);
					
					// è°ƒç”¨APIè·å–ä¸ªäººå°ç« åˆ—è¡¨
					const response = await getSealPage(params);
				
				console.log('[ä¸ªäººå°ç« ] å“åº”æ•°æ®:', {
					total: response.total,
					listLength: response.list ? response.list.length : 0
				});
				
				// ğŸ” è°ƒè¯•ï¼šæ‰“å°ç¬¬ä¸€ä¸ªå°ç« çš„å®Œæ•´æ•°æ®ï¼ˆåŒ…æ‹¬ status å­—æ®µï¼‰
				if (response.list && response.list.length > 0) {
					console.log('[ä¸ªäººå°ç« ] ç¬¬ä¸€ä¸ªå°ç« æ•°æ®ç¤ºä¾‹:', response.list[0]);
					console.log('[ä¸ªäººå°ç« ] status å­—æ®µå€¼:', response.list[0].status);
				}
					
					// æ›´æ–°åˆ—è¡¨æ•°æ®
					if (refresh) {
						this.personalSealList = response.list;
					} else {
						// è¿½åŠ æ•°æ®
						this.personalSealList.push(...response.list);
					}
					
					// æ›´æ–°åˆ†é¡µä¿¡æ¯
					this.personalTotal = response.total;
					this.personalHasMore = this.personalSealList.length < response.total;
					
					if (this.personalHasMore) {
						this.personalPageNo++;
					}
					
					console.log('ä¸ªäººå°ç« åˆ—è¡¨åŠ è½½æˆåŠŸ:', {
						total: this.personalTotal,
						loaded: this.personalSealList.length,
						hasMore: this.personalHasMore
					});
				} catch (error) {
					console.error('åŠ è½½ä¸ªäººå°ç« åˆ—è¡¨å¤±è´¥:', error);
					uni.showToast({
						title: 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•',
						icon: 'none'
					});
				} finally {
					this.loading = false;
				}
			},
			
		// åŠ è½½ä¼ä¸šå°ç« åˆ—è¡¨
		async loadEnterpriseSeals(forceRefresh: boolean = false) {
	console.log('[ä¼ä¸šå°ç« ] ========== å¼€å§‹åŠ è½½ä¼ä¸šå°ç«  ==========');
	
	// ğŸ¯ æ£€æŸ¥ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ
	const now = Date.now();
	const cacheValid = (now - this.enterpriseCacheTime) < this.ENTERPRISE_CACHE_EXPIRY;
	
	if (!forceRefresh && cacheValid && this.enterpriseSealCache.length > 0) {
		console.log('[ä¼ä¸šå°ç« ] âœ… ä½¿ç”¨ç¼“å­˜æ•°æ®ï¼ˆç¼“å­˜æ—¶é—´:', Math.floor((now - this.enterpriseCacheTime) / 1000), 'ç§’ï¼‰');
		this.enterpriseSealGroups = this.enterpriseSealCache;
		this.enterpriseLoaded = true;
		this.loading = false;
		return;
	}
	
	console.log('[ä¼ä¸šå°ç« ] ğŸ”„ ç¼“å­˜', cacheValid ? 'å¤±æ•ˆ' : 'ä¸å­˜åœ¨', 'ï¼Œé‡æ–°åŠ è½½æ•°æ®');
			this.loading = true;
			
	// âœ… é‡ç½®çŠ¶æ€
	this.enterpriseSealGroups = [];
	this.enterpriseLoaded = false;
		
		try {
			console.log('[ä¼ä¸šå°ç« ] æ­¥éª¤1: è·å–ç”¨æˆ·æ‰€å±ä¼ä¸šåˆ—è¡¨');
			
			// âœ… æ­¥éª¤1ï¼šè·å–ç”¨æˆ·æ‰€å±çš„ä¼ä¸šåˆ—è¡¨
			// æ³¨æ„ï¼šrequest å‡½æ•°å·²ç»è§£åŒ…äº† dataï¼Œæ‰€ä»¥ enterprisesResponse å°±æ˜¯ data çš„å†…å®¹
			const enterprisesResponse = await getEnterpriseList();
			console.log('[ä¼ä¸šå°ç« ] APIå“åº”æ•°æ®ç±»å‹:', typeof enterprisesResponse);
			console.log('[ä¼ä¸šå°ç« ] APIå“åº”æ•°æ®:', JSON.stringify(enterprisesResponse));
			
			// âœ… ä¿®å¤ï¼šrequest å‡½æ•°è¿”å›çš„æ˜¯ responseData.dataï¼Œä¸æ˜¯æ•´ä¸ªå“åº”
			// æ‰€ä»¥ enterprisesResponse = { list: [], activeEnterprise: {} }
			let enterprises: Enterprise[] = [];
			
			// å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿å“åº”å­˜åœ¨
			if (!enterprisesResponse) {
				console.error('[ä¼ä¸šå°ç« ] âŒ API å“åº”ä¸ºç©º');
				this.enterpriseSealGroups = [];
				this.enterpriseLoaded = true;
				this.loading = false;
				return;
			}
			
			const responseData = enterprisesResponse as any;
			console.log('[ä¼ä¸šå°ç« ] responseData ç±»å‹:', typeof responseData);
			console.log('[ä¼ä¸šå°ç« ] responseData.list å­˜åœ¨?', !!responseData.list);
			console.log('[ä¼ä¸šå°ç« ] responseData.activeEnterprise å­˜åœ¨?', !!responseData.activeEnterprise);
			
			// åˆ¤æ–­æ•°æ®ç»“æ„å¹¶æå–ä¼ä¸šåˆ—è¡¨
			if (responseData.list && Array.isArray(responseData.list)) {
				// æƒ…å†µ1ï¼šæœ‰ list å­—æ®µ
				enterprises = responseData.list;
				console.log('[ä¼ä¸šå°ç« ] âœ… ä» list è·å–ä¼ä¸šåˆ—è¡¨, æ•°é‡:', enterprises.length);
			} else if (responseData.activeEnterprise) {
				// æƒ…å†µ2ï¼šåªæœ‰ activeEnterpriseï¼Œåˆ›å»ºå•å…ƒç´ æ•°ç»„
				enterprises = [responseData.activeEnterprise];
				console.log('[ä¼ä¸šå°ç« ] âœ… ä» activeEnterprise è·å–å½“å‰ä¼ä¸š');
			} else if (Array.isArray(responseData)) {
				// æƒ…å†µ3ï¼šå“åº”æœ¬èº«æ˜¯æ•°ç»„ï¼ˆå…¼å®¹æ—§APIï¼‰
				enterprises = responseData;
				console.log('[ä¼ä¸šå°ç« ] âœ… å“åº”æœ¬èº«æ˜¯æ•°ç»„, æ•°é‡:', enterprises.length);
			} else {
				console.warn('[ä¼ä¸šå°ç« ] âš ï¸ æ— æ³•è¯†åˆ«çš„æ•°æ®ç»“æ„:', responseData);
			}
			
			console.log('[ä¼ä¸šå°ç« ] æœ€ç»ˆè§£æåˆ°çš„ä¼ä¸šæ•°é‡:', enterprises.length);
			if (enterprises.length > 0) {
				console.log('[ä¼ä¸šå°ç« ] ä¼ä¸šåˆ—è¡¨:', enterprises);
			}
			
			if (enterprises.length === 0) {
				console.log('[ä¼ä¸šå°ç« ] âŒ ç”¨æˆ·æ²¡æœ‰æ‰€å±ä¼ä¸šï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€');
				this.enterpriseSealGroups = [];
				this.enterpriseLoaded = true;
				this.loading = false;
				return;
			}
			
			console.log('[ä¼ä¸šå°ç« ] âœ… ä¼ä¸šåˆ—è¡¨:', enterprises);
				
				// âœ… åˆ›å»ºä¼ä¸šIDåˆ°åç§°çš„æ˜ å°„
				const enterpriseMap = new Map<number, string>();
				enterprises.forEach(e => {
					enterpriseMap.set(e.id, e.name);
				});
				
			// ğŸ¯ æ­¥éª¤2ï¼šå¹¶å‘æŸ¥è¯¢æ‰€æœ‰ä¼ä¸šçš„å°ç« ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
			console.log('[ä¼ä¸šå°ç« ] æ­¥éª¤2: å¼€å§‹å¹¶å‘æŸ¥è¯¢æ‰€æœ‰ä¼ä¸šçš„å°ç« , æ€»æ•°:', enterprises.length);
			const groupMap = new Map<number, EnterpriseSealGroup>();
			
			// âœ… ä½¿ç”¨ Promise.all å¹¶å‘è¯·æ±‚ï¼Œè€Œä¸æ˜¯ä¸²è¡Œå¾ªç¯
			const sealPromises = enterprises.map(async (enterprise, index) => {
				console.log(`[ä¼ä¸šå°ç« ] [${index+1}/${enterprises.length}] æŸ¥è¯¢ä¼ä¸šå°ç« :`, {
					enterpriseId: enterprise.id,
					enterpriseName: enterprise.name
				});
				
				const params: PageParams = {
					pageNo: 1,
					pageSize: 100,
					enterpriseId: enterprise.id
				};
				
				try {
					const response = await getSealPage(params);
					
					console.log(`[ä¼ä¸šå°ç« ] [${index+1}/${enterprises.length}] APIå“åº”:`, {
						enterpriseId: enterprise.id,
						total: response.total,
						listLength: response.list ? response.list.length : 0
					});
					
				// ğŸ¯ ä¸¥æ ¼è¿‡æ»¤ï¼šåªä¿ç•™å±äºå½“å‰ä¼ä¸šçš„å°ç« 
				if (response.list && response.list.length > 0) {
					// âœ… è¿‡æ»¤æ‰ enterpriseId ä¸åŒ¹é…çš„å°ç« ï¼ˆé˜²æ­¢ä¸ªäººå°ç« æ··å…¥ï¼‰
					const validSeals = response.list.filter(seal => 
						seal.enterpriseId && Number(seal.enterpriseId) === Number(enterprise.id)
					);
					
					console.log(`[ä¼ä¸šå°ç« ] [${index+1}/${enterprises.length}] è¿‡æ»¤åçš„å°ç« æ•°:`, validSeals.length, '/', response.list.length);
					
					// å¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„å°ç« ï¼Œè¿”å›null
					if (validSeals.length === 0) {
						console.log(`[ä¼ä¸šå°ç« ] [${index+1}/${enterprises.length}] âš ï¸ è¿‡æ»¤åæ²¡æœ‰æœ‰æ•ˆå°ç« `);
						return null;
					}
					
					// ä¸ºæ¯ä¸ªå°ç« å¡«å……ä¼ä¸šåç§°
					validSeals.forEach(seal => {
						seal.enterpriseName = enterprise.name;
					});
					
					return {
						enterpriseId: enterprise.id.toString(),
						enterpriseName: enterprise.name,
						sealCount: validSeals.length,
						seals: validSeals,
						isExpanded: false
					} as EnterpriseSealGroup;
					} else {
						console.log(`[ä¼ä¸šå°ç« ] [${index+1}/${enterprises.length}] âš ï¸ è¯¥ä¼ä¸šæ²¡æœ‰å°ç« `);
						return null;
					}
				} catch (error) {
					console.error(`[ä¼ä¸šå°ç« ] [${index+1}/${enterprises.length}] âŒ æŸ¥è¯¢å¤±è´¥:`, error);
					return null;
				}
			});
			
			// ğŸ¯ ç­‰å¾…æ‰€æœ‰è¯·æ±‚å®Œæˆ
			console.log('[ä¼ä¸šå°ç« ] â³ ç­‰å¾…', enterprises.length, 'ä¸ªå¹¶å‘è¯·æ±‚å®Œæˆ...');
			const sealGroups = await Promise.all(sealPromises);
			console.log('[ä¼ä¸šå°ç« ] âœ… æ‰€æœ‰è¯·æ±‚å·²å®Œæˆ');
			
			// è¿‡æ»¤æ‰nullå€¼å¹¶æ·»åŠ åˆ°map
			sealGroups.forEach(group => {
				if (group) {
					groupMap.set(Number(group.enterpriseId), group);
				}
			});
			
			console.log('[ä¼ä¸šå°ç« ] æ­¥éª¤3: æ‰€æœ‰ä¼ä¸šå°ç« æŸ¥è¯¢å®Œæˆï¼Œåˆ†ç»„æ•°é‡:', groupMap.size);
					
					// è½¬æ¢ä¸ºæ•°ç»„ï¼Œå¹¶é»˜è®¤å±•å¼€ç¬¬ä¸€ä¸ª
					const groups = Array.from(groupMap.values());
				console.log('[ä¼ä¸šå°ç« ] æ­¥éª¤4: è½¬æ¢åˆ†ç»„ä¸ºæ•°ç»„ï¼Œæ•°é‡:', groups.length);
				
					if (groups.length > 0) {
						groups[0].isExpanded = true;
					console.log('[ä¼ä¸šå°ç« ] æ­¥éª¤5: é»˜è®¤å±•å¼€ç¬¬ä¸€ä¸ªä¼ä¸š:', groups[0].enterpriseName);
					}
					
					this.enterpriseSealGroups = groups;
					this.enterpriseLoaded = true;
					
					// ğŸ¯ ä¿å­˜åˆ°ç¼“å­˜
					this.enterpriseSealCache = groups;
					this.enterpriseCacheTime = Date.now();
					console.log('[ä¼ä¸šå°ç« ] âœ… æ•°æ®å·²ç¼“å­˜');
					
				console.log('[ä¼ä¸šå°ç« ] ========== åŠ è½½å®Œæˆ ==========');
				console.log('[ä¼ä¸šå°ç« ] æœ€ç»ˆç»“æœ:', {
					enterpriseCount: enterprises.length,
						groupCount: groups.length,
					totalSeals: groups.reduce((sum, g) => sum + g.sealCount, 0),
					groups: groups
					});
				} catch (error) {
				console.error('[ä¼ä¸šå°ç« ] âŒâŒâŒ åŠ è½½å¤±è´¥ âŒâŒâŒ');
				console.error('[ä¼ä¸šå°ç« ] é”™è¯¯è¯¦æƒ…:', error);
					uni.showToast({
						title: 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•',
						icon: 'none'
					});
				} finally {
				console.log('[ä¼ä¸šå°ç« ] finally: è®¾ç½® loading = false');
					this.loading = false;
				}
			},
			
			// åˆ·æ–°åˆ—è¡¨
			async refreshList() {
				console.log('[å°ç« ç®¡ç†] refreshList: å¼€å§‹åˆ·æ–°, activeTab:', this.activeTab);
				try {
				if (this.activeTab === 'personal') {
						await this.loadPersonalSeals(true);
				} else {
						// ğŸ¯ åˆ·æ–°æ—¶å¼ºåˆ¶é‡æ–°åŠ è½½ï¼Œæ¸…é™¤ç¼“å­˜
						await this.loadEnterpriseSeals(true);
					}
					console.log('[å°ç« ç®¡ç†] refreshList: åˆ·æ–°å®Œæˆ');
				} catch (error) {
					console.error('[å°ç« ç®¡ç†] refreshList: åˆ·æ–°å¤±è´¥', error);
					uni.showToast({
						title: 'åˆ·æ–°å¤±è´¥ï¼Œè¯·é‡è¯•',
						icon: 'none'
					});
				} finally {
					// âœ… å®‰å…¨ä¿éšœï¼šç¡®ä¿ä¸‹æ‹‰åˆ·æ–°åŠ¨ç”»ä¸€å®šä¼šåœæ­¢
					console.log('[å°ç« ç®¡ç†] refreshList: finally - åœæ­¢ä¸‹æ‹‰åˆ·æ–°');
					this.isRefreshing = false; // å…³é—­scroll-viewçš„åˆ·æ–°åŠ¨ç”»
				}
			},
			
			// åŠ è½½æ›´å¤šï¼ˆä»…ä¸ªäººå°ç« æ”¯æŒï¼‰
			loadMore() {
				if (this.activeTab === 'personal' && this.personalHasMore && !this.loading) {
					this.loadPersonalSeals();
				}
			},
			
			// åˆ‡æ¢ä¼ä¸šåˆ†ç»„å±•å¼€/æŠ˜å 
			toggleGroup(group: EnterpriseSealGroup) {
				group.isExpanded = !group.isExpanded;
			},
			
			// æŸ¥çœ‹å°ç« è¯¦æƒ…
			viewSealDetail(seal: SealInfo) {
				this.selectedSeal = seal;
				this.showDetailModal = true;
			},
			
		// å…³é—­å°ç« è¯¦æƒ…å¼¹çª—
		closeDetailModal() {
			this.showDetailModal = false;
			this.selectedSeal = null;
		},
		
		// ä»å¼¹çª—ä¸­åˆ é™¤å°ç« 
		deleteSealFromModal() {
			if (!this.selectedSeal) return;
			
			// å…³é—­å¼¹çª—
			this.closeDetailModal();
			
			// ç¨å¾®å»¶è¿Ÿåè°ƒç”¨åˆ é™¤æ–¹æ³•ï¼Œç¡®ä¿å¼¹çª—å…³é—­åŠ¨ç”»å®Œæˆ
			setTimeout(() => {
				if (this.selectedSeal) {
					this.deleteSealItem(this.selectedSeal);
				}
			}, 300);
		},
		
		// åˆ›å»ºä¸ªäººå°ç« 
		createPersonalSeal() {
			// æ£€æŸ¥æ˜¯å¦å·²è¾¾ä¸Šé™
			if (this.isPersonalSealLimitReached) {
				uni.showModal({
					title: 'æç¤º',
					content: `ä¸ªäººå°ç« æ•°é‡å·²è¾¾ä¸Šé™ï¼ˆ${this.MAX_PERSONAL_SEALS}ä¸ªï¼‰ï¼Œè¯·å…ˆåˆ é™¤æ—§å°ç« åå†åˆ›å»ºæ–°å°ç« ã€‚`,
					showCancel: false,
					confirmText: 'æˆ‘çŸ¥é“äº†'
				});
				return;
			}
			
			// è·³è½¬åˆ°å°ç« åˆ›å»ºé¡µé¢
			uni.navigateTo({
				url: '/pages/profile/seal-create'
			});
		},
			
			// åˆ é™¤å°ç« 
			deleteSealItem(seal: SealInfo) {
				uni.showModal({
					title: 'åˆ é™¤å°ç« ',
					content: `ç¡®å®šè¦åˆ é™¤å°ç« "${seal.name}"å—ï¼Ÿ`,
					success: async (res) => {
						if (res.confirm) {
							try {
								uni.showLoading({
									title: 'åˆ é™¤ä¸­...'
								});
								
								await deleteSeal(seal.id!);
								
								uni.hideLoading();
								uni.showToast({
									title: 'åˆ é™¤æˆåŠŸ',
									icon: 'success'
								});
								
								// åˆ·æ–°åˆ—è¡¨
								this.refreshList();
							} catch (error) {
								console.error('åˆ é™¤å°ç« å¤±è´¥:', error);
								uni.hideLoading();
								uni.showToast({
									title: 'åˆ é™¤å¤±è´¥ï¼Œè¯·é‡è¯•',
									icon: 'none'
								});
							}
						}
					}
				});
			},
			
	// æ ¼å¼åŒ–æ—¥æœŸ
	formatDate(dateInput?: string | number): string {
		if (!dateInput) {
			console.log('[å°ç« ç®¡ç†] formatDate: è¾“å…¥ä¸ºç©º');
			return 'æœªçŸ¥æ—¶é—´';
		}
		
		try {
			console.log('[å°ç« ç®¡ç†] formatDate è¾“å…¥:', dateInput, 'ç±»å‹:', typeof dateInput);
			let date: Date;
			
			// æ”¯æŒæ—¶é—´æˆ³æ ¼å¼ï¼ˆæ¯«ç§’ï¼‰
			if (typeof dateInput === 'number' || /^\d+$/.test(dateInput as string)) {
				const timestamp = typeof dateInput === 'number' ? dateInput : parseInt(dateInput as string);
				console.log('[å°ç« ç®¡ç†] è§£ææ—¶é—´æˆ³:', timestamp);
				date = new Date(timestamp);
			} else {
				// æ”¯æŒISOå­—ç¬¦ä¸²æ ¼å¼
				console.log('[å°ç« ç®¡ç†] è§£æISOå­—ç¬¦ä¸²:', dateInput);
				date = new Date(dateInput as string);
			}
			
			// æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
			if (isNaN(date.getTime())) {
				console.error('[å°ç« ç®¡ç†] æ— æ•ˆçš„æ—¥æœŸ:', dateInput);
				return 'æœªçŸ¥æ—¶é—´';
			}
			
			const year = date.getFullYear();
			const month = String(date.getMonth() + 1).padStart(2, '0');
			const day = String(date.getDate()).padStart(2, '0');
			const hours = String(date.getHours()).padStart(2, '0');
			const minutes = String(date.getMinutes()).padStart(2, '0');
			
			const result = `${year}-${month}-${day} ${hours}:${minutes}`;
			console.log('[å°ç« ç®¡ç†] æ ¼å¼åŒ–ç»“æœ:', result);
			return result;
		} catch (error) {
			console.error('[å°ç« ç®¡ç†] æ—¥æœŸæ ¼å¼åŒ–é”™è¯¯:', error);
			return 'æœªçŸ¥æ—¶é—´';
		}
	},
		
	// è·å–å°ç« å›¾ç‰‡URLï¼ˆå…¼å®¹å¤šç§å­—æ®µåï¼Œä¼˜å…ˆä½¿ç”¨ sealDataï¼‰
		getSealImageUrl(seal: SealInfo): string {
		if (!seal) {
			return '/static/images/empty-signature.png';
		}
		// ä¼˜å…ˆä½¿ç”¨ sealDataï¼ˆåç«¯è¿”å›çš„æ ‡å‡†å­—æ®µåï¼‰
			return seal.sealData || seal.imageUrl || seal.image || '/static/images/empty-signature.png';
		},
			
			// è·å–å°ç« ç±»å‹åç§°
			getSealTypeName(type: SealType): string {
				return getSealTypeName(type);
			},
			
			// è·å–å°ç« çŠ¶æ€åç§°
			getStatusName(status: number | undefined): string {
				// ğŸ”§ å¦‚æœ status æœªå®šä¹‰ï¼Œé»˜è®¤ä¸ºå¯ç”¨çŠ¶æ€
				if (status === undefined || status === null) {
					console.warn('[å°ç« çŠ¶æ€] status æœªå®šä¹‰ï¼Œé»˜è®¤ä¸ºå¯ç”¨');
					return 'å¯ç”¨';
				}
				
				switch (status) {
					case 0:
						return 'å¯ç”¨';
					case 1:
						return 'åœç”¨';
					case 2:
						return 'å·²ä½œåºŸ';
					default:
						console.warn('[å°ç« çŠ¶æ€] æœªçŸ¥çŠ¶æ€å€¼:', status);
						return 'æœªçŸ¥';
				}
			},
			
			// è·å–çŠ¶æ€æ ·å¼ç±»
			getStatusClass(status: number | undefined): string {
				// ğŸ”§ å¦‚æœ status æœªå®šä¹‰ï¼Œé»˜è®¤ä¸ºå¯ç”¨çŠ¶æ€
				if (status === undefined || status === null) {
					return 'status-active';
				}
				
				switch (status) {
					case 0:
						return 'status-active';  // ç»¿è‰²
					case 1:
						return 'status-disabled';  // ç°è‰²
					case 2:
						return 'status-revoked';  // çº¢è‰²
					default:
						return 'status-active';  // é»˜è®¤ç»¿è‰²
				}
			},

			// æ–°å¢ï¼šå¤„ç†scroll-viewçš„ä¸‹æ‹‰åˆ·æ–°äº‹ä»¶
			handleRefresherRefresh() {
				console.log('[å°ç« ç®¡ç†] handleRefresherRefresh: å¼€å§‹ä¸‹æ‹‰åˆ·æ–°');
				this.isRefreshing = true;
				this.refreshList();
			},

			// æ–°å¢ï¼šå¤„ç†ä»å…¶ä»–é¡µé¢è¿”å›åˆ·æ–°åˆ—è¡¨çš„äº‹ä»¶
			handleExternalRefresh() {
				console.log('[å°ç« ç®¡ç†] æ”¶åˆ°å¤–éƒ¨åˆ·æ–°äº‹ä»¶ï¼Œåˆ·æ–°åˆ—è¡¨');
				this.refreshList();
			},

			// æ–°å¢ï¼šåŠ è½½åˆå§‹æ•°æ®ï¼ŒåŒ…æ‹¬ä¸ªäººå’Œä¼ä¸šå°ç« 
			async loadInitialData() {
				await this.loadPersonalSeals(true);
			},
		}
	}
</script>

<template>
	<view class="seal-list-container">
		<!-- å›ºå®šå¤´éƒ¨ -->
		<view class="fixed-header">
			<!-- Tabåˆ‡æ¢å™¨ -->
			<view class="tab-switcher">
				<view 
					class="tab-item" 
					:class="{ active: activeTab === 'personal' }"
					@click="switchTab('personal')"
				>
					<text class="tab-text">ä¸ªäººå°ç« </text>
					<view class="tab-indicator" v-if="activeTab === 'personal'"></view>
				</view>
				<view 
					class="tab-item" 
					:class="{ active: activeTab === 'enterprise' }"
					@click="switchTab('enterprise')"
				>
					<text class="tab-text">ä¼ä¸šå°ç« </text>
					<view class="tab-indicator" v-if="activeTab === 'enterprise'"></view>
				</view>
			</view>
			
			<!-- çŠ¶æ€ç­›é€‰å™¨ï¼ˆä»…ä¸ªäººå°ç« æ˜¾ç¤ºï¼‰ -->
			<view class="status-filter" v-if="activeTab === 'personal'">
				<view 
					class="filter-item" 
					:class="{ active: statusFilter === null }"
					@click="filterByStatus(null)"
				>
					<text class="filter-text">å…¨éƒ¨</text>
				</view>
				<view 
					class="filter-item" 
					:class="{ active: statusFilter === 0 }"
					@click="filterByStatus(0)"
				>
					<text class="filter-text">å¯ç”¨</text>
					<view class="filter-dot status-active"></view>
				</view>
				<view 
					class="filter-item" 
					:class="{ active: statusFilter === 1 }"
					@click="filterByStatus(1)"
				>
					<text class="filter-text">åœç”¨</text>
					<view class="filter-dot status-disabled"></view>
				</view>
				<view 
					class="filter-item" 
					:class="{ active: statusFilter === 2 }"
					@click="filterByStatus(2)"
				>
					<text class="filter-text">å·²ä½œåºŸ</text>
					<view class="filter-dot status-revoked"></view>
				</view>
		</view>
	</view>
	
	<!-- å¯æ»šåŠ¨åŒºåŸŸï¼šä¸ªäººå°ç« Tabå†…å®¹ -->
	<scroll-view
		class="tab-content personal-content"
		v-if="activeTab === 'personal'"
		scroll-y
		@scrolltolower="loadMore"
		lower-threshold="50"
		refresher-enabled="true"
		:refresher-triggered="isRefreshing"
		@refresherrefresh="handleRefresherRefresh"
	>
		<!-- ä¸ªäººå°ç« åˆ—è¡¨ä¸ºç©ºæ—¶æ˜¾ç¤º -->
		<view class="empty-state" v-if="!loading && (!personalSealList || personalSealList.length === 0)">
			<image class="empty-image" src="/static/images/empty-signature.png"></image>
			<text class="empty-text">æš‚æ— ä¸ªäººå°ç« </text>
			<text class="empty-desc">åˆ›å»ºä¸ªäººå°ç« ï¼Œç”¨äºåˆåŒç­¾ç½²</text>
			<view class="empty-btn" @click="createPersonalSeal">
				<text class="empty-btn-text">æ·»åŠ å°ç« </text>
			</view>
		</view>
		
		<!-- ä¸ªäººå°ç« åˆ—è¡¨ -->
		<view class="seal-list" v-else>
			<view 
				class="seal-item" 
				v-for="item in personalSealList" 
				:key="item.id"
				:class="{ disabled: item.status !== 0 }"
				@click="viewSealDetail(item)">
				<view class="seal-image-wrapper">
					<image class="seal-image" :src="getSealImageUrl(item)" mode="aspectFit"></image>
					<view class="status-badge" :class="getStatusClass(item.status)">
						<text class="status-text">{{ getStatusName(item.status) }}</text>
					</view>
				</view>
				<view class="seal-info">
					<view class="seal-name-row">
						<text class="seal-name">{{ item.name }}</text>
					</view>
					<text class="seal-type">{{ getSealTypeName(item.type) }}</text>
					<text class="seal-time">åˆ›å»ºæ—¶é—´: {{ formatDate(item.createTime) }}</text>
				</view>
				<view class="seal-actions">
					<view class="action-delete" @click.stop="deleteSealItem(item)">
						<text class="fa fa-trash action-icon"></text>
					</view>
				</view>
			</view>
			
			<!-- åŠ è½½æ›´å¤š/æ²¡æœ‰æ›´å¤šäº† -->
			<view class="load-more-container" v-if="personalSealList.length > 0">
				<text class="load-more-text" v-if="personalListPage.loading">åŠ è½½ä¸­...</text>
				<text class="load-more-text" v-else-if="isPersonalSealFinished">æ²¡æœ‰æ›´å¤šäº†</text>
			</view>
		</view>
		
		<!-- æ‚¬æµ®æŒ‰é’® -->
		<view 
			class="float-btn" 
			:class="{ disabled: isPersonalSealLimitReached }"
			@click="createPersonalSeal"
			v-if="activeTab === 'personal'"
		>
			<text class="float-btn-icon icon icon-plus"></text>
		</view>
	</scroll-view>

	<!-- å¯æ»šåŠ¨åŒºåŸŸï¼šä¼ä¸šå°ç« Tabå†…å®¹ -->
	<scroll-view
		class="tab-content enterprise-content" 
		v-if="activeTab === 'enterprise'"
		scroll-y
		refresher-enabled="true"
		:refresher-triggered="isRefreshing"
		@refresherrefresh="handleRefresherRefresh"
	>
		<!-- ä¼ä¸šå°ç« åˆ—è¡¨ä¸ºç©ºæ—¶æ˜¾ç¤º -->
		<view class="empty-state" v-if="!loading && (!enterpriseSealGroups || enterpriseSealGroups.length === 0)">
			<image class="empty-image" src="/static/images/empty-signature.png"></image>
			<text class="empty-text">æš‚æ— ä¼ä¸šå°ç« </text>
			<text class="empty-desc">ä¼ä¸šå°ç« ç”±ä¼ä¸šç®¡ç†å‘˜åˆ›å»ºå’Œç®¡ç†</text>
		</view>
		
		<!-- ä¼ä¸šå°ç« åˆ—è¡¨ -->
		<view class="enterprise-seal-section" v-if="!loading && enterpriseSealGroups && enterpriseSealGroups.length > 0">
			<view class="enterprise-group" v-for="group in enterpriseSealGroups" :key="group.enterpriseId">
				<view class="enterprise-name-bar">
					<text class="enterprise-name">{{ group.enterpriseName }}</text>
				</view>
				<view 
					class="seal-item" 
					v-for="item in group.seals" 
					:key="item.id"
					:class="{ disabled: item.status !== 0 }"
					@click="viewSealDetail(item)">
					<view class="seal-image-wrapper">
						<image class="seal-image" :src="getSealImageUrl(item)" mode="aspectFit"></image>
						<view class="status-badge" :class="getStatusClass(item.status)">
							<text class="status-text">{{ getStatusName(item.status) }}</text>
						</view>
					</view>
					<view class="seal-info">
						<view class="seal-name-row">
							<text class="seal-name">{{ item.name }}</text>
						</view>
						<text class="seal-type">{{ getSealTypeName(item.type) }}</text>
						<text class="seal-time">åˆ›å»ºæ—¶é—´: {{ formatDate(item.createTime) }}</text>
					</view>
					<!-- ä¼ä¸šå°ç« æš‚æ—¶æ²¡æœ‰å³ä¾§æ“ä½œ -->
				</view>
			</view>
		</view>
		
		<!-- åŠ è½½ä¸­ -->
		<view class="loading-container" v-if="loading">
			<view class="loading-spinner"></view>
			<text class="loading-text">åŠ è½½ä¸­...</text>
		</view>
	</scroll-view>

	<!-- å°ç« è¯¦æƒ…å¼¹çª— -->
	<view class="modal-overlay" v-if="showDetailModal" @click="closeDetailModal">
		<view class="seal-detail-modal" @click.stop="">
			<view class="modal-header">
				<text class="modal-title">å°ç« è¯¦æƒ…</text>
				<view class="modal-close" @click="closeDetailModal">
					<text class="close-icon icon icon-close"></text>
				</view>
			</view>
			<view class="modal-body" v-if="selectedSeal">
				<view class="detail-image-container">
					<image class="detail-seal-image" :src="getSealImageUrl(selectedSeal)" mode="aspectFit"></image>
					<view class="status-badge" :class="getStatusClass(selectedSeal.status)">
						<text class="status-text">{{ getStatusName(selectedSeal.status) }}</text>
					</view>
				</view>
				<view class="detail-info">
					<view class="detail-info-row">
						<text class="detail-label">å°ç« åç§°</text>
						<text class="detail-value">{{ selectedSeal.name }}</text>
					</view>
					<view class="detail-info-row">
						<text class="detail-label">å°ç« ç±»å‹</text>
						<text class="detail-value">{{ getSealTypeName(selectedSeal.type) }}</text>
					</view>
					<view class="detail-info-row">
						<text class="detail-label">åˆ›å»ºæ—¶é—´</text>
						<text class="detail-value">{{ formatDate(selectedSeal.createTime) }}</text>
					</view>
					<view class="detail-info-row">
						<text class="detail-label">çŠ¶æ€</text>
						<view class="detail-status-value" :class="getStatusClass(selectedSeal.status)">
							<view class="status-dot"></view>
							<text>{{ getStatusName(selectedSeal.status) }}</text>
						</view>
					</view>
				</view>
			</view>
		</view>
	</view>
</view>
</template>

<style>
/* é¡µé¢å…¨å±€å¸ƒå±€ï¼šflexåˆ—ï¼Œè®©å†…å®¹å¡«æ»¡å±å¹• */
page {
	width: 100%;
	height: 100%;
	display: flex;
	flex-direction: column;
	overflow: hidden; /* é˜²æ­¢é¡µé¢çº§åˆ«æ»šåŠ¨ */
}

/* å°ç« åˆ—è¡¨å®¹å™¨ï¼šæ•´ä¸ªé¡µé¢çš„æ ¹å…ƒç´  */
.seal-list-container {
	width: 100%;
	flex: 1; /* å æ®pageå‰©ä½™ç©ºé—´ */
	background-color: #F7F9FC;
	display: flex;
	flex-direction: column;
}

/* å›ºå®šå¤´éƒ¨åŒºåŸŸï¼ˆåŒ…å«Tabå’Œç­›é€‰å™¨ï¼‰ */
.fixed-header {
	/* å›ºå®šå¤§å°ï¼Œä¸æ”¶ç¼©ä¹Ÿä¸æ”¾å¤§ */
	flex-shrink: 0;
	background-color: #FFFFFF;
	border-bottom-width: 1rpx;
	border-bottom-color: #EBEEF5;
	z-index: 100;
}

/* Tabåˆ‡æ¢å™¨ */
.tab-switcher {
	height: 88rpx;
	background-color: #FFFFFF;
	flex-direction: row;
	align-items: center;
}

.tab-item {
	flex: 1;
	height: 100%;
	align-items: center;
	justify-content: center;
	position: relative;
}

.tab-text {
	font-size: 30rpx;
	color: #606266;
	font-weight: 500;
}

.tab-item.active .tab-text {
	color: #00C28A;
	font-weight: 600;
}

.tab-indicator {
	position: absolute;
	bottom: 0;
	left: 50%;
	transform: translateX(-50%);
	width: 60rpx;
	height: 4rpx;
	background-color: #00C28A;
	border-radius: 2rpx;
}

/* çŠ¶æ€ç­›é€‰å™¨ */
.status-filter {
	height: 88rpx;
	background-color: #FFFFFF;
	flex-direction: row;
	align-items: center;
	padding: 0 30rpx;
	border-bottom-width: 1rpx;
	border-bottom-color: #EBEEF5;
}

.filter-item {
	flex-direction: row;
	align-items: center;
	padding: 12rpx 24rpx;
	margin-right: 16rpx;
	border-radius: 20rpx;
	background-color: #F5F7FA;
	transition: all 0.3s;
}

.filter-item.active {
	background-color: #E6F7FF;
	border: 1rpx solid #1890FF;
}

.filter-text {
	font-size: 26rpx;
	color: #606266;
	margin-right: 8rpx;
}

.filter-item.active .filter-text {
	color: #1890FF;
	font-weight: 500;
}

.filter-dot {
	width: 16rpx;
	height: 16rpx;
	border-radius: 50%;
}

.filter-dot.status-active {
	background-color: #00C28A;
}

.filter-dot.status-disabled {
	background-color: #909399;
}

.filter-dot.status-revoked {
	background-color: #F56C6C;
}

/* Tabå†…å®¹åŒº - å æ®å‰©ä½™ç©ºé—´ */
.tab-content {
	flex: 1;
	/* ç¡®ä¿å¯ä»¥æ»šåŠ¨ */
	overflow-y: auto;
	/* ä¿®å¤iOSä¸Šæ»šåŠ¨æ¡åˆ°åº•éƒ¨æ— æ³•å†æ‹‰åŠ¨çš„é—®é¢˜ */
	-webkit-overflow-scrolling: touch;
}

/* ä¸ªäººå°ç« å†…å®¹åŒº */
.personal-content {
	/* ç»§æ‰¿ tab-content çš„æ ·å¼å³å¯ */
}

/* ä¼ä¸šå°ç« å†…å®¹åŒº */
.enterprise-content {
	/* ç»§æ‰¿ tab-content çš„æ ·å¼å³å¯ */
}

/* é¡µé¢å¤´éƒ¨ */
.page-header {
	height: 88rpx;
	background-color: #FFFFFF;
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
	padding: 0 30rpx;
	border-bottom-width: 1rpx;
	border-bottom-color: #EBEEF5;
}

.title-text {
	font-size: 36rpx;
	color: #303133;
	font-weight: 600;
}

.create-btn {
	height: 60rpx;
	background-color: #F0F7FF;
	border-radius: 12rpx;
	padding: 0 20rpx;
	align-items: center;
	justify-content: center;
}

.btn-text {
	font-size: 26rpx;
	color: #1890FF;
}

/* å°ç« åˆ—è¡¨ */
.seal-list {
	padding: 30rpx;
	/* åº•éƒ¨ç•™å‡ºè¶³å¤Ÿç©ºé—´ç»™æ‚¬æµ®æŒ‰é’®å’Œâ€œæ²¡æœ‰æ›´å¤šâ€æç¤º */
	padding-bottom: 220rpx;
}

/* ç©ºçŠ¶æ€ */
.empty-state {
	flex: 1;
	align-items: center;
	justify-content: center;
	padding: 120rpx 0;
}

.empty-image {
	width: 200rpx;
	height: 200rpx;
	margin-bottom: 30rpx;
}

.empty-text {
	font-size: 32rpx;
	color: #909399;
	font-weight: 600;
	margin-bottom: 16rpx;
}

.empty-desc {
	font-size: 28rpx;
	color: #C0C4CC;
	margin-bottom: 40rpx;
}

.empty-btn {
	height: 80rpx;
	width: 300rpx;
	background-color: #00C28A;
	border-radius: 12rpx;
	align-items: center;
	justify-content: center;
}

.empty-btn-text {
	font-size: 28rpx;
	color: #FFFFFF;
	font-weight: 500;
}

/* å°ç« åˆ—è¡¨é¡¹ - ç®€çº¦è®¾è®¡ */
.seal-item {
	background-color: #FFFFFF;
	border-radius: 12rpx;
	padding: 24rpx;
	margin-bottom: 20rpx;
	flex-direction: row;
	align-items: center;
	box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.04);
	border: 1rpx solid #EBEEF5;
	transition: all 0.2s;
}

.seal-item:active {
	background-color: #F9FAFB;
}

/* ç¦ç”¨çŠ¶æ€çš„å°ç«  */
.seal-item.disabled {
	opacity: 0.6;
	background-color: #F5F7FA;
}

.seal-item.disabled .seal-image {
	opacity: 0.5;
}

.seal-item.disabled .seal-name {
	color: #909399;
}

.seal-item.disabled .seal-time {
	color: #C0C4CC;
}

.seal-info {
	flex-direction: column;
	align-items: flex-start;
	flex: 1;
	margin-left: 20rpx;
	justify-content: center;
}

/* å°ç« å›¾ç‰‡å®¹å™¨ */
.seal-image-wrapper {
	position: relative;
	width: 100rpx;
	height: 100rpx;
	flex-shrink: 0;
}

.seal-image {
	width: 100rpx;
	height: 100rpx;
	border-radius: 8rpx;
	background-color: #F5F7FA;
}

/* çŠ¶æ€æ ‡ç­¾ */
.status-badge {
	position: absolute;
	bottom: -6rpx;
	right: -6rpx;
	padding: 3rpx 10rpx;
	border-radius: 10rpx;
	border: 2rpx solid #FFFFFF;
	box-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.1);
}

.status-text {
	font-size: 20rpx;
	font-weight: 500;
	color: #FFFFFF;
}

/* å¯ç”¨çŠ¶æ€ - ç»¿è‰² */
.status-badge.status-active {
	background-color: #00C28A;
}

/* åœç”¨çŠ¶æ€ - ç°è‰² */
.status-badge.status-disabled {
	background-color: #909399;
}

/* å·²ä½œåºŸçŠ¶æ€ - çº¢è‰² */
.status-badge.status-revoked {
	background-color: #F56C6C;
}

.seal-details {
	margin-left: 20rpx;
	flex: 1;
}

.seal-name-row {
	flex-direction: row;
	align-items: center;
	margin-bottom: 8rpx;
}

.seal-name {
	font-size: 30rpx;
	color: #303133;
	font-weight: 600;
	margin-right: 10rpx;
}

.seal-type {
	font-size: 22rpx;
	color: #606266;
	background-color: #F5F7FA;
	padding: 4rpx 12rpx;
	border-radius: 20rpx;
}

.seal-time {
	font-size: 24rpx;
	color: #909399;
	margin-top: 4rpx;
}

.seal-actions {
	flex-direction: row;
	align-items: center;
	margin-left: 16rpx;
}

.action-delete {
	width: 60rpx;
	height: 60rpx;
	border-radius: 50%;
	align-items: center;
	justify-content: center;
	background-color: #FFF0F0;
	transition: all 0.2s;
}

.action-delete:active {
	background-color: #FFE5E5;
}

.action-icon {
	font-family: 'Font Awesome 6 Free';
	font-size: 26rpx;
	color: #F56C6C;
	font-weight: 600;
}

/* åŠ è½½çŠ¶æ€ */
.loading-container {
	padding: 30rpx 0;
	align-items: center;
	justify-content: center;
}

.loading-spinner {
	width: 60rpx;
	height: 60rpx;
	border-width: 4rpx;
	border-color: #E4E7ED;
	border-top-color: #00C28A;
	border-radius: 30rpx;
	/* æ·»åŠ åŠ¨ç”» */
}

.loading-text {
	font-size: 26rpx;
	color: #909399;
	margin-top: 16rpx;
}

/* æ— æ›´å¤šæ•°æ® */
.no-more {
	padding: 30rpx 0;
	align-items: center;
	justify-content: center;
}

.no-more-text {
	font-size: 26rpx;
	color: #C0C4CC;
}

/* åŠ è½½æ›´å¤šæç¤º */
.load-more-container {
	padding: 30rpx;
	align-items: center;
	justify-content: center;
}

.load-more {
	padding: 30rpx;
	align-items: center;
	justify-content: center;
}

.load-more-text {
	font-size: 26rpx;
	color: #909399;
	text-align: center;
}

.load-more.loading .load-more-text {
	color: #00C28A;
}

/* åº•éƒ¨æç¤º */
.footer-tips {
	padding: 30rpx;
	align-items: center;
}

.tip-text {
	font-size: 24rpx;
	color: #909399;
	margin-bottom: 8rpx;
	text-align: center;
}

/* æµ®åŠ¨æŒ‰é’® */
.float-btn {
	position: fixed;
	right: 40rpx;
	bottom: 100rpx;
	width: 100rpx;
	height: 100rpx;
	border-radius: 12rpx;
	background-color: #00C28A;
	align-items: center;
	justify-content: center;
	box-shadow: 0 4rpx 16rpx rgba(0, 194, 138, 0.3);
}

.float-btn.disabled {
	background-color: #C0C4CC;
	box-shadow: 0 4rpx 16rpx rgba(192, 196, 204, 0.3);
	opacity: 0.6;
}

.float-btn-icon {
	font-size: 40rpx;
	color: #FFFFFF;
}

.float-btn-icon:before {
	content: "\f067";
}

/* å›¾æ ‡å­—ä½“ */
.fa {
	font-family: 'Font Awesome 6 Free';
	font-size: 26rpx;
	font-style: normal;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
	font-weight: 900;
}

.icon {
	font-family: 'Font Awesome 6 Free';
}

.icon-plus:before { content: "\f067"; }
.icon-close:before { content: "\f00d"; }
.icon-edit-3:before { content: "\f303"; }
.icon-upload:before { content: "\f093"; }
.icon-magic:before { content: "\f0d0"; }
.icon-image:before { content: "\f03e"; }

/* ç­¾ååˆ›å»ºå¼¹çª— - ç®€çº¦è®¾è®¡ */
.modal-overlay {
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background-color: rgba(0, 0, 0, 0.5);
	z-index: 900;
}

.signature-modal {
	position: fixed;
	left: 50rpx;
	right: 50rpx;
	top: 15%;
	background-color: #FFFFFF;
	border-radius: 16rpx;
	overflow: hidden;
	z-index: 999;
	box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.12);
}

.modal-header {
	height: 88rpx;
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
	padding: 0 30rpx;
	border-bottom: 1rpx solid #EBEEF5;
}

.modal-title {
	font-size: 32rpx;
	color: #303133;
	font-weight: 600;
}

.modal-close {
	width: 60rpx;
	height: 60rpx;
	align-items: center;
	justify-content: center;
	border-radius: 50%;
}

.modal-close:active {
	background-color: #F5F7FA;
}

.close-icon {
	font-size: 28rpx;
	color: #909399;
}

.modal-body {
	padding: 30rpx;
}

.modal-footer {
	height: 100rpx;
	flex-direction: row;
	align-items: center;
	justify-content: flex-end;
	padding: 0 30rpx;
	border-top-width: 1rpx;
	border-top-color: #EBEEF5;
}

.modal-btn {
	min-width: 180rpx;
	height: 72rpx;
	border-radius: 12rpx;
	align-items: center;
	justify-content: center;
	margin-left: 20rpx;
}

.modal-btn.cancel {
	background-color: #F5F7FA;
	border: 1rpx solid #DCDFE6;
}

.modal-btn.confirm {
	background-color: #00C28A;
}

.modal-btn.danger {
	background-color: #F56C6C;
	width: 100%;
	flex-direction: row;
}

.cancel .btn-text {
	color: #606266;
}

.confirm .btn-text {
	color: #FFFFFF;
}

.danger .btn-text {
	color: #FFFFFF;
}

.btn-icon {
	font-size: 28rpx;
	margin-right: 8rpx;
}

.btn-text {
	font-size: 28rpx;
	font-weight: 500;
}

/* ç­¾åç±»å‹é€‰æ‹©å™¨ */
.signature-type-selector {
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
	margin-bottom: 30rpx;
}

.type-item {
	flex: 1;
	height: 88rpx;
	background-color: #F5F7FA;
	border-radius: 16rpx;
	margin: 0 10rpx;
	align-items: center;
	justify-content: center;
}

.type-item:first-child {
	margin-left: 0;
}

.type-item:last-child {
	margin-right: 0;
}

.type-item.active {
	background-color: #E8F7F1;
	border: 1rpx solid #00C28A;
}

.type-icon {
	font-size: 32rpx;
	color: #909399;
	margin-bottom: 8rpx;
}

.type-item.active .type-icon {
	color: #00C28A;
}

.type-text {
	font-size: 24rpx;
	color: #606266;
}

.type-item.active .type-text {
	color: #00C28A;
	font-weight: 500;
}

/* è¾“å…¥æ¡†ç»„ */
.input-group {
	margin-bottom: 24rpx;
}

.input-label {
	font-size: 28rpx;
	color: #303133;
	margin-bottom: 12rpx;
}

.input-field {
	height: 80rpx;
	border: 1rpx solid #DCDFE6;
	border-radius: 8rpx;
	padding: 0 20rpx;
	font-size: 28rpx;
	color: #303133;
	background-color: #FFFFFF;
}

/* æ‰‹å†™ç­¾åé¢æ¿ */
.signature-panel {
	margin-top: 30rpx;
}

.signature-canvas-container {
	height: 300rpx;
	background-color: #F8F9FB;
	border: 1rpx solid #E4E7ED;
	border-radius: 8rpx;
	align-items: center;
	justify-content: center;
	margin-bottom: 20rpx;
}

.canvas-guide {
	font-size: 28rpx;
	color: #909399;
}

.canvas-actions {
	flex-direction: row;
	justify-content: flex-end;
}

.canvas-action-btn {
	width: 120rpx;
	height: 60rpx;
	border-radius: 12rpx;
	background-color: #F5F7FA;
	border: 1rpx solid #DCDFE6;
	align-items: center;
	justify-content: center;
}

/* ä¸Šä¼ ç­¾åé¢æ¿ */
.upload-panel {
	margin-top: 30rpx;
}

.upload-box {
	height: 300rpx;
	background-color: #F8F9FB;
	border: 1rpx dashed #DCDFE6;
	border-radius: 8rpx;
	align-items: center;
	justify-content: center;
}

.upload-icon {
	font-size: 80rpx;
	color: #DCDFE6;
	margin-bottom: 20rpx;
}

.upload-text {
	font-size: 28rpx;
	color: #909399;
}

.preview-image {
	width: 240rpx;
	height: 240rpx;
	border-radius: 8rpx;
}

/* è‡ªåŠ¨ç”Ÿæˆç­¾åé¢æ¿ */
.auto-gen-panel {
	margin-top: 30rpx;
}

.style-selector {
	margin-top: 20rpx;
	margin-bottom: 30rpx;
}

.style-label {
	font-size: 28rpx;
	color: #303133;
	margin-bottom: 16rpx;
}

.style-options {
	flex-direction: row;
	flex-wrap: wrap;
}

.style-item {
	width: 150rpx;
	height: 70rpx;
	border: 1rpx solid #DCDFE6;
	border-radius: 8rpx;
	margin-right: 20rpx;
	margin-bottom: 20rpx;
	align-items: center;
	justify-content: center;
}

.style-item.active {
	background-color: #E8F7F1;
	border-color: #00C28A;
}

.style-name {
	font-size: 28rpx;
	color: #606266;
}

.style-item.active .style-name {
	color: #00C28A;
	font-weight: 500;
}

.preview-container {
	margin-top: 30rpx;
}

.preview-label {
	font-size: 28rpx;
	color: #303133;
	margin-bottom: 16rpx;
}

.signature-preview {
	height: 100rpx;
	background-color: #F8F9FB;
	border: 1rpx solid #E4E7ED;
	border-radius: 8rpx;
	align-items: center;
	justify-content: center;
	padding: 0 30rpx;
}

.preview-text {
	font-size: 32rpx;
	color: #303133;
	font-style: italic;
}

/* ä¼ä¸šå°ç« åˆ†ç»„æ ·å¼ */
.enterprise-seal-section {
	padding: 30rpx;
	/* åº•éƒ¨ç•™å‡ºç©ºé—´ */
	padding-bottom: 60rpx;
}

.enterprise-group {
	margin-bottom: 24rpx;
}

.enterprise-header {
	flex-direction: row;
	align-items: center;
	justify-content: space-between;
	padding: 24rpx 30rpx;
	background-color: #F7F9FC;
	border-radius: 16rpx;
	margin-bottom: 16rpx;
}

.enterprise-info {
	flex-direction: row;
	align-items: center;
}

.enterprise-name {
	font-size: 30rpx;
	font-weight: 600;
	color: #303133;
}

.enterprise-name-bar {
	padding: 16rpx 24rpx;
	background-color: #F7F9FC;
	border-left: 3rpx solid #00C28A;
	margin-bottom: 16rpx;
}

.seal-count {
	font-size: 24rpx;
	color: #909399;
	margin-left: 8rpx;
}

.chevron {
	font-size: 32rpx;
	color: #909399;
	transition: transform 0.3s;
	transform: rotate(0deg);
}

.chevron.expanded {
	transform: rotate(90deg);
}

.seals-container {
	max-height: 0;
	overflow: hidden;
	transition: max-height 0.3s ease;
}

.seals-container.expanded {
	max-height: 2000rpx;
}

/* å°ç« è¯¦æƒ…å¼¹çª— - ç®€çº¦è®¾è®¡ */
.seal-detail-modal {
	position: fixed;
	left: 50rpx;
	right: 50rpx;
	top: 20%;
	max-height: 70%;
	background-color: #FFFFFF;
	border-radius: 16rpx;
	overflow: hidden;
	z-index: 999;
	box-shadow: 0 8rpx 24rpx rgba(0, 0, 0, 0.12);
}

.detail-image-container {
	padding: 40rpx;
	align-items: center;
	justify-content: center;
	background-color: #F7F9FC;
	position: relative;
}

.detail-seal-image {
	width: 200rpx;
	height: 200rpx;
	border-radius: 8rpx;
	background-color: #FFFFFF;
}

.detail-info {
	padding: 30rpx;
}

.detail-info-row {
	flex-direction: row;
	align-items: center;
	padding: 16rpx 0;
	border-bottom: 1rpx solid #F2F6FC;
}

.detail-info-row:last-child {
	border-bottom-width: 0;
}

.detail-label {
	width: 160rpx;
	font-size: 28rpx;
	color: #909399;
}

.detail-value {
	flex: 1;
	font-size: 28rpx;
	color: #303133;
	font-weight: 500;
}

.detail-status-value {
	flex-direction: row;
	align-items: center;
	flex: 1;
	padding: 12rpx 20rpx;
	border-radius: 8rpx;
	background-color: #F5F7FA;
}

/* å¯ç”¨çŠ¶æ€çš„æ ·å¼ */
.detail-status-value.status-active {
	background-color: rgba(0, 194, 138, 0.1);
}

.detail-status-value.status-active .status-dot {
	background-color: #00C28A;
}

.detail-status-value.status-active text {
	color: #00C28A;
}

/* åœç”¨çŠ¶æ€çš„æ ·å¼ */
.detail-status-value.status-disabled {
	background-color: rgba(144, 147, 153, 0.1);
}

.detail-status-value.status-disabled .status-dot {
	background-color: #909399;
}

.detail-status-value.status-disabled text {
	color: #909399;
}

/* å·²ä½œåºŸçŠ¶æ€çš„æ ·å¼ */
.detail-status-value.status-revoked {
	background-color: rgba(245, 108, 108, 0.1);
}

.detail-status-value.status-revoked .status-dot {
	background-color: #F56C6C;
}

.detail-status-value.status-revoked text {
	color: #F56C6C;
}

.status-dot {
	width: 24rpx;
	height: 24rpx;
	border-radius: 50%;
	margin-right: 12rpx;
}

.detail-status-value text {
	font-size: 28rpx;
	font-weight: 600;
}
</style> 