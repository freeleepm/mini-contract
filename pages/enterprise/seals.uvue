<template>
  <view class="container">
    <!-- é¡¶éƒ¨èƒŒæ™¯è£…é¥° -->
    <view class="header-bg"></view>
    
    <!-- ä¼ä¸šä¿¡æ¯å¡ç‰‡ -->
    <view class="enterprise-section">
      <view class="enterprise-card">
        <view class="enterprise-logo">
          <image class="enterprise-logo-img" :src="enterpriseLogo" mode="aspectFill"></image>
        </view>
        <view class="enterprise-info">
          <view class="name-row">
            <text class="enterprise-name">{{ enterpriseName }}</text>
            <view class="enterprise-status" v-if="isVerified">
              <text class="status-icon fa fa-circle-check"></text>
              <text class="status-text">å·²è®¤è¯</text>
            </view>
          </view>
          <text class="enterprise-credit-code" v-if="enterpriseCreditCode">ç¤¾ä¼šä¿¡ç”¨ä»£ç ï¼š{{ enterpriseCreditCode }}</text>
        </view>
      </view>
    </view>
    
    <!-- å†…å®¹åŒºåŸŸ -->
    <scroll-view class="content-section" scroll-y="true" @scrolltolower="loadMore">
      <!-- ç»Ÿè®¡ä¸æ“ä½œæ  -->
      <view class="action-bar">
        <view class="stat-info">
          <text class="stat-label">å…¨éƒ¨å°ç« </text>
          <text class="stat-count">{{ total }}</text>
        </view>
        
        <!-- å·²ç§»é™¤é¡¶éƒ¨çš„â€œæ–°å»ºå°ç« â€æŒ‰é’®ï¼Œæ”¹ç”¨å³ä¸‹è§’æ‚¬æµ®æŒ‰é’® -->
      </view>
      
      <!-- å°ç« åˆ—è¡¨ -->
      <view class="seal-list" v-if="sealList.length > 0">
        <view class="seal-item" v-for="(seal, index) in sealList" :key="seal.id">
          <!-- åŠ¨æ€æ·»åŠ  disabled ç±» -->
          <view class="seal-card" :class="{'seal-card-default': seal.isDefault, 'seal-card-disabled': seal.status === 1}">
            <!-- å¡ç‰‡ä¸»ä½“ -->
            <view class="card-main">
              <!-- å·¦ä¾§å›¾ç‰‡ -->
              <view class="seal-img-wrapper">
                <view class="seal-img-box">
                  <image 
                    class="seal-img" 
                    :src="seal.image" 
                    mode="aspectFit"
                    @error="handleImageError(seal)"
                    @load="handleImageLoad(seal)"
                  ></image>
                  <!-- ğŸ†• ç¦ç”¨çŠ¶æ€åº•éƒ¨å°æ¡ -->
                  <view class="disabled-strip" v-if="seal.status === 1">
                    <text class="disabled-strip-text">å·²ç¦ç”¨</text>
                  </view>
                </view>
                <!-- ç¦ç”¨çŠ¶æ€ä¸‹ï¼Œå¯ä»¥è€ƒè™‘éšè—ç±»å‹æ ‡ç­¾ï¼Œæˆ–è€…ä¿æŒæ˜¾ç¤ºä½†é¢œè‰²å˜ç°ã€‚ç›®å‰ä¿æŒæ˜¾ç¤º -->
                <view class="seal-type-badge" :class="getSealTypeClass(seal.type)">
                  <text class="type-badge-text">{{ getSealTypeText(seal.type) }}</text>
                </view>
              </view>
              
              <!-- å³ä¾§ä¿¡æ¯ -->
              <view class="seal-details">
                <view class="seal-header">
                  <text class="seal-title">{{ seal.name }}</text>
                  <!-- ç§»é™¤é‡å¤çš„çŠ¶æ€æ ‡ç­¾ï¼Œä½¿ç”¨æ°´å°ä»£æ›¿ -->
                </view>
                
                <view class="seal-meta-row">
                  <view class="meta-item">
                    <text class="meta-label">æˆæƒäººæ•°</text>
                    <text class="meta-value-highlight">{{ seal.grantCount || 0 }}</text>
                  </view>
                  <view class="meta-item" style="align-items: flex-end;">
                    <text class="meta-label">åˆ›å»ºæ—¶é—´</text>
                    <text class="meta-value">{{ formatDate(seal.createTime) }}</text>
                  </view>
                </view>
              </view>
              
              <!-- å·²ç§»é™¤å¤–éƒ¨çš„æ°´å° -->
            </view>
            
            <!-- åº•éƒ¨æ“ä½œæ  -->
            <view class="card-actions">
              <view 
                class="action-item"
                @click="toggleSealStatus(seal, seal.status === 1 ? 0 : 1)"
              >
                <view class="action-content">
                  <text class="action-icon fa" :class="[seal.status === 1 ? 'fa-circle-check' : 'fa-ban', seal.status === 1 ? 'text-primary' : 'text-danger']"></text>
                  <text class="action-text" :class="seal.status === 1 ? 'text-primary' : 'text-danger'">{{ seal.status === 1 ? 'å¯ç”¨' : 'ç¦ç”¨' }}</text>
                </view>
              </view>
              
              <view class="action-line"></view>
              
              <view class="action-item" @click="authSeal(seal)">
                <view class="action-content">
                  <text class="action-icon fa fa-user-gear text-gray-dark"></text>
                  <text class="action-text text-gray-dark">æˆæƒç®¡ç†</text>
                </view>
              </view>
              
              <view class="action-line"></view>
              
              <view class="action-item" @click="deleteSeal(seal)">
                <view class="action-content">
                  <text class="action-icon fa fa-trash-can text-gray-dark"></text>
                  <text class="action-text text-gray-dark">åˆ é™¤</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- æ— å°ç« æç¤º -->
      <view class="empty-state" v-if="sealList.length === 0 && !loading">
        <image class="empty-image" src="/static/icons/template.png" mode="aspectFit"></image>
        <text class="empty-title">æš‚æ— ä¼ä¸šå°ç« </text>
        <text class="empty-desc">åˆ›å»ºä¼ä¸šå°ç« ï¼Œåœ¨åˆåŒç­¾ç½²æ—¶ä½¿ç”¨</text>
        <!-- å·²ç§»é™¤ç©ºçŠ¶æ€ä¸‹çš„æŒ‰é’® -->
      </view>
      
      <!-- åŠ è½½ä¸­æç¤º -->
      <view class="loading-state" v-if="loading">
        <view class="loading-spinner"></view>
      </view>
      
      <!-- åº•éƒ¨å®‰å…¨è·ç¦» -->
      <view class="safe-area-bottom"></view>
    </scroll-view>
    
    <!-- å³ä¸‹è§’æ‚¬æµ®åˆ›å»ºæŒ‰é’® -->
    <view class="fab-btn" @click="createSeal">
      <text class="fa fa-plus fab-icon"></text>
    </view>
  </view>
</template>

<script>
import { 
  getEnterpriseSealPage, 
  deleteEnterpriseSeal,
  getEnterpriseDetail,
  updateSeal
} from '../../api/enterprise/index';

export default {
  data() {
    return {
      enterpriseId: 0,
      enterpriseName: "ä¼ä¸šåç§°",
      enterpriseCreditCode: "", // ç»Ÿä¸€ç¤¾ä¼šä¿¡ç”¨ä»£ç 
      enterpriseLogo: "/static/icons/blue-icon.png",
      isVerified: false, // ä¼ä¸šè®¤è¯çŠ¶æ€
      searchText: '',
      loading: true,
      sealList: [],
      pageNo: 1,
      pageSize: 20,
      hasMore: false,
      total: 0,
      shouldRefresh: false
    };
  },
  async onLoad(options) {
    console.log('[ä¼ä¸šå°ç« ] ========== onLoad å¼€å§‹ ==========');
    console.log('[ä¼ä¸šå°ç« ] onLoad options:', JSON.stringify(options));
    
    // ğŸ”§ å…¼å®¹å¤šç§å‚æ•°åï¼šidã€enterpriseId
    let enterpriseIdFromOptions = null;
    
    if (options) {
      // ä¼˜å…ˆä½¿ç”¨ id å‚æ•°ï¼ˆä¸»è¦è·³è½¬æ–¹å¼ï¼‰
      if (options.id) {
        enterpriseIdFromOptions = Number(options.id);
        console.log('[ä¼ä¸šå°ç« ] ä» options.id è·å–ä¼ä¸šID:', enterpriseIdFromOptions);
      }
      // å…¼å®¹ enterpriseId å‚æ•°
      else if (options.enterpriseId) {
        enterpriseIdFromOptions = Number(options.enterpriseId);
        console.log('[ä¼ä¸šå°ç« ] ä» options.enterpriseId è·å–ä¼ä¸šID:', enterpriseIdFromOptions);
      }
    }
    
    if (enterpriseIdFromOptions && enterpriseIdFromOptions > 0) {
      this.enterpriseId = enterpriseIdFromOptions;
      console.log('[ä¼ä¸šå°ç« ] âœ… ä½¿ç”¨URLå‚æ•°çš„ä¼ä¸šID:', this.enterpriseId);
      // åŠ è½½ä¼ä¸šè¯¦æƒ…
      await this.loadEnterpriseDetail();
    } else {
      // å¦‚æœæ²¡æœ‰ä¼ å…¥ä¼ä¸šIDï¼Œåˆ™ä»ç¼“å­˜æˆ–å…¨å±€çŠ¶æ€è·å–
      console.log('[ä¼ä¸šå°ç« ] URLå‚æ•°ä¸­æ— æœ‰æ•ˆä¼ä¸šIDï¼Œå°è¯•ä»ç¼“å­˜è·å–...');
      const currentEnterprise = uni.getStorageSync('currentEnterprise');
      console.log('[ä¼ä¸šå°ç« ] Storage currentEnterprise:', currentEnterprise);
      
      if (currentEnterprise) {
        try {
          const enterpriseData = typeof currentEnterprise === 'string' 
            ? JSON.parse(currentEnterprise) 
            : currentEnterprise;
            
          console.log('[ä¼ä¸šå°ç« ] è§£æåçš„ä¼ä¸šæ•°æ®:', JSON.stringify(enterpriseData));
          
          if (enterpriseData && enterpriseData.id) {
            this.enterpriseId = enterpriseData.id;
            this.enterpriseName = enterpriseData.name || "ä¼ä¸šåç§°";
            this.enterpriseCreditCode = enterpriseData.creditCode || "";
            this.enterpriseLogo = enterpriseData.logo || "/static/icons/blue-icon.png";
            this.isVerified = enterpriseData.status === 1;
            console.log('[ä¼ä¸šå°ç« ] âœ… ä»ç¼“å­˜è·å–ä¼ä¸šID:', this.enterpriseId);
          } else {
            console.warn('[ä¼ä¸šå°ç« ] âš ï¸ ç¼“å­˜ä¸­çš„ä¼ä¸šæ•°æ®æ— æ•ˆ');
          }
        } catch (e) {
          console.error('[ä¼ä¸šå°ç« ] âŒ è§£æä¼ä¸šä¿¡æ¯å¤±è´¥:', e);
        }
      } else {
        console.warn('[ä¼ä¸šå°ç« ] âš ï¸ ç¼“å­˜ä¸­æ— ä¼ä¸šä¿¡æ¯');
      }
    }
    
    console.log('[ä¼ä¸šå°ç« ] ========== onLoad ç»“æŸï¼Œæœ€ç»ˆ enterpriseId:', this.enterpriseId, '==========');
  },
  
  onShow() {
    // é¡µé¢æ˜¾ç¤ºæ—¶è‡ªåŠ¨åˆ·æ–°åˆ—è¡¨
    console.log('[ä¼ä¸šå°ç« ] ========== onShow ==========');
    console.log('[ä¼ä¸šå°ç« ] onShow enterpriseId:', this.enterpriseId);
    
    if (!this.enterpriseId || this.enterpriseId <= 0) {
      console.error('[ä¼ä¸šå°ç« ] âŒ onShow æ—¶ enterpriseId æ— æ•ˆï¼Œæ— æ³•åŠ è½½åˆ—è¡¨');
      uni.showToast({
        title: 'ä¼ä¸šä¿¡æ¯è·å–å¤±è´¥',
        icon: 'none'
      });
      return;
    }
    
    this.loadSealList(true);
  },
  
  onPullDownRefresh() {
    // ä¸‹æ‹‰åˆ·æ–°
    this.loadSealList(true).then(() => {
      uni.stopPullDownRefresh();
    });
  },
  
  mounted() {
    // ç›‘å¬å°ç« åˆ›å»ºæˆåŠŸçš„å…¨å±€äº‹ä»¶
    uni.$on('refreshEnterpriseSealList', this.handleRefreshEvent);
    console.log('[ä¼ä¸šå°ç« ] å·²æ³¨å†Œåˆ·æ–°äº‹ä»¶ç›‘å¬');
  },
  
  beforeUnmount() {
    // é¡µé¢é”€æ¯å‰ç§»é™¤äº‹ä»¶ç›‘å¬
    uni.$off('refreshEnterpriseSealList', this.handleRefreshEvent);
    console.log('[ä¼ä¸šå°ç« ] å·²ç§»é™¤åˆ·æ–°äº‹ä»¶ç›‘å¬');
  },
  
  methods: {
    // å¤„ç†å°ç« åˆ—è¡¨åˆ·æ–°äº‹ä»¶
    handleRefreshEvent() {
      console.log('[ä¼ä¸šå°ç« ] æ”¶åˆ°åˆ·æ–°äº‹ä»¶æ ‡è®°');
      // è¿™é‡Œä¸ç›´æ¥è°ƒç”¨åŠ è½½ï¼Œå› ä¸ºè¿”å›é¡µé¢æ—¶ä¼šè§¦å‘ onShow
      // å¦‚æœéœ€è¦å¯ä»¥åœ¨è¿™é‡Œè®¾ç½®ä¸€ä¸ªæ ‡è®°ï¼Œä½†ç›®å‰ onShow æ¯æ¬¡éƒ½åˆ·ï¼Œæ‰€ä»¥ä¸ç”¨é¢å¤–å¤„ç†
    },
    
    // åŠ è½½ä¼ä¸šè¯¦æƒ…
    async loadEnterpriseDetail() {
      try {
        console.log('[ä¼ä¸šå°ç« ] å¼€å§‹åŠ è½½ä¼ä¸šè¯¦æƒ…, enterpriseId:', this.enterpriseId);
        
        // request å‡½æ•°å·²ç»è‡ªåŠ¨è§£åŒ…ï¼Œè¿”å›çš„ç›´æ¥å°±æ˜¯ Enterprise å¯¹è±¡
        const enterprise = await getEnterpriseDetail(this.enterpriseId);
        
        console.log('[ä¼ä¸šå°ç« ] è·å–åˆ°ä¼ä¸šæ•°æ®:', JSON.stringify(enterprise));
        
        if (enterprise) {
          // ç›´æ¥ä½¿ç”¨ enterpriseï¼Œä¸éœ€è¦ .data
          this.enterpriseName = enterprise.name || "ä¼ä¸šåç§°";
          this.enterpriseCreditCode = enterprise.creditCode || "";
          this.enterpriseLogo = enterprise.logo || "/static/icons/blue-icon.png";
          this.isVerified = enterprise.status === 1; // 1è¡¨ç¤ºå·²è®¤è¯
          
          console.log('[ä¼ä¸šå°ç« ] æ•°æ®å·²èµ‹å€¼:', {
            name: this.enterpriseName,
            creditCode: this.enterpriseCreditCode,
            logo: this.enterpriseLogo,
            isVerified: this.isVerified
          });
          
          // å¼ºåˆ¶åˆ·æ–°è§†å›¾
          this.$forceUpdate();
        } else {
          console.error('[ä¼ä¸šå°ç« ] ä¼ä¸šæ•°æ®ä¸ºç©º');
        }
      } catch (error) {
        console.error('[ä¼ä¸šå°ç« ] è·å–ä¼ä¸šè¯¦æƒ…å¤±è´¥:', error);
        uni.showToast({
          title: 'è·å–ä¼ä¸šä¿¡æ¯å¤±è´¥',
          icon: 'none'
        });
      }
    },
    
    // åŠ è½½å°ç« åˆ—è¡¨
    async loadSealList(isRefresh = false) {
      console.log('[ä¼ä¸šå°ç« ] ========== loadSealList å¼€å§‹ ==========');
      console.log('[ä¼ä¸šå°ç« ] isRefresh:', isRefresh, ', enterpriseId:', this.enterpriseId);
      
      // ğŸ”§ å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿ enterpriseId æœ‰æ•ˆ
      if (!this.enterpriseId || this.enterpriseId <= 0) {
        console.error('[ä¼ä¸šå°ç« ] âŒ enterpriseId æ— æ•ˆï¼Œè·³è¿‡åŠ è½½');
        this.loading = false;
        this.sealList = [];
        return;
      }
      
      if (isRefresh) {
        this.pageNo = 1;
        // æ³¨æ„ï¼šè¿™é‡Œä¸æ¸…ç©º sealListï¼Œé¿å…é—ªçƒï¼Œç­‰åˆ°æ•°æ®å›æ¥å†æ›¿æ¢
      }
      
      this.loading = true;
      
      try {
        const params = {
          enterpriseId: this.enterpriseId,
          pageNo: this.pageNo,
          pageSize: this.pageSize
        };

        console.log('[ä¼ä¸šå°ç« ] loadSealList è¯·æ±‚å‚æ•°:', JSON.stringify(params));
        
        if (this.searchText) {
          params.name = this.searchText;
        }
        
        // è·å–å°ç« åˆ—è¡¨
        const response = await getEnterpriseSealPage(params);

        console.log('[ä¼ä¸šå°ç« ] loadSealList å“åº”:', JSON.stringify(response));
        
        if (response && Array.isArray(response.list)) {
          console.log('[ä¼ä¸šå°ç« ] âœ… è·å–åˆ°æ•°æ®: list.length=', response.list.length, ', total=', response.total);
          // æ•°æ®æ˜ å°„
          const mappedList = response.list.map(seal => {
            const imageUrl = seal.sealData || seal.image;
            return {
              ...seal,
              image: imageUrl
            };
          });
          
          if (isRefresh) {
            this.sealList = mappedList;
          } else {
            // åˆå¹¶åˆ—è¡¨
            this.sealList = [...this.sealList, ...mappedList];
          }
          
          this.total = response.total || 0;
          this.hasMore = this.sealList.length < this.total;
          
          console.log(`[ä¼ä¸šå°ç« ] åŠ è½½æˆåŠŸï¼šå½“å‰é¡µ ${mappedList.length} æ¡ï¼Œåˆ—è¡¨æ€»æ•° ${this.sealList.length} æ¡ï¼Œæ€»è®°å½• ${this.total} æ¡`);
          
          // åªæœ‰åœ¨ç¡®å®è¿˜æœ‰æ›´å¤šæ•°æ®æ—¶ï¼Œæ‰å¢åŠ é¡µç 
          if (this.hasMore) {
            this.pageNo++;
          }
        } else {
            console.warn('[ä¼ä¸šå°ç« ] âš ï¸ å“åº”æ•°æ®æ ¼å¼å¼‚å¸¸æˆ–ä¸ºç©º');
            // å¤„ç†ç©ºæ•°æ®æƒ…å†µ
            if (isRefresh) {
                this.sealList = [];
            }
            this.hasMore = false;
        }
      } catch (error) {
        console.error('[ä¼ä¸šå°ç« ] âŒ è·å–å°ç« åˆ—è¡¨å¤±è´¥:', error);
        uni.showToast({
          title: 'è·å–å°ç« åˆ—è¡¨å¤±è´¥',
          icon: 'none'
        });
      } finally {
        this.loading = false;
        console.log('[ä¼ä¸šå°ç« ] ========== loadSealList ç»“æŸ ==========');
      }
    },
    
    // åŠ è½½æ›´å¤š
    loadMore() {
      if (this.hasMore && !this.loading) {
        this.loadSealList();
      }
    },
    
    // å¤„ç†æœç´¢
    handleSearch() {
      this.loadSealList(true);
    },
    
    // åˆ›å»ºå°ç« 
    createSeal() {
      uni.navigateTo({
        url: `/pages/enterprise/seal-create?enterpriseId=${this.enterpriseId}&enterpriseName=${encodeURIComponent(this.enterpriseName)}`
      });
    },
    
    // æˆæƒå°ç« 
    authSeal(seal) {
      // ä¼ é€’ enterpriseId å‚æ•°ç»™æˆæƒç®¡ç†é¡µé¢
      uni.navigateTo({
        url: `/pages/enterprise/seal-authorize?id=${seal.id}&enterpriseId=${this.enterpriseId}`
      });
    },
    
    // åˆ‡æ¢å°ç« çŠ¶æ€ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
    async toggleSealStatus(seal, newStatus) {
      const statusText = newStatus === 0 ? 'å¯ç”¨' : 'ç¦ç”¨';
      const confirmText = newStatus === 0 
        ? `ç¡®å®šè¦å¯ç”¨å°ç« "${seal.name}"å—ï¼Ÿå¯ç”¨åå°†å¯ä»¥æ­£å¸¸ä½¿ç”¨å’Œæˆæƒã€‚`
        : `ç¡®å®šè¦ç¦ç”¨å°ç« "${seal.name}"å—ï¼Ÿç¦ç”¨åå°†æ— æ³•ä½¿ç”¨ï¼Œå·²æˆæƒçš„ç”¨æˆ·ä¹Ÿæ— æ³•ä½¿ç”¨æ­¤å°ç« ã€‚`;
      
      uni.showModal({
        title: `${statusText}å°ç« `,
        content: confirmText,
        confirmColor: newStatus === 0 ? '#00C28A' : '#FF4D4F',
        success: async (res) => {
          if (res.confirm) {
            try {
              // è°ƒç”¨ updateSeal API æ›´æ–°å°ç« çŠ¶æ€
              await updateSeal({
                id: seal.id,
                name: seal.name,
                type: seal.type,
                sealData: seal.sealData, // åç«¯å­—æ®µåä¸º sealData
                status: newStatus,
                enterpriseId: seal.enterpriseId
              });
              
              uni.showToast({
                title: `${statusText}æˆåŠŸ`,
                icon: 'success'
              });
              
              // é‡æ–°åŠ è½½å°ç« åˆ—è¡¨
              this.loadSealList(true);
            } catch (error) {
              console.error(`${statusText}å°ç« å¤±è´¥:`, error);
              uni.showToast({
                title: `${statusText}å¤±è´¥`,
                icon: 'none'
              });
            }
          }
        }
      });
    },
    
    // åˆ é™¤å°ç« 
    deleteSeal(seal) {
      uni.showModal({
        title: 'åˆ é™¤å°ç« ',
        content: `ç¡®å®šè¦åˆ é™¤å°ç« "${seal.name}"å—ï¼Ÿåˆ é™¤åä¸å¯æ¢å¤ã€‚`,
        confirmColor: '#FF4D4F',
        success: async (res) => {
          if (res.confirm) {
            try {
              // deleteEnterpriseSeal è¿”å› Promise<boolean>
              const success = await deleteEnterpriseSeal(seal.id);
              
              if (success) {
                uni.showToast({
                  title: 'åˆ é™¤æˆåŠŸ',
                  icon: 'success'
                });
                
                // é‡æ–°åŠ è½½å°ç« åˆ—è¡¨
                this.loadSealList(true);
              } else {
                uni.showToast({
                  title: 'åˆ é™¤å¤±è´¥',
                  icon: 'none'
                });
              }
            } catch (error) {
              console.error('åˆ é™¤å°ç« å¤±è´¥:', error);
              uni.showToast({
                title: 'åˆ é™¤å°ç« å¤±è´¥',
                icon: 'none'
              });
            }
          }
        }
      });
    },
    
    // æ ¼å¼åŒ–æ—¥æœŸ
    formatDate(timestamp) {
      if (!timestamp) return '';
      
      const date = new Date(timestamp);
      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
    },
    
    // è·å–å°ç« ç±»å‹æ–‡æœ¬
    getSealTypeText(type) {
      switch (type) {
        case 1: return 'å…¬ç« ';
        case 2: return 'è´¢åŠ¡ç« ';
        case 3: return 'åˆåŒç« ';
        case 4: return 'æ³•äººç« ';
        case 11: return 'ä¸ªäººç­¾å';
        case 12: return 'ä¸ªäººå°ç« ';
        default: return 'å…¶ä»–';
      }
    },
    
    getSealTypeClass(type) {
      switch (type) {
        case 1: return 'tag-official';
        case 2: return 'tag-finance';
        case 3: return 'tag-contract';
        case 4: return 'tag-legal';
        case 11: return 'tag-personal';
        case 12: return 'tag-personal';
        default: return 'tag-other';
      }
    },
    
    // å¤„ç†å›¾ç‰‡åŠ è½½é”™è¯¯
    handleImageError(seal) {
      console.error(`[ä¼ä¸šå°ç« ] å›¾ç‰‡åŠ è½½å¤±è´¥: ${seal.name}, URL: ${seal.image}`);
    },
    
    // å¤„ç†å›¾ç‰‡åŠ è½½æˆåŠŸ
    handleImageLoad(seal) {
      // console.log(`[ä¼ä¸šå°ç« ] å›¾ç‰‡åŠ è½½æˆåŠŸ: ${seal.name}`);
    }
  }
};
</script>

<style lang="scss">
/* æ ¹å®¹å™¨ */
.container {
  flex: 1;
  background-color: #F7F8FA;
  display: flex;
  flex-direction: column;
}

/* ä¼ä¸šä¿¡æ¯å¡ç‰‡åŒºåŸŸ - ç™½è‰²èƒŒæ™¯ */
.enterprise-section {
  background-color: #FFFFFF;
  padding: 30rpx 30rpx 30rpx; /* å¢åŠ é¡¶éƒ¨ padding */
  border-bottom: 1rpx solid #F0F2F5;
  margin-top: 20rpx; /* å¢åŠ é¡¶éƒ¨ marginï¼Œæ‹‰å¼€ä¸å¯¼èˆªæ è·ç¦» */
}

.enterprise-card {
  display: flex;
  flex-direction: row;
  align-items: center;
}

.enterprise-logo {
  width: 100rpx;
  height: 100rpx;
  border-radius: 12rpx; /* ç¨å¾®å‡å°åœ†è§’ */
  overflow: hidden;
  background-color: #F5F7FA;
  border: 1rpx solid #EEF0F4;
  margin-right: 24rpx;
}

.enterprise-logo-img {
  width: 100rpx;
  height: 100rpx;
}

.enterprise-info {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.name-row {
  display: flex;
  flex-direction: row;
  align-items: center;
  margin-bottom: 10rpx;
  flex-wrap: wrap;
}

.enterprise-name {
  font-size: 32rpx;
  font-weight: 600;
  color: #1D2129;
  line-height: 1.4;
  margin-right: 12rpx;
}

.enterprise-status {
  display: flex;
  flex-direction: row;
  align-items: center;
  background-color: #E8FFEA;
  padding: 2rpx 10rpx;
  border-radius: 6rpx;
}

.status-icon {
  font-size: 18rpx;
  color: #00C28A;
  margin-right: 6rpx;
}

.status-text {
  font-size: 20rpx;
  color: #00C28A;
  font-weight: 500;
}

.enterprise-credit-code {
  font-size: 24rpx;
  color: #86909C;
  line-height: 1.4;
}

/* å†…å®¹åŒºåŸŸ */
.content-section {
  flex: 1;
}

.action-bar {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  padding: 24rpx 30rpx;
}

.stat-info {
  display: flex;
  flex-direction: row;
  align-items: baseline;
}

.stat-label {
  font-size: 28rpx;
  color: #4E5969;
  font-weight: 500;
  margin-right: 12rpx;
}

.stat-count {
  font-size: 32rpx;
  color: #1D2129;
  font-weight: 700;
}

.create-btn {
  display: flex;
  flex-direction: row;
  align-items: center;
  background-color: #00C28A; /* å›å½’å“ç‰Œç»¿ */
  padding: 14rpx 30rpx;
  border-radius: 10rpx; /* æ”¹ä¸ºå°åœ†è§’ï¼Œæ›´å•†åŠ¡ */
  box-shadow: 0 4rpx 12rpx rgba(0, 194, 138, 0.15); /* è½»å¾®é˜´å½± */
}

.create-icon {
  color: #FFFFFF;
  font-size: 24rpx;
  margin-right: 8rpx;
}

.create-text {
  font-size: 26rpx;
  color: #FFFFFF;
  font-weight: 500;
}

/* å°ç« åˆ—è¡¨ */
.seal-list {
  padding: 0 30rpx 30rpx;
}

.seal-item {
  margin-bottom: 24rpx;
}

.seal-card {
  background-color: #FFFFFF;
  border-radius: 12rpx; /* å‡å°åœ†è§’ */
  overflow: hidden;
  box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.02);
  display: flex;
  flex-direction: column;
  border: 1rpx solid #F2F3F5;
}

.seal-card-default {
  border: 1rpx solid #00C28A; /* é»˜è®¤å°ç« ç”¨ç»¿è‰²è¾¹æ¡† */
  background-color: #F0FDF9;
}

/* ç¦ç”¨çŠ¶æ€å¡ç‰‡æ ·å¼ */
.seal-card-disabled {
  /* ä¿æŒç™½è‰²èƒŒæ™¯ï¼Œä¸å†å˜ç° */
  background-color: #FFFFFF !important;
}

/* æ–‡å­—é¢œè‰²ç»Ÿä¸€å¼±åŒ–ï¼Œä½†ä¸åƒä¹‹å‰é‚£ä¹ˆæ·¡ */
.seal-card-disabled .seal-title,
.seal-card-disabled .meta-value,
.seal-card-disabled .meta-value-highlight,
.seal-card-disabled .type-badge-text {
  color: #999999 !important;
}

/* ç¦ç”¨çŠ¶æ€ä¸‹çš„çŠ¶æ€æ ‡ç­¾ */
.seal-card-disabled .status-badge {
  background-color: #F5F5F5;
  border-color: #E0E0E0;
}
.seal-card-disabled .status-badge-text {
  color: #999999;
}

/* æ°´å°å°ç« æ ·å¼ */
.seal-watermark {
  position: absolute;
  right: 20rpx; /* ç§»åˆ°å³ä¸Šè§’ */
  top: 20rpx;  /* ç§»åˆ°å³ä¸Šè§’ */
  transform: rotate(-25deg); /* ç§»é™¤ translateYï¼Œç›´æ¥æ—‹è½¬ */
  width: 110rpx; /* ç¨å¾®å‡å°å°ºå¯¸ï¼Œé¿å…å¤ªæŠ¢çœ¼ */
  height: 110rpx;
  border: 4rpx solid #D9D9D9;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  opacity: 0.6;
  z-index: 1;
  pointer-events: none; /* ç¡®ä¿ä¸é˜»æŒ¡ç‚¹å‡» */
}

/* æ°´å°å†…åœˆï¼ˆå¯é€‰ï¼Œå¢åŠ è´¨æ„Ÿï¼‰ */
.seal-watermark::after {
  content: "";
  position: absolute;
  width: 94rpx; /* å¯¹åº”è°ƒæ•´ */
  height: 94rpx;
  border: 2rpx dashed #D9D9D9;
  border-radius: 50%;
}

.watermark-text {
  font-size: 28rpx;
  color: #C0C0C0;
  font-weight: 700;
  letter-spacing: 2rpx;
}

.card-main {
  padding: 24rpx;
  display: flex;
  flex-direction: row;
  border-bottom: 1rpx solid #F2F3F5;
  background-color: #FFFFFF;
  position: relative; /* ä¸ºæ°´å°å®šä½ */
}

.seal-img-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-right: 24rpx;
  width: 140rpx;
}

.seal-img-box {
  width: 140rpx;
  height: 140rpx;
  background-color: #F7F8FA;
  border-radius: 8rpx;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: 1rpx solid #F2F3F5;
  margin-bottom: 12rpx;
  position: relative; /* ç¡®ä¿æ°´å°ç›¸å¯¹äºæ­¤ç›’å­å®šä½ */
  overflow: hidden; /* ç¡®ä¿å°æ¡ä¸æº¢å‡ºåœ†è§’ */
}

.seal-img {
  width: 110rpx;
  height: 110rpx;
}

/* ç¦ç”¨å°æ¡æ ·å¼ */
.disabled-strip {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 40rpx; /* ç¨å¾®é«˜ä¸€ç‚¹ç‚¹ */
  background-color: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10;
  border-radius: 0 0 8rpx 8rpx; /* åŠ ä¸Šåœ†è§’ */
}

.disabled-strip-text {
  font-size: 22rpx;
  color: #FFFFFF;
  font-weight: 500;
  letter-spacing: 1rpx;
}

.seal-type-badge {
  padding: 4rpx 16rpx;
  border-radius: 6rpx; /* å°åœ†è§’ */
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #F2F3F5;
}

.type-badge-text {
  font-size: 20rpx;
  color: #4E5969;
  font-weight: 500;
}

/* æ ‡ç­¾é¢œè‰²ä¼˜åŒ– */
.tag-official .type-badge-text { color: #165DFF; }
.tag-official { background-color: #E8F3FF; }

.tag-finance .type-badge-text { color: #F53F3F; }
.tag-finance { background-color: #FFECE8; }

.tag-contract .type-badge-text { color: #00C28A; }
.tag-contract { background-color: #E8FFEA; }

.tag-legal .type-badge-text { color: #FF7D00; }
.tag-legal { background-color: #FFF7E8; }

.tag-personal .type-badge-text { color: #722ED1; }
.tag-personal { background-color: #F9F0FF; }

.tag-other .type-badge-text { color: #86909C; }
.tag-other { background-color: #F2F3F5; }

.seal-details {
  flex: 1;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
}

.seal-header {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: 12rpx;
}

.seal-title {
  flex: 1;
  font-size: 30rpx;
  font-weight: 600;
  color: #1D2129;
  lines: 1;
  text-overflow: ellipsis;
}

.status-badge {
  padding: 2rpx 8rpx;
  border-radius: 4rpx;
  background-color: #F2F3F5;
  margin-left: 12rpx;
  border: 1rpx solid #E5E6EB;
}

.status-badge-text {
  font-size: 20rpx;
  color: #86909C;
}

/* å…ƒæ•°æ®ç½‘æ ¼ */
.seal-meta-row {
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  margin-top: 12rpx;
}

.meta-item {
  display: flex;
  flex-direction: column;
}

.meta-label {
  font-size: 22rpx;
  color: #86909C;
  margin-bottom: 4rpx;
}

.meta-value {
  font-size: 26rpx;
  color: #1D2129;
}

.meta-value-highlight {
  font-size: 28rpx;
  color: #00C28A; /* ç»Ÿä¸€ç”¨ç»¿è‰²é«˜äº® */
  font-weight: 600;
}

/* åº•éƒ¨æ“ä½œæ  */
.card-actions {
  display: flex;
  flex-direction: row;
  align-items: center;
  padding: 0;
  height: 80rpx; /* ç¨å¾®å‡å°é«˜åº¦ */
  background-color: #FFFFFF;
}

.action-item {
  flex: 1;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: center;
  height: 100%;
}

.action-content {
  display: flex;
  flex-direction: row;
  align-items: center;
}

.action-icon {
  font-size: 28rpx;
  margin-right: 8rpx;
}

.action-text {
  font-size: 26rpx;
  font-weight: 400;
}

.text-primary { color: #00C28A; }
.text-danger { color: #F53F3F; }
.text-gray { color: #86909C; }
.text-gray-dark { color: #4E5969; }

.action-line {
  width: 1rpx;
  height: 24rpx;
  background-color: #E5E6EB;
}

/* ç©ºçŠ¶æ€ */
.empty-state {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 160rpx 0;
}

.empty-image {
  width: 280rpx;
  height: 280rpx;
  margin-bottom: 40rpx;
  opacity: 0.6;
}

.empty-title {
  font-size: 32rpx;
  font-weight: 600;
  color: #1D2129;
  margin-bottom: 16rpx;
}

.empty-desc {
  font-size: 26rpx;
  color: #86909C;
  margin-bottom: 48rpx;
}

.empty-btn {
  background-color: #00C28A;
  color: #FFFFFF;
  font-size: 28rpx;
  padding: 0 60rpx;
  height: 72rpx;
  line-height: 72rpx;
  border-radius: 8rpx; /* å°åœ†è§’ */
  width: 280rpx;
}

/* åŠ è½½ä¸­ */
.loading-state {
  padding: 40rpx;
  display: flex;
  justify-content: center;
  align-items: center;
}

.loading-spinner {
  width: 36rpx;
  height: 36rpx;
  border: 3rpx solid #E5E6EB;
  border-top-color: #00C28A;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.safe-area-bottom {
  height: env(safe-area-inset-bottom);
}

/* å³ä¸‹è§’æ‚¬æµ®æŒ‰é’® */
.fab-btn {
  position: fixed;
  right: 40rpx;
  bottom: calc(40rpx + env(safe-area-inset-bottom));
  width: 110rpx;
  height: 110rpx;
  background-color: #00C28A;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 8rpx 20rpx rgba(0, 194, 138, 0.35);
  z-index: 99;
}

.fab-icon {
  color: #FFFFFF;
  font-size: 48rpx;
}
</style>