<script lang="uts">
	import { getTemplateDetail } from '../../api/templates/index';
	import type { TemplateDetail } from '../../api/templates/index';
	import { getSealPageUrl } from '../../api/seals/index';
	import { formatDateTime } from '../../utils/date';
	import { kycGuardMixin } from '../../utils/kyc-check';
	import KycModal from '../../components/KycModal.uvue';
	
	export default {
		mixins: [kycGuardMixin],
		components: {
			KycModal
		},
		data() {
			return {
				// æ¨¡æ¿ID
				templateId: '',
				// æ¨¡æ¿è¯¦æƒ…
				templateDetail: null as TemplateDetail | null,
				// åŠ è½½çŠ¶æ€
				isLoading: false,
			// H5é¢„è§ˆé¡µé¢URL
			viewUrl: '',
			// PDFé¢„è§ˆå›¾åŠ è½½çŠ¶æ€
			imageLoading: true
			}
		},
		onLoad(options: any) {
		// æ£€æŸ¥å®åè®¤è¯çŠ¶æ€
		this.checkKycStatus();
		
			// ä»è·¯ç”±å‚æ•°ä¸­è·å–æ¨¡æ¿ID
			if (options && options.id) {
				this.templateId = options.id;
				console.log('åŠ è½½æ¨¡æ¿è¯¦æƒ…ï¼ŒID:', this.templateId);
				// è·å–æ¨¡æ¿è¯¦æƒ…
				this.getTemplateDetail();
			} else {
				uni.showToast({
					title: 'æ¨¡æ¿IDä¸å­˜åœ¨',
					icon: 'none'
				});
				// å»¶è¿Ÿè¿”å›
				setTimeout(() => {
					uni.navigateBack();
				}, 1500);
			}
		},
		methods: {
			// è·å–æ¨¡æ¿è¯¦æƒ…
			async getTemplateDetail(): Promise<void> {
				if (this.isLoading) return;
				
				this.isLoading = true;
				
				uni.showLoading({
					title: 'åŠ è½½ä¸­'
				});
				
				try {
					// ä½¿ç”¨çœŸå®API
					const detail = await getTemplateDetail(this.templateId);
					
					this.templateDetail = detail;
					
					console.log('æ¨¡æ¿è¯¦æƒ…åŠ è½½æˆåŠŸ:', detail);
				} catch (error) {
					console.error('è·å–æ¨¡æ¿è¯¦æƒ…å¤±è´¥:', error);
					uni.showToast({
						title: 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•',
						icon: 'none'
					});
				} finally {
					this.isLoading = false;
					uni.hideLoading();
				}
			},
			
	// é¢„è§ˆæ¨¡æ¿ï¼ˆå¸¦å­—æ®µä½ç½®æ ‡è®°ï¼‰
	async handlePreview(): Promise<void> {
		if (!this.templateDetail) return;
		
		console.log('[æ¨¡æ¿è¯¦æƒ…] ğŸ†• å‡†å¤‡ä½¿ç”¨æ–°çš„æ¨¡æ¿é¢„è§ˆæ¨¡å¼:', {
			id: this.templateId,
			name: this.templateDetail.name,
			content: this.templateDetail.content,
			fieldCount: this.getAllFields().length
		});
		
		// æ„å»ºæ¨¡æ¿é¢„è§ˆ H5 URL - ä½¿ç”¨æ–°çš„ template-preview æ¨¡å¼
		const fileUrl = this.templateDetail.content || this.templateDetail.previewUrl;
		
		if (!fileUrl) {
			uni.showToast({
				title: 'æ¨¡æ¿æ–‡ä»¶ä¸å­˜åœ¨',
				icon: 'none'
			});
			return;
		}
		
		// ä½¿ç”¨æ–°çš„ getSealPageUrl å‡½æ•°ï¼Œä¼ å…¥ template-preview æ¨¡å¼
		// âœ… getSealPageUrl ç°åœ¨æ˜¯å¼‚æ­¥å‡½æ•°ï¼Œéœ€è¦ await
		// ğŸ”§ ä¿®å¤ï¼šä¼ é€’ templateId å‚æ•°ï¼ˆè€Œä¸æ˜¯ fileUrlï¼‰
		this.viewUrl = await getSealPageUrl('template-preview', undefined, {
			templateId: Number(this.templateId)
		});
			
			console.log('[æ¨¡æ¿è¯¦æƒ…] âœ… ç”ŸæˆH5æ¨¡æ¿é¢„è§ˆURL:', this.viewUrl);
			
			// è·³è½¬åˆ° WebView é¡µé¢ï¼ˆåˆ›å»ºæ–°é¡µé¢æˆ–ä½¿ç”¨ç°æœ‰çš„ h5-view é¡µé¢ï¼‰
			uni.navigateTo({
				url: `/pages/template-preview/h5-preview?url=${encodeURIComponent(this.viewUrl)}`
			});
		},
			
		// ä½¿ç”¨æ­¤æ¨¡æ¿åˆ›å»ºåˆåŒ
		handleUseTemplate(): void {
			if (!this.templateDetail) return;
		
		// å…ˆæ£€æŸ¥å®åè®¤è¯çŠ¶æ€
		if (!this.checkCanProceed()) {
			console.log('[æ¨¡æ¿è¯¦æƒ…] æœªå®Œæˆå®åè®¤è¯ï¼Œæ˜¾ç¤ºæç¤ºå¼¹çª—');
			return;
		}
			
			console.log('[æ¨¡æ¿è¯¦æƒ…] ä½¿ç”¨æ¨¡æ¿åˆ›å»ºåˆåŒ:', this.templateId);
			
			// è·³è½¬åˆ°H5åˆ›å»ºåˆåŒé¡µé¢ï¼Œä¼ é€’æ¨¡æ¿ID
			uni.navigateTo({
				url: `/pages/contract-create/h5-create?templateId=${this.templateId}`
			});
		},
			
			// æ ¼å¼åŒ–æ—¶é—´
			formatTime(dateTime: string | null): string {
				return formatDateTime(dateTime);
			},
			
			// è·å–ç­¾ç½²æ–¹ç±»å‹æ˜¾ç¤ºæ–‡å­—
		getSignatoryTypeText(type: string): string {
			return type === 'enterprise' ? 'ä¼ä¸š' : 'ä¸ªäºº';
		},
		
		// è·å–æ‰€æœ‰å­—æ®µåˆ—è¡¨ï¼ˆä»ç­¾ç½²æ–¹ä¸­æå–ï¼‰
		getAllFields(): any[] {
			const allFields: any[] = [];
			if (this.templateDetail && this.templateDetail.signatories) {
				this.templateDetail.signatories.forEach((signatory: any, index: number) => {
					if (signatory.fields && signatory.fields.length > 0) {
						signatory.fields.forEach((field: any) => {
							allFields.push({
								...field,
								signatoryIndex: index,
								signatoryName: signatory.name,
								signatoryType: signatory.type
							});
						});
					}
				});
			}
			return allFields;
		},
		
		// è®¡ç®—å­—æ®µæ ‡è®°çš„æ ·å¼ä½ç½®
		getFieldMarkerStyle(field: any): object {
			// å°†åç«¯è¿”å›çš„åæ ‡è½¬æ¢ä¸ºCSSæ ·å¼å¯¹è±¡
			// æ³¨æ„ï¼šè¿™é‡Œéœ€è¦æ ¹æ®å®é™…çš„PDFå°ºå¯¸å’Œæ˜¾ç¤ºå°ºå¯¸è¿›è¡Œç¼©æ”¾
			// å‡è®¾PDFå®½åº¦ä¸º595ptï¼ˆA4ï¼‰ï¼Œæ˜¾ç¤ºå®½åº¦ä¸º690rpxï¼ˆå±å¹•å®½åº¦-60rpxè¾¹è·ï¼‰
			const scaleX = 690 / 595;
			const scaleY = scaleX; // ä¿æŒæ¯”ä¾‹
			
			const left = (field.positionX || 0) * scaleX;
			const top = (field.positionY || 0) * scaleY;
			const width = (field.width || 100) * scaleX;
			const height = (field.height || 30) * scaleY;
			
			return {
				left: `${left}rpx`,
				top: `${top}rpx`,
				width: `${width}rpx`,
				height: `${height}rpx`
			};
		},
		
		// æ ¹æ®ç­¾ç½²æ–¹ç´¢å¼•è·å–é¢œè‰²ç±»
		getSignatoryColorClass(signatoryIndex: number): string {
			if (signatoryIndex === 0) {
				return 'signatory-1';
			} else if (signatoryIndex === 1) {
				return 'signatory-2';
			} else {
				return 'signatory-other';
			}
		},
		
		// æ˜¾ç¤ºå­—æ®µè¯¦æƒ…
		showFieldDetail(field: any): void {
			const message = `å­—æ®µåç§°ï¼š${field.name}\næ‰€å±ç­¾ç½²æ–¹ï¼š${field.signatoryName}\næ‰€åœ¨é¡µç ï¼šç¬¬ ${field.pageNumber} é¡µ\nå­—æ®µç±»å‹ï¼š${field.type}\næ˜¯å¦å¿…å¡«ï¼š${field.required ? 'æ˜¯' : 'å¦'}`;
			
			uni.showModal({
				title: 'å­—æ®µè¯¦æƒ…',
				content: message,
				showCancel: false,
				confirmText: 'çŸ¥é“äº†'
			});
		},
		
		// è·å–PDFé¢„è§ˆå›¾URL
		getPreviewImageUrl(): string {
			if (!this.templateDetail) return '';
			
			// ä¼˜å…ˆçº§ï¼š
			// 1. previewImage - ä¸“é—¨çš„PDFé¢„è§ˆå›¾ï¼ˆé«˜æ¸…ï¼‰
			// 2. image - æ¨¡æ¿ç¼©ç•¥å›¾
			// 3. thumbnail - å°ç¼©ç•¥å›¾
			// 4. content - PDFæ–‡ä»¶URLï¼ˆæŸäº›æƒ…å†µä¸‹å¯èƒ½æ˜¯å›¾ç‰‡æ ¼å¼ï¼‰
			return this.templateDetail.previewImage 
				|| this.templateDetail.image 
				|| this.templateDetail.thumbnail 
				|| '';
		},
		
		// PDFé¢„è§ˆå›¾åŠ è½½å®Œæˆ
		onImageLoad(): void {
			console.log('[æ¨¡æ¿è¯¦æƒ…] PDFé¢„è§ˆå›¾åŠ è½½å®Œæˆ');
			this.imageLoading = false;
		},
		
		// PDFé¢„è§ˆå›¾åŠ è½½å¤±è´¥
		onImageError(): void {
			console.error('[æ¨¡æ¿è¯¦æƒ…] PDFé¢„è§ˆå›¾åŠ è½½å¤±è´¥');
			this.imageLoading = false;
					uni.showToast({
				title: 'PDFé¢„è§ˆå›¾åŠ è½½å¤±è´¥',
				icon: 'none',
				duration: 2000
			});
			}
		}
	}
</script>

<template>
	<view class="template-detail">
		<!-- å†…å®¹åŒºåŸŸ -->
		<scroll-view scroll-y="true" class="content">
			<!-- åŠ è½½ä¸­ -->
			<view v-if="isLoading" class="loading-container">
				<view class="loading-spinner"></view>
				<text class="loading-text">åŠ è½½ä¸­...</text>
			</view>
			
			<!-- æ¨¡æ¿è¯¦æƒ… -->
			<view v-else-if="templateDetail" class="detail-content">
				<!-- æ¨¡æ¿åŸºæœ¬ä¿¡æ¯ -->
				<view class="template-info-card">
					<view class="template-header">
						<view class="template-title-row">
							<text class="template-title">{{ templateDetail.name }}</text>
							<view v-if="templateDetail.isOfficial" class="official-badge">
								<text class="icon icon-check-circle badge-icon"></text>
								<text class="badge-text">å®˜æ–¹</text>
			</view>
			</view>
						<text v-if="templateDetail.description" class="template-desc">{{ templateDetail.description }}</text>
		</view>
		
					<!-- æ¨¡æ¿å…ƒä¿¡æ¯ -->
					<view class="template-meta">
						<view class="meta-item">
							<text class="icon icon-folder meta-icon"></text>
							<text class="meta-text">{{ templateDetail.categoryName || 'æœªåˆ†ç±»' }}</text>
				</view>
						<view class="meta-item">
							<text class="icon icon-chart-line meta-icon"></text>
							<text class="meta-text">{{ templateDetail.usageCount || 0 }} æ¬¡ä½¿ç”¨</text>
			</view>
						<view v-if="templateDetail.isHot" class="meta-item hot-tag">
							<text class="icon icon-fire meta-icon"></text>
							<text class="meta-text">çƒ­é—¨</text>
				</view>
			</view>
		</view>
		
			<!-- æ¨¡æ¿é¢„è§ˆï¼ˆå­—æ®µä½ç½®å¯è§†åŒ–ï¼‰ -->
			<view class="template-preview-card">
				<view class="preview-header-row">
					<view class="preview-header">
						<text class="icon icon-file-pdf section-icon"></text>
						<text class="section-title">å­—æ®µä½ç½®é¢„è§ˆ</text>
							</view>
					<view class="preview-actions" v-if="templateDetail.content">
						<view class="view-pdf-btn" @click="handlePreview">
							<text class="icon icon-expand view-pdf-icon"></text>
							<text class="view-pdf-text">æŸ¥çœ‹å®Œæ•´PDF</text>
						</view>
						</view>
					</view>
				<text class="preview-tip">åœ¨PDFé¢„è§ˆå›¾ä¸Šç›´è§‚æŸ¥çœ‹å­—æ®µä½ç½® Â· ç‚¹å‡»å­—æ®µæŸ¥çœ‹è¯¦æƒ…</text>
				
				<!-- PDFé¢„è§ˆå›¾å®¹å™¨ï¼ˆå¸¦å­—æ®µæ ‡è®°ï¼‰ -->
				<view class="pdf-preview-container" v-if="getPreviewImageUrl()">
					<view class="pdf-page-wrapper">
						<!-- PDFé¢„è§ˆå›¾ -->
						<image 
							class="pdf-page-image" 
							:src="getPreviewImageUrl()" 
							mode="widthFix"
							@load="onImageLoad"
							@error="onImageError"
						></image>
						
						<!-- åŠ è½½æç¤º -->
						<view class="image-loading" v-if="imageLoading">
							<text class="loading-spinner"></text>
							<text class="loading-text">åŠ è½½PDFé¢„è§ˆä¸­...</text>
					</view>
						
						<!-- å­—æ®µæ ‡è®°å åŠ å±‚ -->
						<view class="fields-overlay" v-if="!imageLoading && getAllFields().length > 0">
							<view 
								v-for="(field, index) in getAllFields()" 
								:key="'field-' + index"
								class="field-marker"
								:class="getSignatoryColorClass(field.signatoryIndex)"
								:style="getFieldMarkerStyle(field)"
								@click="showFieldDetail(field)"
							>
								<view class="field-marker-border"></view>
								<view class="field-marker-label">
									<text class="field-label-text">{{ field.name }}</text>
					</view>
				</view>
				</view>
			</view>
			
				<!-- å­—æ®µå¿«é€Ÿæµè§ˆåˆ—è¡¨ -->
				<view class="fields-quick-list" v-if="getAllFields().length > 0">
					<text class="quick-list-title">
						<text class="icon icon-clipboard-list"></text>
						å­—æ®µæ¸…å•ï¼ˆ{{ getAllFields().length }}ä¸ªï¼‰
					</text>
					<view class="fields-grid">
					<view
								v-for="(field, index) in getAllFields()" 
								:key="'quick-' + index"
								class="quick-field-chip"
								@click="showFieldDetail(field)"
							>
								<view class="quick-field-dot" :class="getSignatoryColorClass(field.signatoryIndex)"></view>
								<text class="quick-field-name">{{ field.name }}</text>
								<text class="quick-field-page">P{{ field.pageNumber }}</text>
						</view>
								</view>
					</view>
						</view>
						
			<!-- æ— é¢„è§ˆå›¾æç¤º -->
			<view class="no-preview-container" v-else>
				<text class="icon icon-file-pdf no-preview-icon"></text>
				<text class="no-preview-text">æš‚æ— PDFé¢„è§ˆå›¾</text>
				<text class="no-preview-hint">ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æŸ¥çœ‹å®Œæ•´PDF</text>
				<view class="preview-btn-wrapper" v-if="templateDetail.content">
					<view class="preview-btn" @click="handlePreview">
						<text class="icon icon-eye preview-btn-icon"></text>
						<text class="preview-btn-text">é¢„è§ˆå®Œæ•´PDF</text>
								</view>
				</view>
						</view>
						
			<!-- å­—æ®µå›¾ä¾‹ -->
			<view class="field-legend" v-if="getAllFields().length > 0">
				<text class="legend-title">
					<text class="icon icon-info-circle"></text>
					é¢œè‰²è¯´æ˜ï¼š
				</text>
				<view class="legend-items">
						<view class="legend-item">
							<view class="legend-color signatory-1"></view>
							<text class="legend-text">ç¬¬ä¸€ç­¾ç½²æ–¹</text>
					</view>
						<view class="legend-item">
							<view class="legend-color signatory-2"></view>
							<text class="legend-text">ç¬¬äºŒç­¾ç½²æ–¹</text>
				</view>
						<view class="legend-item">
							<view class="legend-color signatory-other"></view>
							<text class="legend-text">å…¶ä»–ç­¾ç½²æ–¹</text>
			</view>
					</view>
				</view>
					</view>
					
				<!-- æ¨¡æ¿å˜é‡è¯´æ˜ï¼ˆå¦‚æœæœ‰ï¼‰ -->
				<view v-if="templateDetail.variables && templateDetail.variables.length > 0" class="template-variables-card">
					<text class="section-title">éœ€è¦å¡«å†™çš„ä¿¡æ¯</text>
					<view class="variables-list">
						<view v-for="(variable, index) in templateDetail.variables" :key="index" class="variable-item">
							<view class="variable-header">
								<text class="variable-name">{{ variable.name }}</text>
								<view v-if="variable.required" class="required-tag">
									<text class="required-text">å¿…å¡«</text>
						</view>
							</view>
							<text v-if="variable.placeholder" class="variable-placeholder">{{ variable.placeholder }}</text>
							</view>
						</view>
					</view>
					
				<!-- ç­¾ç½²æ–¹ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ -->
				<view v-if="templateDetail.signatories && templateDetail.signatories.length > 0" class="template-signatories-card">
					<text class="section-title">ç­¾ç½²æ–¹ä¿¡æ¯</text>
					<view class="signatories-list">
						<view v-for="(signatory, index) in templateDetail.signatories" :key="index" class="signatory-item">
							<view class="signatory-header">
								<view class="signatory-name-row">
									<text class="signatory-name">{{ signatory.name }}</text>
									<view class="signatory-type-tag">
										<text class="signatory-type-text">{{ getSignatoryTypeText(signatory.type) }}</text>
							</view>
						</view>
								<view v-if="signatory.needSign" class="sign-badge">
									<text class="icon icon-signature sign-icon"></text>
									<text class="sign-text">éœ€è¦ç­¾ç½²</text>
							</view>
						</view>
						
							<!-- ç­¾ç½²æ–¹å…³è”å­—æ®µ -->
							<view v-if="signatory.fields && signatory.fields.length > 0" class="signatory-fields">
							<text class="fields-title">éœ€è¦å¡«å†™/ç­¾ç½²çš„ä½ç½®ï¼š</text>
							<view class="fields-list">
								<view v-for="(field, fidx) in signatory.fields" :key="fidx" class="field-chip">
									<text class="icon icon-edit field-icon"></text>
									<text class="field-name">{{ field.name }}</text>
									<text class="field-page">ç¬¬{{ field.pageNumber }}é¡µ</text>
							</view>
						</view>
							</view>
						</view>
						</view>
					</view>
					
				<!-- æ¨¡æ¿æ›´æ–°æ—¶é—´ -->
				<view class="template-time-card">
					<view class="time-item">
						<text class="icon icon-clock time-icon"></text>
						<text class="time-text">æ›´æ–°äº {{ formatTime(templateDetail.updateTime) }}</text>
					</view>
				</view>
			</view>
		</scroll-view>
		
	<!-- åº•éƒ¨å›ºå®šæ“ä½œæ  -->
	<view class="bottom-bar" v-if="templateDetail">
		<view class="bottom-button primary full-width" @click="handleUseTemplate">
			<text class="icon icon-plus-circle btn-icon"></text>
			<text class="btn-text">ä½¿ç”¨æ­¤æ¨¡ç‰ˆ</text>
			</view>
		</view>
	
	<!-- å®åè®¤è¯æç¤ºå¼¹çª— - ä½¿ç”¨ç»Ÿä¸€ç»„ä»¶ -->
	<kyc-modal 
		:visible="showKycModal"
		description="ä¸ºä¿éšœåˆåŒçš„æ³•å¾‹æ•ˆåŠ›ï¼Œä½¿ç”¨æ¨¡æ¿åˆ›å»ºåˆåŒå‰éœ€è¦å®Œæˆå®åè®¤è¯ã€‚"
		@close="closeKycModal"
		@confirm="goToKyc"
	/>
	</view>
</template>

<style>
/* FontAwesomeåŸºç¡€æ ·å¼ */
.fa {
	font-family: FontAwesome;
	font-size: 26rpx;
	font-style: normal;
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}

/* é¡µé¢å®¹å™¨ */
	.template-detail {
		flex: 1;
		background-color: #F7F9FC;
	}
	
/* å†…å®¹æ»šåŠ¨åŒºåŸŸ */
.content {
		flex: 1;
	padding-bottom: 140rpx; /* ä¸ºåº•éƒ¨æ“ä½œæ é¢„ç•™ç©ºé—´ */
}

/* åŠ è½½ä¸­å®¹å™¨ */
.loading-container {
	width: 100%;
	height: 100%;
		align-items: center;
		justify-content: center;
	padding-top: 200rpx;
}

.loading-spinner {
		width: 80rpx;
		height: 80rpx;
	border-width: 4rpx;
	border-style: solid;
	border-color: #E4E7ED;
	border-top-color: #00C28A;
	border-radius: 40rpx;
	animation: spin 1s linear infinite;
}

@keyframes spin {
	0% {
		transform: rotate(0deg);
	}
	100% {
		transform: rotate(360deg);
	}
}

.loading-text {
	font-size: 28rpx;
	color: #909399;
	margin-top: 30rpx;
}

/* è¯¦æƒ…å†…å®¹åŒºåŸŸ */
.detail-content {
	padding: 30rpx;
}

/* é€šç”¨å¡ç‰‡æ ·å¼ */
.template-info-card,
.template-preview-card,
.template-variables-card,
.template-signatories-card,
.template-time-card {
		background-color: #FFFFFF;
	border-radius: 16rpx;
	padding: 32rpx;
	margin-bottom: 24rpx;
	box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.04);
}

/* æ¨¡æ¿åŸºæœ¬ä¿¡æ¯ */
.template-header {
	margin-bottom: 24rpx;
	}
	
	.template-title-row {
		flex-direction: row;
		align-items: center;
	margin-bottom: 16rpx;
	}
	
	.template-title {
	font-size: 36rpx;
	font-weight: 600;
	color: #303133;
	flex: 1;
	margin-right: 16rpx;
}

.official-badge {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	flex-direction: row;
		align-items: center;
	background-color: rgba(0, 194, 138, 0.08);
	padding: 6rpx 16rpx;
	border-radius: 20rpx;
}
	
.badge-icon {
		font-size: 24rpx;
	color: #00C28A;
	margin-right: 6rpx;
}

.badge-text {
	font-size: 22rpx;
	color: #00C28A;
	font-weight: 500;
	}
	
	.template-desc {
		font-size: 28rpx;
	color: #606266;
	line-height: 44rpx;
}

/* æ¨¡æ¿å…ƒä¿¡æ¯ */
.template-meta {
		flex-direction: row;
	flex-wrap: wrap;
	gap: 16rpx;
}

.meta-item {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	flex-direction: row;
		align-items: center;
	background-color: #F5F7FA;
	padding: 8rpx 16rpx;
	border-radius: 20rpx;
	}
	
.meta-item.hot-tag {
	background-color: rgba(255, 108, 108, 0.08);
	}
	
.meta-icon {
		font-size: 24rpx;
	color: #909399;
	margin-right: 6rpx;
}

.meta-item.hot-tag .meta-icon {
	color: #F56C6C;
}

.meta-text {
		font-size: 24rpx;
	color: #606266;
}

.meta-item.hot-tag .meta-text {
	color: #F56C6C;
}

/* æ¨¡æ¿ç¼©ç•¥å›¾ */
.section-title {
		font-size: 30rpx;
	font-weight: 600;
	color: #303133;
	margin-bottom: 24rpx;
	display: block;
}

.thumbnail-image {
	width: 100%;
	height: 400rpx;
	border-radius: 12rpx;
	background-color: #F5F7FA;
}

/* æ¨¡æ¿å˜é‡åˆ—è¡¨ */
.variables-list {
	gap: 16rpx;
}

.variable-item {
		padding: 20rpx;
	background-color: #F7F8FA;
	border-radius: 12rpx;
	border: 1rpx solid #E4E7ED;
	}
	
.variable-header {
		flex-direction: row;
		align-items: center;
	margin-bottom: 8rpx;
	}
	
.variable-name {
		font-size: 28rpx;
	color: #303133;
	font-weight: 500;
	flex: 1;
}

.required-tag {
	background-color: rgba(245, 108, 108, 0.08);
		padding: 4rpx 12rpx;
	border-radius: 12rpx;
}

.required-text {
	font-size: 22rpx;
	color: #F56C6C;
}

.variable-placeholder {
	font-size: 24rpx;
	color: #909399;
	line-height: 38rpx;
}

/* ç­¾ç½²æ–¹åˆ—è¡¨ */
.signatories-list {
	gap: 20rpx;
}

.signatory-item {
	padding: 24rpx;
	background-color: #F7F8FA;
	border-radius: 12rpx;
	border: 1rpx solid #E4E7ED;
}

.signatory-header {
	margin-bottom: 16rpx;
}

.signatory-name-row {
		flex-direction: row;
		align-items: center;
	margin-bottom: 12rpx;
}

.signatory-name {
	font-size: 30rpx;
	color: #303133;
	font-weight: 600;
	flex: 1;
	margin-right: 12rpx;
}

.signatory-type-tag {
	background-color: rgba(24, 144, 255, 0.08);
		padding: 4rpx 12rpx;
	border-radius: 12rpx;
}

.signatory-type-text {
	font-size: 22rpx;
	color: #1890FF;
}

.sign-badge {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	flex-direction: row;
	align-items: center;
	background-color: rgba(0, 194, 138, 0.08);
	padding: 6rpx 16rpx;
	border-radius: 20rpx;
	align-self: flex-start;
}

.sign-icon {
	font-size: 22rpx;
	color: #00C28A;
	margin-right: 6rpx;
}

.sign-text {
	font-size: 22rpx;
	color: #00C28A;
	font-weight: 500;
}

/* ç­¾ç½²æ–¹å­—æ®µ */
.signatory-fields {
	margin-top: 16rpx;
	padding-top: 16rpx;
	border-top: 1rpx solid #E4E7ED;
}

.fields-title {
		font-size: 24rpx;
	color: #606266;
	margin-bottom: 12rpx;
	display: block;
}

.fields-list {
	flex-direction: row;
	flex-wrap: wrap;
	gap: 12rpx;
}

.field-chip {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
		flex-direction: row;
		align-items: center;
	background-color: #FFFFFF;
	padding: 8rpx 16rpx;
	border-radius: 20rpx;
	border: 1rpx solid #DCDFE6;
}

.field-icon {
	font-size: 22rpx;
	margin-right: 8rpx;
	color: #00C28A;
}

.field-name {
	font-size: 22rpx;
	color: #303133;
	margin-right: 8rpx;
}

.field-page {
	font-size: 20rpx;
	color: #909399;
}

/* æ—¶é—´ä¿¡æ¯ */
.time-item {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	flex-direction: row;
	align-items: center;
}

.time-icon {
	font-size: 24rpx;
	color: #909399;
	margin-right: 8rpx;
}

.time-text {
	font-size: 24rpx;
	color: #909399;
}

/* åº•éƒ¨å›ºå®šæ“ä½œæ  */
.bottom-bar {
		position: fixed;
		bottom: 0;
		left: 0;
		right: 0;
		background-color: #FFFFFF;
	padding: 20rpx 30rpx;
	box-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);
		flex-direction: row;
	gap: 20rpx;
	/* å®‰å…¨åŒºåŸŸé€‚é… */
	padding-bottom: calc(20rpx + env(safe-area-inset-bottom));
}

/* åº•éƒ¨æŒ‰é’® */
.bottom-button {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	flex: 1;
	height: 88rpx;
	border-radius: 44rpx;
		flex-direction: row;
		align-items: center;
	justify-content: center;
	transition: opacity 0.3s;
}

.bottom-button:active {
	opacity: 0.9;
}

/* ä¸»è¦æŒ‰é’®ï¼ˆä½¿ç”¨ï¼‰ */
.bottom-button.primary {
	background-color: #00C28A;
}

.bottom-button.primary .btn-icon {
	color: #FFFFFF;
}

.bottom-button.primary .btn-text {
	color: #FFFFFF;
}

/* å…¨å®½æŒ‰é’® */
.bottom-button.full-width {
	flex: none;
	width: 100%;
}
	
.btn-icon {
	font-size: 32rpx;
	margin-right: 8rpx;
}

.btn-text {
	font-size: 30rpx;
	font-weight: 500;
}

/* ==================== å­—æ®µä½ç½®é¢„è§ˆæ ·å¼ ==================== */

/* é¢„è§ˆå¡ç‰‡å¤´éƒ¨è¡Œ */
.preview-header-row {
		flex-direction: row;
		align-items: center;
		justify-content: space-between;
	margin-bottom: 12rpx;
}

/* é¢„è§ˆå¡ç‰‡å¤´éƒ¨ */
.preview-header {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	flex-direction: row;
	align-items: center;
}

.preview-header .section-title {
	display: inline-block;  /* è¦†ç›–é»˜è®¤çš„blockï¼Œä½¿å…¶å‚ä¸flexå¸ƒå±€ */
	margin-bottom: 0;  /* ç§»é™¤åº•éƒ¨è¾¹è·ï¼Œé¿å…å½±å“å¯¹é½ */
}

.section-icon {
	font-size: 32rpx;
	color: #00C28A;
	margin-right: 12rpx;
}

/* é¢„è§ˆæ“ä½œæŒ‰é’® */
.preview-actions {
	flex-shrink: 0;
}

.view-pdf-btn {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	flex-direction: row;
	align-items: center;
	padding: 8rpx 16rpx;
	background-color: rgba(24, 144, 255, 0.08);
	border-radius: 20rpx;
	cursor: pointer;
	transition: background-color 0.2s;
}

.view-pdf-btn:active {
	background-color: rgba(24, 144, 255, 0.15);
}

.view-pdf-icon {
		font-size: 24rpx;
	color: #1890FF;
	margin-right: 6rpx;
	}
	
.view-pdf-text {
		font-size: 24rpx;
	color: #1890FF;
	font-weight: 500;
}

.preview-tip {
	font-size: 24rpx;
	color: #909399;
	margin-bottom: 24rpx;
}

/* å›¾ç‰‡åŠ è½½ä¸­ */
.image-loading {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	flex-direction: column;
		align-items: center;
	background-color: rgba(255, 255, 255, 0.95);
	padding: 30rpx;
	border-radius: 12rpx;
	box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.1);
}

.loading-spinner {
	width: 60rpx;
	height: 60rpx;
	border-width: 4rpx;
	border-style: solid;
	border-color: #E4E7ED;
	border-top-color: #00C28A;
	border-radius: 30rpx;
	animation: spin 1s linear infinite;
}

@keyframes spin {
	0% {
		transform: rotate(0deg);
	}
	100% {
		transform: rotate(360deg);
	}
}

.loading-text {
	font-size: 24rpx;
	color: #606266;
		margin-top: 20rpx;
	}
	
/* PDFé¢„è§ˆå®¹å™¨ */
.pdf-preview-container {
	width: 100%;
	background-color: #F7F9FC;
	border-radius: 12rpx;
	padding: 20rpx;
	margin-bottom: 20rpx;
}

.pdf-page-wrapper {
	position: relative;
	width: 100%;
	background-color: #FFFFFF;
		border-radius: 8rpx;
		overflow: hidden;
	box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);
}

.pdf-page-image {
	width: 100%;
	display: block;
}

/* å­—æ®µæ ‡è®°å åŠ å±‚ */
.fields-overlay {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
		bottom: 0;
	pointer-events: none;
}

.field-marker {
	position: absolute;
	pointer-events: all;
	cursor: pointer;
	transition: all 0.2s ease;
}

.field-marker:active {
	transform: scale(1.05);
}

/* å­—æ®µæ ‡è®°è¾¹æ¡† */
.field-marker-border {
	position: absolute;
	top: 0;
		left: 0;
		right: 0;
	bottom: 0;
	border-width: 3rpx;
	border-style: solid;
	border-radius: 6rpx;
	background-color: rgba(255, 255, 255, 0.1);
}

/* å­—æ®µæ ‡è®°æ ‡ç­¾ */
.field-marker-label {
	position: absolute;
	bottom: 100%;
	left: 0;
	min-width: 120rpx;
	padding: 4rpx 12rpx;
	background-color: rgba(0, 0, 0, 0.75);
	border-radius: 6rpx;
	margin-bottom: 6rpx;
	white-space: nowrap;
}

.field-label-text {
	font-size: 22rpx;
		color: #FFFFFF;
	font-weight: 500;
}

/* ä¸åŒç­¾ç½²æ–¹çš„é¢œè‰² */
.field-marker.signatory-1 .field-marker-border {
	border-color: #1890FF;
}

.field-marker.signatory-2 .field-marker-border {
	border-color: #52C41A;
}

.field-marker.signatory-other .field-marker-border {
	border-color: #FA8C16;
}

/* æ— å­—æ®µæç¤º */
.no-fields-tip {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	flex-direction: column;
		align-items: center;
	padding: 30rpx;
	background-color: rgba(255, 255, 255, 0.95);
	border-radius: 12rpx;
}

.tip-icon {
	font-size: 48rpx;
	color: #909399;
	margin-bottom: 12rpx;
}

.tip-text {
	font-size: 24rpx;
	color: #909399;
}

/* å­—æ®µå¿«é€Ÿæµè§ˆåˆ—è¡¨ */
.fields-quick-list {
	padding-top: 20rpx;
	margin-top: 20rpx;
	border-top: 1rpx solid #EBEEF5;
}

.quick-list-title {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	font-size: 26rpx;
	color: #303133;
	font-weight: 500;
	margin-bottom: 16rpx;
		flex-direction: row;
	align-items: center;
}

.quick-list-title .fa {
	margin-right: 8rpx;
	color: #00C28A;
}

.fields-grid {
	flex-direction: row;
	flex-wrap: wrap;
	gap: 12rpx;
}

.quick-field-chip {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
		flex-direction: row;
		align-items: center;
	padding: 8rpx 16rpx;
	background-color: #F7F8FA;
	border-radius: 20rpx;
	border: 1rpx solid #E4E7ED;
	cursor: pointer;
	transition: all 0.2s;
}

.quick-field-chip:active {
	transform: translateY(-2rpx);
	box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.08);
}

.quick-field-dot {
	width: 16rpx;
	height: 16rpx;
		border-radius: 8rpx;
	margin-right: 8rpx;
	flex-shrink: 0;
}

.quick-field-dot.signatory-1 {
	background-color: #1890FF;
}

.quick-field-dot.signatory-2 {
	background-color: #52C41A;
}

.quick-field-dot.signatory-other {
	background-color: #FA8C16;
}

.quick-field-name {
	font-size: 24rpx;
	color: #303133;
	margin-right: 8rpx;
}

.quick-field-page {
	font-size: 22rpx;
	color: #909399;
}

/* æ— é¢„è§ˆå›¾å®¹å™¨ */
.no-preview-container {
	width: 100%;
	padding: 80rpx 0 40rpx;
	flex-direction: column;
	align-items: center;
	background-color: #F7F9FC;
	border-radius: 12rpx;
	margin-bottom: 20rpx;
}

.no-preview-icon {
	font-size: 96rpx;
	color: #DCDFE6;
	margin-bottom: 20rpx;
}

.no-preview-text {
		font-size: 28rpx;
	color: #909399;
	margin-bottom: 12rpx;
}

.no-preview-hint {
	font-size: 24rpx;
	color: #C0C4CC;
	margin-bottom: 30rpx;
}

.preview-btn-wrapper {
	width: 100%;
	padding: 0 40rpx;
}

.preview-btn {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	width: 100%;
	height: 88rpx;
		flex-direction: row;
		align-items: center;
	justify-content: center;
	background-color: #00C28A;
	border-radius: 44rpx;
	cursor: pointer;
	transition: opacity 0.2s;
}

.preview-btn:active {
	opacity: 0.9;
}

.preview-btn-icon {
	font-size: 32rpx;
	color: #FFFFFF;
	margin-right: 8rpx;
}

.preview-btn-text {
	font-size: 30rpx;
	color: #FFFFFF;
	font-weight: 500;
}

/* å­—æ®µå›¾ä¾‹ */
.field-legend {
	padding-top: 20rpx;
	border-top: 1rpx solid #EBEEF5;
}

.legend-title {
	display: flex;  /* ç¡®ä¿flexå¸ƒå±€ç”Ÿæ•ˆ */
	font-size: 26rpx;
	color: #303133;
	font-weight: 500;
	margin-bottom: 16rpx;
	flex-direction: row;
	align-items: center;
}

.legend-title .fa {
	margin-right: 8rpx;
	color: #1890FF;
}

.legend-items {
	flex-direction: row;
	flex-wrap: wrap;
	gap: 24rpx;
}

.legend-item {
	flex-direction: row;
		align-items: center;
	}
	
.legend-color {
	width: 32rpx;
	height: 20rpx;
	border-radius: 4rpx;
	margin-right: 8rpx;
	border-width: 2rpx;
	border-style: solid;
}

.legend-color.signatory-1 {
	background-color: rgba(24, 144, 255, 0.1);
	border-color: #1890FF;
}

.legend-color.signatory-2 {
	background-color: rgba(82, 196, 26, 0.1);
	border-color: #52C41A;
}

.legend-color.signatory-other {
	background-color: rgba(250, 140, 22, 0.1);
	border-color: #FA8C16;
}

.legend-text {
	font-size: 24rpx;
	color: #606266;
}

/* ==================== å­—æ®µä½ç½®é¢„è§ˆæ ·å¼ç»“æŸ ==================== */
</style> 
