<script lang="uts">
import { 
	getContractPage, 
	getContractStatistics,
	cancelContract,
	deleteContract,
	urgeContract,
	ContractStatus,
	getContractStatusName,
	getContractStatusColor
} from '../../api/contracts/index';
import type { PageParams, Contract, ContractListResponse } from '../../api/contracts/index';
import { downloadContractFile } from '../../api/utils/download.uts';
import { checkAuthAndRedirect } from '../../api/auth';
import { getSealPageUrl } from '../../api/seals/index';
import { 
	checkNetworkStatus, 
	testH5ServiceAvailability,
	ErrorType
} from '../../utils/network';
import { kycGuardMixin } from '../../utils/kyc-check';
import KycModal from '../../components/KycModal.uvue';
	
	export default {
		// å¼•å…¥å®åè®¤è¯å®ˆå« Mixin
		mixins: [kycGuardMixin],
		
		// æ³¨å†Œç»„ä»¶
		components: {
			KycModal
		},
		
		data() {
			return {
			// ğŸ”§ åˆåŒçŠ¶æ€å¸¸é‡ï¼ˆæ³¨æ„ï¼šåç«¯çŠ¶æ€ä»1å¼€å§‹ï¼Œä¸æ˜¯0ï¼ï¼‰
			STATUS_DRAFT: 1,
			STATUS_SIGNING: 2,
			STATUS_COMPLETED: 3,
			STATUS_CANCELLED: 4,
			STATUS_REJECTED: 5,
			STATUS_EXPIRED: 6,
			STATUS_FORM_FILLING: 7,      // è¡¨å•å¡«å†™ä¸­
			
			// ğŸ”§ å‚ä¸äººçŠ¶æ€å¸¸é‡
			PARTICIPANT_PENDING: 0,         // å¾…å¤„ç†
			PARTICIPANT_FORM_FILLED: 1,     // è¡¨å•å·²å¡«å†™
			PARTICIPANT_SIGNED: 2,          // å·²ç­¾ç½²
			PARTICIPANT_REJECTED: 3,        // å·²æ‹’ç»
			PARTICIPANT_CANCELLED: 4,       // å·²å–æ¶ˆ
				
		// å½“å‰ç”¨æˆ·IDï¼ˆç”¨äºæƒé™åˆ¤æ–­ï¼‰
		currentUserId: '' as string,
		
		// ğŸ”§ å¤´åƒé¢œè‰²æ± ï¼ˆéšæœºåˆ†é…ä¸ªæ€§åŒ–é¢œè‰²ï¼‰
		avatarColors: [
			['#FF6B6B', '#EE5A6F'],  // çº¢è‰²ç³»
			['#4ECDC4', '#44A08D'],  // é’è‰²ç³»
			['#95E1D3', '#38B2AC'],  // è–„è·ç»¿
			['#FFD93D', '#F6B93B'],  // é»„è‰²ç³»
			['#A8E6CF', '#56C596'],  // ç»¿è‰²ç³»
			['#FF8B94', '#FF6F91'],  // ç²‰çº¢ç³»
			['#70A1D7', '#5B8CC7'],  // è“è‰²ç³»
			['#B4A7D6', '#9B86BD'],  // ç´«è‰²ç³»
			['#F7B731', '#EE9617'],  // æ©™è‰²ç³»
			['#FC5C65', '#EB3B5A'],  // çº¢æ©™ç³»
		] as string[][],
		
		// åˆ—è¡¨é¡µå¤´åƒæœ€å¤šæ˜¾ç¤ºæ•°é‡
		maxAvatarsShow: 4,
				
				// æœç´¢ç›¸å…³
				searchText: '',
				showSearchBar: false,
				
		// ğŸ”§ æ™ºèƒ½ç­›é€‰æ ‡ç­¾ï¼ˆèåˆè§’è‰²+çŠ¶æ€ï¼‰
			smartTabs: [
				{ 
					id: 'all', 
					name: 'å…¨éƒ¨', 
					roleFilter: null, 
					status: null 
				},
				{ 
					id: 'wait-form', 
					name: 'å¾…å¡«è¡¨', 
					roleFilter: 'signer', 
					status: 7  // è¡¨å•å¡«å†™ä¸­
				},
				{ 
					id: 'wait-me', 
					name: 'å¾…ç­¾', 
					roleFilter: 'signer', 
					status: 2  // ç­¾ç½²ä¸­
				},
				{ 
					id: 'wait-others', 
					name: 'å¾…å¯¹æ–¹', 
					roleFilter: 'creator', 
					status: 2  // ç­¾ç½²ä¸­
				},
				{ 
					id: 'completed', 
					name: 'å·²å®Œæˆ', 
					roleFilter: null, 
					status: 3 
				},
				{ 
					id: 'draft', 
					name: 'è‰ç¨¿', 
					roleFilter: null, 
					status: 1 
				},
				{ 
					id: 'other', 
					name: 'å…¶ä»–', 
					roleFilter: null, 
					status: null,
					isOther: true  // æ ‡è®°ä¸º"å…¶ä»–"ï¼ŒåŒ…å«æ‹’ç­¾ã€æ’¤é”€ã€è¿‡æœŸ
				}
			],
				currentTab: 'all' as string,
				
				// åˆåŒåˆ—è¡¨
			contractList: [] as Contract[],
				isLoading: false,
				
				// åˆ†é¡µ
			pageSize: 20,
				currentPage: 1,
			total: 0,
				hasMore: true,
				
		// ä¸‹æ‹‰åˆ·æ–°
			isRefreshing: false
		}
	},
	
	onLoad() {
		// æ£€æŸ¥ç™»å½•çŠ¶æ€
		if (!checkAuthAndRedirect(false)) {
			return;
		}
		
		// ğŸ”§ è·å–å½“å‰ç”¨æˆ·ID
		// TODO: é›†æˆç™»å½•ç³»ç»Ÿåï¼Œä»ç™»å½•æ€ä¸­è·å–
		try {
			const userInfo = uni.getStorageSync('userInfo');
			if (userInfo && userInfo.id) {
				this.currentUserId = String(userInfo.id);
				console.log('âœ… å½“å‰ç”¨æˆ·ID:', this.currentUserId);
			} else {
				// âš ï¸ ä¸´æ—¶æ–¹æ¡ˆï¼šä»åç«¯è·å–æˆ–ä½¿ç”¨é»˜è®¤å€¼
				// å®é™…é¡¹ç›®ä¸­åº”è¯¥ä»ç™»å½•æ€è·å–
				console.warn('âš ï¸ æœªæ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œä½¿ç”¨é»˜è®¤ç”¨æˆ·ID: 1');
				this.currentUserId = '1';
			}
		} catch (error) {
			console.error('è·å–ç”¨æˆ·IDå¤±è´¥:', error);
			this.currentUserId = '1';
		}
		
		// åŠ è½½åˆåŒåˆ—è¡¨
		this.loadContractList(true);
		
		// æ£€æŸ¥å®åè®¤è¯çŠ¶æ€
		this.checkKycStatus();
	},
	
onShow() {
	// ğŸ”§ ç¦ç”¨ onShow ä¸­çš„è‡ªåŠ¨åˆ·æ–°ï¼Œé¿å…é‡å¤è°ƒç”¨æ¥å£
	// ç”¨æˆ·å¯ä»¥é€šè¿‡ä¸‹æ‹‰åˆ·æ–°æ‰‹åŠ¨åˆ·æ–°åˆ—è¡¨
	console.log('ğŸ“± é¡µé¢æ˜¾ç¤ºï¼ˆonShowï¼‰ï¼Œå·²ç¦ç”¨è‡ªåŠ¨åˆ·æ–°ä»¥é¿å…é‡å¤è¯·æ±‚');
},
	
		onReachBottom() {
			// ä¸Šæ‹‰åŠ è½½æ›´å¤š
			if (this.hasMore && !this.isLoading) {
			this.loadMoreContracts();
			}
		},
	
		methods: {
	/**
	 * ğŸ†• åˆ¤æ–­æ˜¯å¦å¯ä»¥å¡«å†™è¡¨å•
	 * æ¡ä»¶ï¼šä»»åŠ¡çŠ¶æ€=è¡¨å•å¡«å†™ä¸­(7) ä¸” å½“å‰ç”¨æˆ·çš„å‚ä¸äººæ¨¡å¼=TWO_STAGE ä¸” çŠ¶æ€=PENDING(0)
	 */
	canFillForm(contract: Contract): boolean {
		// çŠ¶æ€æ£€æŸ¥ï¼šå¿…é¡»æ˜¯è¡¨å•å¡«å†™ä¸­
		if (contract.status !== this.STATUS_FORM_FILLING) {
			return false;
		}
		
		// ç”¨æˆ·IDæ£€æŸ¥
		if (!this.currentUserId || this.currentUserId === '') {
			return false;
		}
		
		// å‚ä¸è€…æ£€æŸ¥
		if (!contract.participants || contract.participants.length === 0) {
			return false;
		}
		
		// æŸ¥æ‰¾å½“å‰ç”¨æˆ·çš„å‚ä¸è€…ä¿¡æ¯
		const myParticipant = contract.participants.find(
			(p: any) => String(p.userId) === String(this.currentUserId)
		);
		
		if (!myParticipant) {
			return false;
		}
		
		// å¿…é¡»æ˜¯ä¸¤é˜¶æ®µæ¨¡å¼ä¸”çŠ¶æ€ä¸ºå¾…å¤„ç†
		return myParticipant.flowMode === 'TWO_STAGE' && myParticipant.status === this.PARTICIPANT_PENDING;
	},
	
	/**
	 * ğŸ”§ åˆ¤æ–­æ˜¯å¦å¯ä»¥ç­¾ç½²ï¼ˆä¸PCç«¯é€»è¾‘åŒæ­¥ï¼‰
	 * 
	 * ç­¾ç½²æƒé™è§„åˆ™ï¼š
	 * 1. FORM_FILLING(7)çŠ¶æ€ï¼šåªæœ‰DIRECTæ¨¡å¼ä¸”çŠ¶æ€ä¸ºPENDINGçš„å‚ä¸è€…å¯ä»¥ç­¾ç½²
	 * 2. SIGNING(2)çŠ¶æ€ï¼šæ‰€æœ‰çŠ¶æ€ä¸ºPENDINGæˆ–FORM_FILLEDçš„å‚ä¸è€…éƒ½å¯ä»¥ç­¾ç½²
	 */
	canSign(contract: Contract): boolean {
		// çŠ¶æ€æ£€æŸ¥ï¼šç­¾ç½²ä¸­æˆ–è¡¨å•å¡«å†™ä¸­éƒ½å¯èƒ½éœ€è¦ç­¾ç½²
		if (contract.status !== this.STATUS_SIGNING && contract.status !== this.STATUS_FORM_FILLING) {
			return false;
		}
		
		// å‚ä¸è€…æ£€æŸ¥
		if (!contract.participants || contract.participants.length === 0) {
			return false;
		}
		
		// ğŸ”§ ç›´æ¥ä½¿ç”¨åç«¯è¿”å›çš„isCurrentUserå­—æ®µï¼Œæ”¯æŒuserIdå’Œæ‰‹æœºå·ä¸¤ç§åŒ¹é…æ–¹å¼
		const myParticipant = contract.participants.find(
			(p: any) => p.isCurrentUser === true
		);
		
		if (!myParticipant) {
			return false;
		}
		
		// ğŸ¯ FORM_FILLING(7)é˜¶æ®µï¼šåªæœ‰DIRECTæ¨¡å¼çš„å‚ä¸è€…å¯ä»¥ç­¾ç½²ï¼ˆæ— éœ€å¡«è¡¨ï¼‰
		if (contract.status === this.STATUS_FORM_FILLING) {
			return myParticipant.flowMode === 'DIRECT' && myParticipant.status === this.PARTICIPANT_PENDING;
		}
		
		// ğŸ¯ SIGNING(2)é˜¶æ®µï¼šçŠ¶æ€ä¸ºPENDINGæˆ–FORM_FILLEDçš„å‚ä¸è€…éƒ½å¯ä»¥ç­¾ç½²
		// PENDING: ç›´æ¥è¿›å…¥ç­¾ç½²é˜¶æ®µçš„å‚ä¸è€…ï¼ˆSIMPLE/DIRECTæ¨¡å¼ï¼‰
		// FORM_FILLED: å·²å®Œæˆè¡¨å•å¡«å†™çš„å‚ä¸è€…ï¼ˆTWO_STAGEæ¨¡å¼ï¼‰
		return myParticipant.status === this.PARTICIPANT_PENDING || 
		       myParticipant.status === this.PARTICIPANT_FORM_FILLED;
	},
		
	/**
	 * åˆ¤æ–­æ˜¯å¦å¯ä»¥æ’¤é”€
	 */
	canCancel(contract: Contract): boolean {
		if (contract.status !== this.STATUS_DRAFT && 
		    contract.status !== this.STATUS_SIGNING &&
		    contract.status !== this.STATUS_FORM_FILLING) {
			return false;
		}
		
		return String(contract.creator) === String(this.currentUserId);
	},
		
	/**
	 * ğŸ”§ åˆ¤æ–­æ˜¯å¦å¯ä»¥å‚¬ç­¾ï¼ˆæ”¯æŒè¡¨å•å¡«å†™å’Œç­¾ç½²ä¸¤ä¸ªé˜¶æ®µï¼‰
	 * 
	 * å‚¬ç­¾è§„åˆ™ï¼š
	 * 1. FORM_FILLING(7)é˜¶æ®µï¼šå‚¬ä¿ƒå¡«å†™è¡¨å•
	 * 2. SIGNING(2)é˜¶æ®µï¼šå‚¬ä¿ƒç­¾ç½²
	 */
	canUrge(contract: Contract): boolean {
		// çŠ¶æ€æ£€æŸ¥ï¼šå¿…é¡»æ˜¯è¡¨å•å¡«å†™ä¸­æˆ–ç­¾ç½²ä¸­
		if (contract.status !== this.STATUS_FORM_FILLING && contract.status !== this.STATUS_SIGNING) {
			return false;
		}
		
		// æƒé™æ£€æŸ¥ï¼šå¿…é¡»æ˜¯åˆ›å»ºè€…
		if (String(contract.creator) !== String(this.currentUserId)) {
			return false;
		}
		
		// å‚ä¸è€…æ£€æŸ¥
		if (!contract.participants || contract.participants.length === 0) {
			return false;
		}
		
		// æ£€æŸ¥æ˜¯å¦æœ‰äººå¾…å¤„ç†ï¼ˆPENDINGæˆ–FORM_FILLEDçŠ¶æ€éƒ½å¯ä»¥å‚¬ä¿ƒï¼‰
		const hasPendingParticipants = contract.participants.some(
			(p: any) => p.status === this.PARTICIPANT_PENDING || p.status === this.PARTICIPANT_FORM_FILLED
		);
		
		return hasPendingParticipants;
	},
		
		/**
		 * åˆ¤æ–­æ˜¯å¦å¯ä»¥ä¸‹è½½
		 */
		canDownload(contract: Contract): boolean {
			if (contract.status !== this.STATUS_COMPLETED) return false;
			
			if (String(contract.creator) === String(this.currentUserId)) return true;
			
			const isParticipant = contract.participants?.some(
				(p: any) => String(p.userId) === String(this.currentUserId)
			);
			
			return isParticipant ?? false;
		},
		
		/**
		 * åˆ‡æ¢æ™ºèƒ½æ ‡ç­¾ï¼ˆèåˆè§’è‰²+çŠ¶æ€ï¼‰
		 */
		changeTab(tabId: string): void {
			if (this.currentTab === tabId) return;
			
			console.log('ğŸ”€ åˆ‡æ¢æ ‡ç­¾:', tabId);
			this.currentTab = tabId;
			this.currentPage = 1;
			this.contractList = [];
			this.hasMore = true;
			this.loadContractList(true);
		},
		
		/**
		 * åˆ‡æ¢æœç´¢æ æ˜¾ç¤ºçŠ¶æ€
		 */
			toggleSearchBar(): void {
			this.showSearchBar = !this.showSearchBar;
				if (!this.showSearchBar) {
					// å…³é—­æœç´¢æ æ—¶ï¼Œå¦‚æœæœ‰æœç´¢å†…å®¹åˆ™æ¸…ç©ºå¹¶é‡æ–°åŠ è½½
					if (this.searchText) {
					this.searchText = '';
					this.refreshList();
					}
				}
			},
			
		/**
		 * æœç´¢åˆåŒ
		 */
			searchContracts(): void {
			this.currentPage = 1;
			this.contractList = [];
			this.hasMore = true;
			this.loadContractList(true);
		},
		
	/**
	 * åˆ·æ–°åˆ—è¡¨
	 */
		async refreshList(): Promise<void> {
		console.log('ğŸ”„ å¼€å§‹åˆ·æ–°åˆ—è¡¨');
		this.currentPage = 1;
		this.contractList = [];
		this.hasMore = true;
		this.isRefreshing = true;
		
		try {
			await this.loadContractList(false);
		} catch (error) {
			console.error('åˆ·æ–°åˆ—è¡¨å¤±è´¥:', error);
		} finally {
			// ç¡®ä¿åˆ·æ–°çŠ¶æ€è¢«é‡ç½®
			this.isRefreshing = false;
			console.log('ğŸ”„ åˆ·æ–°å®Œæˆï¼ŒçŠ¶æ€å·²é‡ç½®');
		}
	},
		
		/**
		 * åŠ è½½æ›´å¤š
		 */
			loadMoreContracts(): void {
			if (this.isLoading) return;
				
			this.currentPage++;
			this.loadContractList(false);
			},
			
		/**
		 * åŠ è½½åˆåŒåˆ—è¡¨ï¼ˆçœŸå®APIï¼‰
		 */
			async loadContractList(showLoading: boolean): Promise<void> {
			if (this.isLoading && !this.isRefreshing) return;
				
			this.isLoading = true;
				
				// âŒ åˆ é™¤ç³»ç»Ÿçº§loadingï¼Œä½¿ç”¨é¡µé¢å†…è‡ªå®šä¹‰loadingå³å¯
				// if (showLoading) {
				// 	uni.showLoading({
				// 		title: 'åŠ è½½ä¸­'
				// 	});
				// }
				
				try {
					// æ„å»ºè¯·æ±‚å‚æ•°
				const params: PageParams = {
					pageNo: this.currentPage,
						pageSize: this.pageSize
					};
					
				// ğŸ”§ æ ¹æ®å½“å‰æ™ºèƒ½æ ‡ç­¾è®¾ç½®ç­›é€‰æ¡ä»¶
				const currentTabConfig = this.smartTabs.find((tab: any) => tab.id === this.currentTab);
				if (currentTabConfig) {
					// è®¾ç½®è§’è‰²ç­›é€‰
					if (currentTabConfig.roleFilter) {
						params.roleFilter = currentTabConfig.roleFilter;
					}
					
					// è®¾ç½®çŠ¶æ€ç­›é€‰
					if (currentTabConfig.status !== null && currentTabConfig.status !== undefined) {
						params.status = currentTabConfig.status;
					}
					
					// "å…¶ä»–"æ ‡ç­¾ï¼šæŸ¥è¯¢æ‹’ç­¾(5)ã€æ’¤é”€(4)ã€è¿‡æœŸ(6)
					if (currentTabConfig.isOther) {
						params.statusList = [4, 5, 6];  // æ’¤é”€ã€æ‹’ç­¾ã€è¿‡æœŸ
					}
				}
				
				// æ·»åŠ æœç´¢å…³é”®å­—
				if (this.searchText) {
					params.name = this.searchText;
				}
				
		console.log('ğŸ“¤ è¯·æ±‚åˆåŒåˆ—è¡¨ï¼Œå½“å‰æ ‡ç­¾:', this.currentTab, 'å‚æ•°:', params);
		
		// è°ƒç”¨çœŸå®API
		const result: ContractListResponse = await getContractPage(params);
		
		console.log('âœ… åˆåŒåˆ—è¡¨è¿”å›:', result.list.length, 'æ¡');
		
		// ğŸ”§ è°ƒè¯•ï¼šæ£€æŸ¥æ¯ä¸ªåˆåŒçš„ participants æ•°æ®
		result.list.forEach((contract: Contract, index: number) => {
			const hasParticipants = contract.participants && contract.participants.length > 0;
			console.log(`  ğŸ“‹ åˆåŒ${index + 1}(ID:${contract.id})`, 
				`çŠ¶æ€:${contract.status}`, 
				`åˆ›å»ºè€…:${contract.creator}`,
				`å‚ä¸è€…:${hasParticipants ? contract.participants.length + 'äºº' : 'æ— æ•°æ®âŒ'}`
			);
			if (!hasParticipants) {
				console.warn(`    âš ï¸ è­¦å‘Šï¼šåˆåŒ ${contract.id} ç¼ºå°‘ participants æ•°æ®ï¼`);
			}
		});
			
			// ç¬¬ä¸€é¡µæ¸…ç©ºåˆ—è¡¨ï¼Œå…¶ä»–é¡µè¿½åŠ æ•°æ®
			if (this.currentPage === 1) {
				this.contractList = result.list;
			} else {
					this.contractList = [...this.contractList, ...result.list];
				}
				
			// æ›´æ–°æ€»æ•°
			this.total = result.total;
			
			// åˆ¤æ–­æ˜¯å¦æœ‰æ›´å¤šæ•°æ®
			this.hasMore = this.contractList.length < result.total;
			
			console.log(`âœ… å·²åŠ è½½ ${this.contractList.length}/${result.total} æ¡æ•°æ®`);
					
				} catch (error) {
					console.error('åŠ è½½åˆåŒåˆ—è¡¨å¤±è´¥:', error);
					uni.showToast({
						title: 'åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•',
						icon: 'none'
					});
				} finally {
					this.isLoading = false;
					this.isRefreshing = false;
					// âŒ åˆ é™¤ç³»ç»Ÿçº§loadingçš„éšè—è°ƒç”¨
					// if (showLoading) {
					// 	uni.hideLoading();
					// }
				}
			},
			
		/**
		 * æŸ¥çœ‹åˆåŒè¯¦æƒ…
		 */
		viewContractDetail(contract: Contract): void {
			console.log('æŸ¥çœ‹åˆåŒè¯¦æƒ…:', contract);
			
			// è·³è½¬åˆ°åˆåŒè¯¦æƒ…é¡µ
			uni.navigateTo({
				url: `/pages/contract-detail/index?id=${contract.id}`
			});
		},
		
	/**
	 * å¡«å†™è¡¨å•ï¼ˆè·³è½¬H5è¡¨å•é¡µé¢ï¼‰
	 */
	fillForm(contract: Contract, event: Event): void {
		event.stopPropagation();
		
		console.log('å¡«å†™è¡¨å•:', contract);
		
		// è·³è½¬åˆ°H5è¡¨å•å¡«å†™é¡µé¢
		uni.navigateTo({
			url: `/pages/contract-form/h5-fill?taskId=${contract.id}`
		});
	},
	
	/**
	 * ç­¾ç½²åˆåŒï¼ˆå…ˆæ£€æµ‹H5æœåŠ¡ï¼Œå†è·³è½¬ç­¾ç½²é¡µé¢ï¼‰
	 * 
	 * æ£€æµ‹æµç¨‹ï¼š
	 * 1. æ£€æŸ¥ç”¨æˆ·ç½‘ç»œçŠ¶æ€
	 * 2. è·å– H5 ç­¾ç½² URL
	 * 3. æµ‹è¯• H5 æœåŠ¡å™¨å¯ç”¨æ€§
	 * 4. æ£€æµ‹é€šè¿‡åæ‰è·³è½¬
	 */
	async signContract(contract: Contract, event: Event): Promise<void> {
		event.stopPropagation();
		
		console.log('[åˆåŒåˆ—è¡¨] å‡†å¤‡ç­¾ç½²åˆåŒ:', contract.id);
		
		try {
			// æ˜¾ç¤ºæ£€æµ‹è¿›åº¦
			uni.showLoading({ 
				title: 'æ­£åœ¨æ£€æµ‹ç­¾ç½²æœåŠ¡...',
				mask: true 
			});
			
			// æ­¥éª¤ 1: æ£€æŸ¥ç½‘ç»œçŠ¶æ€
			console.log('[åˆåŒåˆ—è¡¨] æ­¥éª¤ 1: æ£€æŸ¥ç½‘ç»œçŠ¶æ€');
			const networkResult = await checkNetworkStatus();
			if (!networkResult.success) {
				uni.hideLoading();
				uni.showModal({
					title: 'ç½‘ç»œå¼‚å¸¸',
					content: networkResult.errorMessage || 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•',
					showCancel: false
				});
				return;
			}
			console.log('[åˆåŒåˆ—è¡¨] âœ“ ç½‘ç»œçŠ¶æ€æ­£å¸¸');
			
			// æ­¥éª¤ 2: è·å– H5 ç­¾ç½² URL
			console.log('[åˆåŒåˆ—è¡¨] æ­¥éª¤ 2: è·å– H5 ç­¾ç½² URL');
			uni.showLoading({ 
				title: 'æ­£åœ¨è¿æ¥ç­¾ç½²æœåŠ¡...',
				mask: true 
			});
			
			let signUrl: string;
			try {
				signUrl = await getSealPageUrl('sign', contract.id);
				console.log('[åˆåŒåˆ—è¡¨] âœ“ H5 URL è·å–æˆåŠŸ');
			} catch (error) {
				uni.hideLoading();
				console.error('[åˆåŒåˆ—è¡¨] âœ— H5 URL è·å–å¤±è´¥:', error);
				
				uni.showModal({
					title: 'æœåŠ¡å¼‚å¸¸',
					content: 'æ— æ³•è¿æ¥åˆ°ç­¾ç½²æœåŠ¡\nè¯·ç¨åé‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ',
					showCancel: false
				});
				return;
			}
			
			// æ­¥éª¤ 3: æµ‹è¯• H5 æœåŠ¡å™¨å¯ç”¨æ€§ï¼ˆå…³é”®æ­¥éª¤ï¼‰
			console.log('[åˆåŒåˆ—è¡¨] æ­¥éª¤ 3: æµ‹è¯• H5 æœåŠ¡å™¨å¯ç”¨æ€§');
			uni.showLoading({ 
				title: 'æ­£åœ¨æ£€æµ‹æœåŠ¡çŠ¶æ€...',
				mask: true 
			});
			
			const serviceResult = await testH5ServiceAvailability(signUrl, 8000);
			
			uni.hideLoading();
			
			if (!serviceResult.available) {
				console.error('[åˆåŒåˆ—è¡¨] âœ— H5 æœåŠ¡ä¸å¯ç”¨');
				
				uni.showModal({
					title: 'ç­¾ç½²æœåŠ¡æš‚æ—¶ä¸å¯ç”¨',
					content: serviceResult.errorMessage || 'H5ç­¾ç½²æœåŠ¡æš‚æ—¶æ— æ³•è®¿é—®\nè¯·ç¨åé‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ',
					showCancel: false
				});
				return;
			}
			
			console.log('[åˆåŒåˆ—è¡¨] âœ“ H5 æœåŠ¡å¯ç”¨');
			console.log('[åˆåŒåˆ—è¡¨] âœ“ æ‰€æœ‰æ£€æµ‹é€šè¿‡ï¼Œè·³è½¬åˆ°ç­¾ç½²é¡µé¢');
			
			// æ­¥éª¤ 4: æ‰€æœ‰æ£€æµ‹é€šè¿‡ï¼Œè·³è½¬åˆ°ç­¾ç½²é¡µé¢
			uni.navigateTo({
				url: `/pages/contract-sign/h5-sign?taskId=${contract.id}`
			});
			
		} catch (error) {
			uni.hideLoading();
			console.error('[åˆåŒåˆ—è¡¨] ç­¾ç½²å‰æ£€æµ‹å¤±è´¥:', error);
			
			uni.showModal({
				title: 'æ£€æµ‹å¤±è´¥',
				content: 'æ— æ³•å®Œæˆç­¾ç½²å‰æ£€æµ‹\nè¯·ç¨åé‡è¯•',
				showCancel: false
			});
		}
	},
		
		/**
		 * å‚¬ç­¾
		 */
		async urgeSign(contract: Contract, event: Event): Promise<void> {
			event.stopPropagation();
			
			try {
				console.log('å‚¬ç­¾åˆåŒ:', contract);
				
				// æ˜¾ç¤ºåŠ è½½
				uni.showLoading({
					title: 'å‘é€ä¸­...'
				});
				
				// è°ƒç”¨å‚¬ç­¾API
				await urgeContract(contract.id);
				
				uni.hideLoading();
				
				// æˆåŠŸæç¤º
				uni.showToast({
					title: 'å·²å‘é€å‚¬ç­¾é€šçŸ¥',
					icon: 'success'
				});
				
			} catch (error) {
				uni.hideLoading();
				console.error('å‚¬ç­¾å¤±è´¥:', error);
				uni.showToast({
					title: 'å‚¬ç­¾å¤±è´¥',
					icon: 'none'
				});
			}
		},
		
		/**
		 * æ’¤é”€åˆåŒ
		 */
		async revokeContract(contract: Contract, event: Event): Promise<void> {
			event.stopPropagation();
				
				uni.showModal({
				title: 'æ’¤é”€åˆåŒ',
				content: 'ç¡®å®šè¦æ’¤é”€è¯¥åˆåŒå—ï¼Ÿæ’¤é”€åå°†æ— æ³•æ¢å¤ã€‚',
				success: async (res) => {
						if (res.confirm) {
						try {
							console.log('æ’¤é”€åˆåŒ:', contract);
							
							// æ˜¾ç¤ºåŠ è½½
							uni.showLoading({
								title: 'æ’¤é”€ä¸­...'
							});
							
							// è°ƒç”¨æ’¤é”€API
							await cancelContract(contract.id);
							
							uni.hideLoading();
							
							// æˆåŠŸæç¤º
							uni.showToast({
								title: 'åˆåŒå·²æ’¤é”€',
								icon: 'success'
							});
							
							// åˆ·æ–°åˆ—è¡¨
							this.refreshList();
							
						} catch (error) {
							uni.hideLoading();
							console.error('æ’¤é”€å¤±è´¥:', error);
							uni.showToast({
								title: 'æ’¤é”€å¤±è´¥',
								icon: 'none'
							});
						}
					}
				}
			});
		},
		
	/**
	 * ä¸‹è½½åˆåŒ
	 */
	async downloadContract(contract: Contract, event: Event): Promise<void> {
		event.stopPropagation();
		
		try {
			console.log('ğŸ“¥ ä¸‹è½½åˆåŒ:', contract);
			
			// ä½¿ç”¨å·²ç­¾ç½²çš„æ–‡ä»¶URLæˆ–åŸæ–‡ä»¶URL
			const fileUrl = contract.signedFileUrl || contract.fileUrl;
			
			if (!fileUrl) {
				uni.showToast({
					title: 'æ–‡ä»¶ä¸å­˜åœ¨',
					icon: 'none',
					duration: 2000
				});
				return;
			}
			
			// ç”Ÿæˆæ–‡ä»¶å
			const fileName = `${contract.name || 'åˆåŒ'}_${contract.id}.pdf`;
			
			// ä½¿ç”¨ç»Ÿä¸€çš„ä¸‹è½½å·¥å…·
			await downloadContractFile(fileUrl, fileName);
			
		} catch (error) {
			console.error('âŒ ä¸‹è½½åˆåŒå¤±è´¥:', error);
			uni.showToast({
				title: 'ä¸‹è½½å¤±è´¥',
				icon: 'none',
				duration: 2000
			});
		}
	},
		
	/**
	 * å¯¼èˆªåˆ°åˆ›å»ºé¡µé¢ï¼ˆéœ€è¦å…ˆéªŒè¯å®åè®¤è¯ï¼‰
	 */
		navigateToCreate(): void {
			// å…ˆæ£€æŸ¥å®åè®¤è¯ï¼ˆä½¿ç”¨ Mixin ä¸­çš„æ–¹æ³•ï¼‰
			if (!this.checkCanProceed()) {
				return
			}
			
			// å·²è®¤è¯ï¼Œç›´æ¥è·³è½¬åˆ° H5 åˆ›å»ºé¡µé¢ï¼ˆé»˜è®¤æ¨¡æ¿åˆ›å»ºï¼‰
			uni.navigateTo({
				url: '/pages/contract-create/h5-create?type=template'
			});
		},
			
		/**
		 * æ¸…é™¤æœç´¢æ¡ä»¶
		 */
			clearSearch(): void {
				this.searchText = '';
				this.refreshList();
			},
			
		/**
		 * æ¸…é™¤æ‰€æœ‰è¿‡æ»¤æ¡ä»¶
		 */
			clearAllFilters(): void {
				this.searchText = '';
				this.currentTab = 'all'; // ğŸ”§ é‡ç½®ä¸º"å…¨éƒ¨"æ ‡ç­¾
				this.refreshList();
			},
			
		/**
		 * è·å–çŠ¶æ€æ˜¾ç¤ºåç§°
		 */
		getStatusName(status: ContractStatus): string {
			return getContractStatusName(status);
		},
		
		/**
		 * è·å–çŠ¶æ€é¢œè‰²
		 */
		getStatusColor(status: ContractStatus): string {
			return getContractStatusColor(status);
		},
		
	/**
	 * æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
	 */
	formatDate(dateString: string | null): string {
		if (!dateString) return '';
		
		try {
			// å¦‚æœæ˜¯æ—¶é—´æˆ³ï¼ˆæ•°å­—ï¼‰ï¼Œåˆ™è½¬æ¢ä¸ºæ—¥æœŸ
			let date: Date;
			if (/^\d+$/.test(dateString)) {
				date = new Date(parseInt(dateString));
			} else {
				// ISOæ ¼å¼æˆ–å…¶ä»–å­—ç¬¦ä¸²æ ¼å¼
				date = new Date(dateString);
			}
			
			// æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆ
			if (isNaN(date.getTime())) {
				return dateString;
			}
			
			const year = date.getFullYear();
			const month = String(date.getMonth() + 1).padStart(2, '0');
			const day = String(date.getDate()).padStart(2, '0');
			const hours = String(date.getHours()).padStart(2, '0');
			const minutes = String(date.getMinutes()).padStart(2, '0');
			
			return `${year}-${month}-${day} ${hours}:${minutes}`;
		} catch (error) {
			console.error('æ—¥æœŸæ ¼å¼åŒ–å¤±è´¥:', error);
			return dateString || '';
		}
		},
	
	/**
	 * ğŸ”§ è·å–å‚ä¸äººå§“å
	 */
	getParticipantName(participant: any): string {
		return participant.userName || participant.nickname || 'æœªçŸ¥';
	},
	
	/**
	 * ğŸ”§ æ ¹æ®ç”¨æˆ·IDè·å–å¤´åƒé¢œè‰²ï¼ˆéšæœºä½†å›ºå®šï¼‰
	 */
	getAvatarColor(userId: any): string[] {
		// å°†ç”¨æˆ·IDè½¬æ¢ä¸ºæ•°å­—
		const id = String(userId || '0');
		let hash = 0;
		for (let i = 0; i < id.length; i++) {
			hash = id.charCodeAt(i) + ((hash << 5) - hash);
		}
		// ä½¿ç”¨ hash å€¼é€‰æ‹©é¢œè‰²
		const index = Math.abs(hash) % this.avatarColors.length;
		return this.avatarColors[index];
	},
		}
	}
</script>

<template>
	<view class="contract-manage">
		<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
		<view class="header">
			<!-- å¯¼èˆªæ  -->
			<view class="nav-bar">
				<view class="nav-left"></view>
				<view class="nav-title">
					<text class="page-title">åˆåŒç®¡ç†</text>
				</view>
				<view class="nav-right">
					<view class="action-btn search-btn" @click="toggleSearchBar">
						<text class="fa fa-search"></text>
					</view>
				</view>
			</view>
			
			<!-- æœç´¢æ¡† -->
			<view v-if="showSearchBar" class="search-container">
				<view class="search-input-wrapper">
					<text class="fa fa-search search-prefix-icon"></text>
					<input 
						class="search-input" 
						type="text" 
						v-model:value="searchText"
						placeholder="æœç´¢åˆåŒåç§°" 
						confirm-type="search"
						@confirm="searchContracts"
						focus="true"
					/>
					<view v-if="searchText" class="clear-button" @click="searchText = ''">
						<text class="fa fa-times"></text>
					</view>
				</view>
				<view class="search-cancel" @click="toggleSearchBar">
					<text class="cancel-text">å–æ¶ˆ</text>
				</view>
			</view>
			
			<!-- ğŸ”§ æ™ºèƒ½ç­›é€‰æ ‡ç­¾ï¼ˆå•å±‚å¯¼èˆªï¼‰ -->
			<view class="smart-tabs-wrapper">
				<scroll-view 
					class="smart-tabs" 
					direction="horizontal"
					:show-scrollbar="false"
				>
					<view 
						v-for="(tab, index) in smartTabs" 
						:key="index"
						class="tab-item"
						:class="{ active: currentTab === tab.id }"
						@click="changeTab(tab.id)"
					>
						<text class="tab-text">{{ tab.name }}</text>
						<view v-if="currentTab === tab.id" class="active-indicator"></view>
					</view>
				</scroll-view>
				<!-- ğŸ”§ å³ä¾§æ¸å˜é®ç½©ï¼Œæç¤ºå¯æ»šåŠ¨ -->
				<view class="scroll-indicator"></view>
			</view>
			
			<!-- è¿‡æ»¤å™¨æŒ‡ç¤ºå™¨ -->
			<view v-if="searchText" class="filter-indicator">
				<view class="filter-tag">
					<text class="filter-tag-text">{{ searchText }}</text>
					<text class="fa fa-times filter-tag-close" @click="clearSearch"></text>
				</view>
				<view class="filter-clear" @click="clearAllFilters">
					<text class="filter-clear-text">æ¸…é™¤å…¨éƒ¨</text>
				</view>
			</view>
		</view>
		
		<!-- åˆåŒåˆ—è¡¨ -->
		<scroll-view 
			class="contract-list"
			scroll-y="true"
			@scrolltolower="loadMoreContracts"
			:refresher-enabled="true"
			:refresher-triggered="isRefreshing"
			@refresherrefresh="refreshList"
			refresher-background="#F7F9FC"
		>
			<!-- åˆ—è¡¨å†…å®¹ -->
			<view v-if="contractList.length > 0" class="list-content">
				<view 
					v-for="(contract, index) in contractList" 
					:key="contract.id"
					class="contract-item"
					hover-class="contract-item-hover"
					@click="viewContractDetail(contract)"
				>
					<!-- åˆåŒçŠ¶æ€æ ‡ç­¾ -->
					<view class="status-badge" :style="{ backgroundColor: getStatusColor(contract.status) }">
						<text class="status-text">{{ getStatusName(contract.status) }}</text>
					</view>
					
					<!-- åˆåŒæ ‡é¢˜ -->
					<view class="contract-header">
						<view class="contract-title-container">
							<text class="contract-title">{{ contract.name }}</text>
						</view>
					</view>
					
					<!-- åˆåŒä¿¡æ¯ -->
					<view class="contract-info">
						<view class="info-row">
							<view class="info-item">
								<text class="fa fa-clock info-icon"></text>
								<text class="info-label">åˆ›å»ºæ—¶é—´ï¼š</text>
								<text class="info-value">{{ formatDate(contract.createTime) }}</text>
							</view>
						</view>
						<view class="info-row" v-if="contract.deadline">
							<view class="info-item">
								<text class="fa fa-calendar info-icon"></text>
								<text class="info-label">æˆªæ­¢æ—¶é—´ï¼š</text>
								<text class="info-value">{{ formatDate(contract.deadline) }}</text>
							</view>
						</view>
					<!-- ğŸ¨ å‚ä¸è€…ä¿¡æ¯åŒºåŸŸï¼ˆæ•´åˆå‚ä¸äººæ•°å’Œå¤´åƒï¼‰ -->
					<view class="participants-section" v-if="contract.participants && contract.participants.length > 0">
						<view class="participants-header">
							<text class="participants-count">å‚ä¸æ–¹ï¼ˆ{{ contract.participants.length }}æ–¹ï¼‰</text>
						</view>
						<view class="participants-avatars">
							<!-- æ˜¾ç¤ºå‰å‡ ä¸ªå‚ä¸è€…å¤´åƒ -->
							<view 
								v-for="(participant, index) in contract.participants.slice(0, maxAvatarsShow)" 
								:key="index"
								class="avatar-item"
								:style="{ 
									background: `linear-gradient(135deg, ${getAvatarColor(participant.userId)[0]} 0%, ${getAvatarColor(participant.userId)[1]} 100%)`,
									zIndex: contract.participants.length - index
								}"
							>
								<text class="avatar-text">{{ getParticipantName(participant).substring(0, 1) }}</text>
							</view>
							<!-- å¦‚æœå‚ä¸è€…è¶…è¿‡æœ€å¤§æ˜¾ç¤ºæ•°é‡ï¼Œæ˜¾ç¤º +N -->
							<view 
								v-if="contract.participants.length > maxAvatarsShow" 
								class="avatar-item avatar-more"
							>
								<text class="avatar-text">+{{ contract.participants.length - maxAvatarsShow }}</text>
							</view>
						</view>
					</view>
					</view>
					
			<!-- åˆåŒæ“ä½œæŒ‰é’® -->
			<view class="contract-actions">
				<!-- ğŸ†• å¡«å†™è¡¨å•æŒ‰é’®ï¼šåªæœ‰ä¸¤é˜¶æ®µæ¨¡å¼ä¸”çŠ¶æ€ä¸ºPENDINGçš„å‚ä¸äººæ‰æ˜¾ç¤º -->
				<view 
					v-if="canFillForm(contract)" 
					class="action-button fill-form"
					@click.stop="fillForm(contract, $event)"
				>
					<text class="fa fa-edit action-icon"></text>
					<text class="action-text">å¡«å†™è¡¨å•</text>
				</view>
				
				<!-- ğŸ”§ ç­¾ç½²æŒ‰é’®ï¼šåªæœ‰å¾…ç­¾ç½²çš„å‚ä¸è€…æ‰èƒ½çœ‹åˆ° -->
				<view 
					v-if="canSign(contract)" 
					class="action-button sign"
					@click.stop="signContract(contract, $event)"
				>
					<text class="fa fa-signature action-icon"></text>
					<text class="action-text">å»ç­¾ç½²</text>
				</view>
					
					<!-- ğŸ”§ å‚¬ç­¾æŒ‰é’®ï¼šåªæœ‰åˆ›å»ºè€…æ‰èƒ½å‚¬ç­¾ -->
					<view 
						v-if="canUrge(contract)" 
						class="action-button urge"
						@click.stop="urgeSign(contract, $event)"
					>
						<text class="fa fa-bell action-icon"></text>
						<text class="action-text">å‚¬ç­¾</text>
					</view>
					
					<!-- ğŸ”§ æ’¤é”€æŒ‰é’®ï¼šåªæœ‰åˆ›å»ºè€…æ‰èƒ½æ’¤é”€ -->
					<view 
						v-if="canCancel(contract)" 
						class="action-button revoke"
						@click.stop="revokeContract(contract, $event)"
					>
						<text class="fa fa-undo action-icon"></text>
						<text class="action-text">æ’¤é”€</text>
					</view>
					
					<!-- ğŸ”§ ä¸‹è½½æŒ‰é’®ï¼šå‚ä¸è€…å’Œåˆ›å»ºè€…éƒ½å¯ä»¥ä¸‹è½½å·²å®Œæˆçš„åˆåŒ -->
					<view 
						v-if="canDownload(contract)" 
						class="action-button download"
						@click.stop="downloadContract(contract, $event)"
					>
							<text class="fa fa-download action-icon"></text>
							<text class="action-text">ä¸‹è½½</text>
						</view>
					</view>
				</view>
			</view>
			
			<!-- ç©ºçŠ¶æ€ -->
			<view v-else-if="!isLoading && !isRefreshing" class="empty-state">
			<view class="empty-icon-wrapper">
				<view class="empty-icon-bg"></view>
				<text class="fa fa-file-contract empty-icon"></text>
			</view>
				<text class="empty-title">æš‚æ— åˆåŒ</text>
			<text class="empty-desc">æ‚¨è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•åˆåŒ</text>
			<text class="empty-tip">ç‚¹å‡»å³ä¸‹è§’ + æŒ‰é’®å¼€å§‹åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä»½åˆåŒ</text>
				<view class="empty-action" @click="navigateToCreate">
					<text class="empty-action-text">ç«‹å³åˆ›å»º</text>
					<text class="fa fa-arrow-right empty-action-icon"></text>
				</view>
			</view>
			
			<!-- åŠ è½½çŠ¶æ€ -->
			<view v-if="isLoading && !isRefreshing && contractList.length === 0" class="loading-state">
				<view class="loading-spinner"></view>
				<text class="loading-text">åŠ è½½ä¸­...</text>
			</view>
			
			<!-- åŠ è½½æ›´å¤šçŠ¶æ€ -->
			<view v-if="contractList.length > 0 && !isLoading && !hasMore" class="list-end">
				<view class="end-line"></view>
				<text class="end-text">å·²ç»åˆ°åº•å•¦</text>
				<view class="end-line"></view>
			</view>
			
			<!-- åŠ è½½æ›´å¤šä¸­ -->
			<view v-if="contractList.length > 0 && isLoading && currentPage > 1" class="loading-more">
				<view class="loading-spinner small"></view>
				<text class="loading-more-text">åŠ è½½æ›´å¤šä¸­...</text>
			</view>
		</scroll-view>
		
		<!-- æ‚¬æµ®æŒ‰é’® - å‘èµ·åˆåŒ -->
		<view class="float-button create" @click="navigateToCreate">
			<text class="fa fa-plus float-icon"></text>
		</view>
		
		<!-- å®åè®¤è¯æç¤ºå¼¹çª— - ä½¿ç”¨ç»Ÿä¸€ç»„ä»¶ -->
		<kyc-modal 
			:visible="showKycModal"
			description="ä¸ºä¿éšœåˆåŒçš„æ³•å¾‹æ•ˆåŠ›ï¼Œåˆ›å»ºåˆåŒå‰éœ€è¦å®Œæˆå®åè®¤è¯ã€‚"
			@close="closeKycModal"
			@confirm="goToKyc"
		/>
	</view>
</template>

<style>
/* å¼•å…¥FontAwesome - ç¡®ä¿å›¾æ ‡æ­£ç¡®æ˜¾ç¤º */
@import url("../../static/styles/fontawesome.css");

	.contract-manage {
		flex: 1;
		background-color: #F7F9FC;
	}
	
/* ==================== é¡¶éƒ¨å¯¼èˆªæ  ==================== */
	.header {
	background-color: #FFFFFF;
	box-shadow: 0 4rpx 20rpx rgba(0, 0, 0, 0.06);
		z-index: 10;
	}
	
	.nav-bar {
		height: 100rpx;
		flex-direction: row;
		align-items: center;
	padding: 0 30rpx;
	}
	
.nav-left, .nav-right {
	width: 80rpx;
		justify-content: center;
		align-items: center;
	}
	
	.nav-title {
		flex: 1;
		justify-content: center;
		align-items: center;
	}
	
	.page-title {
		font-size: 32rpx;
	font-weight: 500;
	color: #303133;
	}
	
	.action-btn {
	width: 70rpx;
	height: 70rpx;
		align-items: center;
		justify-content: center;
	background-color: #F7F8FA;
	border-radius: 12rpx;
	transition: all 0.25s ease;
	box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.04);
}

.action-btn:active {
	background-color: #EBEDF0;
	transform: scale(0.92);
	box-shadow: 0 1rpx 4rpx rgba(0, 0, 0, 0.06);
}

.action-btn .fa {
	font-size: 30rpx;
	color: #909399;
	transition: color 0.25s ease;
	font-weight: 300;
}

/* ==================== æœç´¢æ¡† ==================== */
	.search-container {
		flex-direction: row;
		align-items: center;
		padding: 16rpx 30rpx;
		background-color: #FFFFFF;
	}
	
	.search-input-wrapper {
		flex: 1;
		height: 72rpx;
		background-color: #F5F7FA;
		border-radius: 36rpx;
		flex-direction: row;
		align-items: center;
		padding: 0 20rpx;
		margin-right: 16rpx;
	}
	
	.search-prefix-icon {
		font-size: 28rpx;
	color: #909399;
		margin-right: 10rpx;
	}
	
	.search-input {
		flex: 1;
		height: 72rpx;
		font-size: 28rpx;
	color: #303133;
	}
	
	.clear-button {
		width: 40rpx;
		height: 40rpx;
		border-radius: 20rpx;
	background-color: #C0C4CC;
		align-items: center;
		justify-content: center;
	}
	
.clear-button .fa {
	font-size: 20rpx;
		color: #FFFFFF;
	}
	
	.search-cancel {
		padding: 0 10rpx;
	}
	
	.cancel-text {
		font-size: 28rpx;
	color: #606266;
	}
	
/* ==================== æ™ºèƒ½ç­›é€‰æ ‡ç­¾ï¼ˆå•å±‚å¯¼èˆªï¼‰ ==================== */
	.smart-tabs-wrapper {
		position: relative;
		height: 96rpx;
		background-color: #FFFFFF;
		border-bottom: 1rpx solid #EBEEF5;
	}
	
	.smart-tabs {
		width: 100%;
		height: 96rpx;
		flex-direction: row;            /* ğŸ”§ å®˜æ–¹æ–‡æ¡£ï¼šæ¨ªå‘æ»šåŠ¨å¿…é¡»è®¾ç½® */
	}
	
	/* ğŸ”§ å³ä¾§æ»šåŠ¨æŒ‡ç¤ºå™¨ï¼ˆæ¸å˜é®ç½©ï¼‰ */
	.scroll-indicator {
		position: absolute;
		right: 0;
		top: 0;
		width: 60rpx;
		height: 96rpx;
		background: linear-gradient(to left, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%);
		pointer-events: none; /* ä¸é˜»æŒ¡ç‚¹å‡» */
	}
	
	.tab-item {
		width: 160rpx;                  /* ğŸ”§ å®˜æ–¹æ–‡æ¡£ï¼šå­å…ƒç´ å¿…é¡»è®¾ç½®å›ºå®šå®½åº¦ */
		height: 96rpx;
		justify-content: center;
		align-items: center;
		position: relative;
	}
	
	.tab-text {
		font-size: 30rpx;
	color: #909399;
		font-weight: 400;
	}
	
	.tab-item.active .tab-text {
		color: #00C28A;
		font-weight: 500;
	}
	
	.active-indicator {
		position: absolute;
		bottom: 8rpx;
		left: 50%;
	width: 40rpx;
	height: 6rpx;
	background-color: #00C28A;
	border-radius: 3rpx;
		transform: translateX(-50%);
}

/* ==================== è¿‡æ»¤å™¨æŒ‡ç¤ºå™¨ ==================== */
	.filter-indicator {
		flex-direction: row;
		align-items: center;
		justify-content: space-between;
		padding: 16rpx 30rpx;
		background-color: #FFFFFF;
	border-bottom: 1rpx solid #F0F2F5;
	}
	
	.filter-tag {
		background-color: #F0F7FF;
		border-radius: 30rpx;
		padding: 8rpx 16rpx;
		flex-direction: row;
		align-items: center;
	}
	
	.filter-tag-text {
		font-size: 24rpx;
		color: #1890FF;
		margin-right: 8rpx;
	}
	
	.filter-tag-close {
		font-size: 20rpx;
		color: #1890FF;
	}
	
	.filter-clear {
		padding: 8rpx 16rpx;
	}
	
	.filter-clear-text {
		font-size: 24rpx;
	color: #909399;
	}
	
/* ==================== åˆåŒåˆ—è¡¨ ==================== */
	.contract-list {
		flex: 1;
	}
	
	.list-content {
	padding: 30rpx 24rpx;
	}
	
	.contract-item {
	background-color: #FFFFFF;
	border-radius: 16rpx;
	padding: 30rpx;
	margin-bottom: 24rpx;
	box-shadow: 0 4rpx 12rpx rgba(0, 0, 0, 0.05);
		position: relative;
	}
	
	.contract-item-hover {
	background-color: #F5F7FA;
	}
	
	/* çŠ¶æ€æ ‡ç­¾ */
	.status-badge {
		position: absolute;
		top: 0;
		right: 0;
	padding: 10rpx 24rpx;
	border-bottom-left-radius: 16rpx;
	}
	
	.status-text {
		color: #FFFFFF;
	font-size: 24rpx;
		font-weight: 500;
	}
	
/* åˆåŒæ ‡é¢˜ */
	.contract-header {
	margin-bottom: 20rpx;
	padding-right: 100rpx;
	}
	
	.contract-title-container {
		flex-direction: row;
		align-items: center;
		flex-wrap: wrap;
	}
	
	.contract-title {
	font-size: 30rpx;
	font-weight: 500;
	color: #303133;
	line-height: 1.4;
	}
	
	/* åˆåŒä¿¡æ¯ */
	.contract-info {
	margin-bottom: 20rpx;
	}
	
	.info-row {
	margin-bottom: 10rpx;
}

.info-row:last-child {
	margin-bottom: 0;
	}
	
	.info-item {
		flex-direction: row;
		align-items: center;
	}
	
	.info-icon {
		font-size: 24rpx;
	color: #909399;
		margin-right: 8rpx;
	}
	
	.info-label {
	font-size: 26rpx;
	color: #909399;
		margin-right: 8rpx;
	}
	
	.info-value {
	font-size: 26rpx;
	color: #606266;
	}
	
	/* ğŸ¨ å‚ä¸è€…ä¿¡æ¯åŒºåŸŸï¼ˆæ•´åˆå‚ä¸äººæ•°å’Œå¤´åƒï¼‰ */
	.participants-section {
		margin-top: 20rpx;
		padding: 20rpx;
		background: linear-gradient(135deg, #F8F9FA 0%, #FAFBFC 100%);
		border: 1rpx solid #E8EAED;
		border-radius: 12rpx;
		box-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.04);
	}
	
	.participants-header {
		display: flex;
		flex-direction: row;
		align-items: center;
		margin-bottom: 16rpx;
	}
	
	.participants-header .info-icon {
		font-size: 24rpx;
		color: #909399;
		margin-right: 8rpx;
	}
	
	.participants-count {
		font-size: 26rpx;
		color: #606266;
		font-weight: 500;
	}
	
	.participants-avatars {
		display: flex;
		flex-direction: row;
		align-items: center;
		padding-left: 4rpx;
	}
	
	.avatar-item {
		width: 56rpx;
		height: 56rpx;
		border-radius: 28rpx;
		display: flex;
		align-items: center;
		justify-content: center;
		border: 3rpx solid #FFFFFF;
		margin-left: -12rpx; /* å¤´åƒå åŠ æ•ˆæœ */
		box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.12);
		transition: all 0.3s ease;
	}
	
	.avatar-item:first-child {
		margin-left: 0; /* ç¬¬ä¸€ä¸ªå¤´åƒä¸éœ€è¦å·¦è¾¹è· */
	}
	
	.avatar-item:active {
		transform: scale(1.15) translateY(-2rpx);
		box-shadow: 0 4rpx 16rpx rgba(0, 0, 0, 0.18);
	}
	
	.avatar-text {
		font-size: 24rpx;
		color: #FFFFFF;
		font-weight: 500;
		text-shadow: 0 1rpx 2rpx rgba(0, 0, 0, 0.1);
	}
	
	.avatar-more {
		background: linear-gradient(135deg, #E8EAED 0%, #D1D5DB 100%);
	}
	
	.avatar-more .avatar-text {
		font-size: 20rpx;
		color: #606266;
		font-weight: 500;
		text-shadow: none;
	}
	
	/* åˆåŒæ“ä½œæŒ‰é’® */
	.contract-actions {
		flex-direction: row;
		justify-content: flex-end;
	border-top: 1rpx solid #F0F2F5;
	padding-top: 16rpx;
	}
	
	.action-button {
	padding: 12rpx 20rpx;
	border-radius: 20rpx;
	margin-left: 12rpx;
		flex-direction: row;
		align-items: center;
	}
	
	.action-icon {
	font-size: 22rpx;
		margin-right: 6rpx;
	}
	
	.action-text {
	font-size: 24rpx;
	}
	
/* ğŸ†• å¡«å†™è¡¨å•æŒ‰é’® */
	.action-button.fill-form {
	background-color: rgba(245, 158, 11, 0.1);
	}
	
	.action-button.fill-form .action-icon,
	.action-button.fill-form .action-text {
		color: #F59E0B;
	}

/* ç­¾ç½²æŒ‰é’® */
	.action-button.sign {
	background-color: rgba(16, 185, 129, 0.1);
	}
	
	.action-button.sign .action-icon,
	.action-button.sign .action-text {
		color: #10B981;
	}
	
/* å‚¬ç­¾æŒ‰é’® */
	.action-button.urge {
	background-color: rgba(250, 173, 20, 0.1);
	}
	
	.action-button.urge .action-icon,
	.action-button.urge .action-text {
		color: #FAAD14;
	}
	
/* æ’¤é”€æŒ‰é’® */
	.action-button.revoke {
	background-color: rgba(245, 108, 108, 0.1);
	}
	
	.action-button.revoke .action-icon,
	.action-button.revoke .action-text {
	color: #F56C6C;
	}
	
/* ä¸‹è½½æŒ‰é’® */
	.action-button.download {
	background-color: rgba(24, 144, 255, 0.1);
	}
	
	.action-button.download .action-icon,
	.action-button.download .action-text {
	color: #1890FF;
	}
	
/* ==================== ç©ºçŠ¶æ€ ==================== */
	.empty-state {
		align-items: center;
		justify-content: center;
		padding-top: 180rpx;
		padding-bottom: 100rpx;
	}
	
	.empty-icon-wrapper {
		position: relative;
		width: 180rpx;
		height: 180rpx;
		align-items: center;
		justify-content: center;
		margin-bottom: 40rpx;
	}
	
	.empty-icon-bg {
		position: absolute;
		width: 180rpx;
		height: 180rpx;
		border-radius: 90rpx;
		background: linear-gradient(135deg, rgba(24, 144, 255, 0.08) 0%, rgba(0, 194, 138, 0.08) 100%);
		box-shadow: 0 8rpx 24rpx rgba(24, 144, 255, 0.12);
	}
	
	.empty-icon {
		position: relative;
		font-size: 88rpx;
		color: #1890FF;
		opacity: 0.85;
	}
	
	.empty-title {
		font-size: 32rpx;
		font-weight: 500;
		color: #303133;
		margin-bottom: 16rpx;
	}
	
	.empty-desc {
		font-size: 28rpx;
	color: #909399;
		margin-bottom: 12rpx;
		line-height: 40rpx;
	}
	
	.empty-tip {
		font-size: 24rpx;
		color: #C0C4CC;
		margin-bottom: 40rpx;
		padding: 0 60rpx;
		text-align: center;
		line-height: 36rpx;
	}
	
	.empty-action {
		flex-direction: row;
		align-items: center;
		background: linear-gradient(135deg, #00C28A 0%, #00D89F 100%);
		padding: 20rpx 40rpx;
		border-radius: 12rpx;
		box-shadow: 0 8rpx 16rpx rgba(0, 194, 138, 0.25);
		transition: all 0.3s ease;
	}
	
	.empty-action:active {
		transform: scale(0.96);
		box-shadow: 0 4rpx 12rpx rgba(0, 194, 138, 0.2);
	}
	
	.empty-action-text {
		font-size: 30rpx;
		font-weight: 500;
		color: #FFFFFF;
		margin-right: 8rpx;
	}
	
	.empty-action-icon {
		font-size: 24rpx;
		color: #FFFFFF;
	}
	
/* ==================== åŠ è½½çŠ¶æ€ ==================== */
	.loading-state {
		align-items: center;
		justify-content: center;
	padding: 100rpx 0;
	}
	
	.loading-spinner {
		width: 60rpx;
		height: 60rpx;
	border: 4rpx solid #EBEEF5;
		border-top-color: #00C28A;
		border-radius: 50%;
		animation: spin 1s linear infinite;
		margin-bottom: 16rpx;
	}
	
	.loading-spinner.small {
		width: 30rpx;
		height: 30rpx;
		border-width: 2rpx;
		margin-bottom: 0;
		margin-right: 12rpx;
	}
	
	@keyframes spin {
		0% { transform: rotate(0deg); }
		100% { transform: rotate(360deg); }
	}
	
	.loading-text {
		font-size: 28rpx;
	color: #909399;
	}
	
	/* åŠ è½½æ›´å¤š */
	.loading-more {
		flex-direction: row;
		align-items: center;
		justify-content: center;
		padding: 20rpx 0;
	}
	
	.loading-more-text {
		font-size: 24rpx;
	color: #909399;
	}
	
	/* åˆ—è¡¨ç»“æŸ */
	.list-end {
		flex-direction: row;
		align-items: center;
		justify-content: center;
		padding: 30rpx 0;
	}
	
	.end-line {
		height: 1rpx;
	width: 80rpx;
	background-color: #DCDFE6;
	}
	
	.end-text {
		font-size: 24rpx;
	color: #909399;
		margin: 0 20rpx;
	}
	
/* ==================== æ‚¬æµ®æŒ‰é’® ==================== */
	.float-button {
		position: fixed;
		right: 40rpx;
	bottom: 120rpx;
		width: 112rpx;
		height: 112rpx;
	border-radius: 12rpx;
	background-color: #00C28A;
		align-items: center;
		justify-content: center;
	box-shadow: 0 8rpx 24rpx rgba(0, 194, 138, 0.3);
	}
	
	.float-button:active {
		transform: scale(0.9);
	}
	
	.float-icon {
		font-size: 44rpx;
		color: #FFFFFF;
	}
</style> 
