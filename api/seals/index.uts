/**
 * Sealå°ç« æ¨¡å— APIå°è£…
 * 
 * åŸºäºmemberæ¨¡å—çš„Tokenï¼Œè°ƒç”¨Seal App-APIæœåŠ¡
 * æ³¨æ„ï¼šSealæ¨¡å—ä½¿ç”¨ç»Ÿä¸€çš„ç‰ˆæœ¬åŒ–è·¯å¾„ /api/v1/seal
 */
import { get, post, put, del } from '../index';
import { SEAL_CORE_H5_URL } from '../config.uts';
import { getSealTokenConfig, LOG_PREFIX } from '../../config/seal.config';

// ==================== æ•°æ®ç±»å‹å®šä¹‰ ====================

/**
 * å°ç« ç±»å‹æšä¸¾ï¼ˆä¸åç«¯ SealTypeEnum ä¿æŒä¸€è‡´ï¼‰
 */
export enum SealType {
	// ========== ä¼ä¸šå°ç«  (1-9) ==========
	ENTERPRISE_OFFICIAL = 1,    // å…¬ç« 
	ENTERPRISE_FINANCIAL = 2,   // è´¢åŠ¡ä¸“ç”¨ç« 
	ENTERPRISE_CONTRACT = 3,    // åˆåŒä¸“ç”¨ç« 
	ENTERPRISE_LEGAL = 4,       // æ³•äººç« 
	
	// ========== ä¸ªäººå°ç«  (11-19) ==========
	PERSONAL_SIGNATURE = 11,    // ä¸ªäººç­¾å
	PERSONAL_SEAL = 12,         // ä¸ªäººå°ç« 
	
	// å…¼å®¹æ—§ç‰ˆæœ¬ï¼ˆå·²å¼ƒç”¨ï¼Œè¯·ä½¿ç”¨ä¸Šé¢çš„æ–°ç±»å‹ï¼‰
	/** @deprecated è¯·ä½¿ç”¨ ENTERPRISE_OFFICIAL */
	ENTERPRISE = 1,
	/** @deprecated è¯·ä½¿ç”¨ PERSONAL_SIGNATURE æˆ– PERSONAL_SEAL */
	PERSONAL = 11,
	/** @deprecated è¯·ä½¿ç”¨ ENTERPRISE_LEGAL */
	LEGAL_PERSON = 4,
	/** @deprecated è¯·ä½¿ç”¨ ENTERPRISE_FINANCIAL */
	FINANCE = 2,
	/** @deprecated è¯·ä½¿ç”¨ ENTERPRISE_CONTRACT */
	CONTRACT = 3
}

/**
 * å°ç« çŠ¶æ€æšä¸¾
 */
export enum SealStatus {
	NORMAL = 1,          // æ­£å¸¸
	REVOKED = 2          // å·²æ³¨é”€
}

/**
 * å°ç« ä¿¡æ¯æ¥å£
 */
export interface SealInfo {
	id?: string;
	name: string;
	type: SealType;
	sealData?: string;           // âœ… å°ç« å›¾ç‰‡URLï¼ˆåç«¯è¿”å›çš„å­—æ®µåï¼‰
	imageUrl?: string;           // å…¼å®¹æ—§å­—æ®µå
	image?: string;              // å…¼å®¹æ—§å­—æ®µå
	userId?: number;             // âœ… ç”¨æˆ·ID
	enterpriseId?: number;       // âœ… ä¼ä¸šIDï¼ˆä¼ä¸šå°ç« æœ‰å€¼ï¼Œä¸ªäººå°ç« ä¸ºnullï¼‰
	enterpriseName?: string;     // âœ… ä¼ä¸šåç§°ï¼ˆå‰ç«¯å¡«å……ï¼Œåç«¯ä¸è¿”å›ï¼‰
	ownerId?: string;            // å…¼å®¹æ—§å­—æ®µå
	ownerType?: string;          // å…¼å®¹æ—§å­—æ®µå
	status?: SealStatus;
	createTime?: string;         // âœ… åˆ›å»ºæ—¶é—´ï¼ˆåç«¯è¿”å›çš„å­—æ®µåï¼‰
	createdAt?: string;          // å…¼å®¹æ—§å­—æ®µå
	createdBy?: string;
	updatedAt?: string;
}

/**
 * å°ç« åˆ—è¡¨å“åº”
 */
export interface SealListResponse {
	total: number;
	list: SealInfo[];
	pageSize: number;
	pageNo: number;
}

/**
 * åˆ†é¡µå‚æ•°
 */
export interface PageParams {
  pageNo?: number;
  pageSize?: number;
  name?: string;
	type?: SealType;
	status?: SealStatus;
	enterpriseId?: number;  // âœ… ä¼ä¸šIDï¼ˆæŸ¥è¯¢ä¼ä¸šå°ç« æ—¶ä¼ é€’ï¼‰
	userId?: number;         // âœ… ç”¨æˆ·IDï¼ˆåç«¯ä¼šè‡ªåŠ¨è®¾ç½®ï¼Œå‰ç«¯ä¸€èˆ¬ä¸éœ€è¦ä¼ ï¼‰
}

// ==================== å°ç« ç®¡ç† API ====================

/**
 * è·å–å°ç« åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
 */
export function getSealPage(params: PageParams): Promise<SealListResponse> {
	return get<SealListResponse>(`/api/v1/seal/seal-info/page`, params);
}

/**
 * è·å–å°ç« åˆ—è¡¨ï¼ˆå…¨éƒ¨ï¼‰
 */
export function getSealList(): Promise<Array<SealInfo>> {
	return get<Array<SealInfo>>(`/api/v1/seal/seal-info/list`);
}

/**
 * è·å–å°ç« è¯¦æƒ…
 */
export function getSealDetail(id: string): Promise<SealInfo> {
	return get<SealInfo>(`/api/v1/seal/seal-info/get`, { id });
}

/**
 * åˆ›å»ºå°ç« 
 * @param data.name - å°ç« åç§°
 * @param data.type - å°ç« ç±»å‹ï¼š1-å…¬ç«  2-åˆåŒç«  3-è´¢åŠ¡ç«  4-æ³•äººç«  5-å…¶ä»–
 * @param data.imageUrl - å°ç« å›¾ç‰‡URLï¼ˆéœ€å…ˆè°ƒç”¨æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼‰
 */
export function createSeal(data: SealInfo): Promise<SealInfo> {
	return post<SealInfo>(`/api/v1/seal/seal-info/create`, data);
}

/**
 * æ›´æ–°å°ç« 
 */
export function updateSeal(data: SealInfo): Promise<SealInfo> {
	return put<SealInfo>(`/api/v1/seal/seal-info/update`, data);
}

/**
 * åˆ é™¤å°ç« 
 * æ³¨æ„ï¼šDELETE è¯·æ±‚çš„å‚æ•°åº”è¯¥åœ¨ URL ä¸­ï¼Œä¸æ˜¯ request body
 */
export function deleteSeal(id: string): Promise<void> {
	// âœ… ä¿®å¤ï¼šå°† id ä½œä¸º query parameter æ‹¼æ¥åˆ° URL ä¸­
	return del<void>(`/api/v1/seal/seal-info/delete?id=${id}`);
}

/**
 * è®¾ç½®é»˜è®¤å°ç« 
 * æ³¨æ„ï¼šPUT è¯·æ±‚çš„å‚æ•°åº”è¯¥åœ¨ URL ä¸­ï¼ˆå¦‚æœåç«¯ä½¿ç”¨ @RequestParamï¼‰
 */
export function setDefaultSeal(id: string): Promise<void> {
	// âœ… ä¿®å¤ï¼šå°† id ä½œä¸º query parameter æ‹¼æ¥åˆ° URL ä¸­
	return put<void>(`/api/v1/seal/seal-info/set-default?id=${id}`);
}

// ==================== å°ç« æ¨¡æ¿ API ====================

/**
 * å°ç« æ¨¡æ¿ä¿¡æ¯
 */
export interface SealTemplate {
	id: string;
    name: string;
	description?: string;
	thumbnail?: string;
	type: SealType;
	formFields?: any[];
}

/**
 * è·å–å°ç« æ¨¡æ¿åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
 */
export function getSealTemplates(params: PageParams): Promise<{ list: SealTemplate[]; total: number }> {
	return get<{ list: SealTemplate[]; total: number }>(`/api/v1/seal/seal-template/page`, params);
}

/**
 * è·å–å°ç« æ¨¡æ¿è¯¦æƒ…
 */
export function getSealTemplateDetail(id: string): Promise<SealTemplate> {
	return get<SealTemplate>(`/api/v1/seal/seal-template/get`, { id });
}

/**
 * ä½¿ç”¨æ¨¡æ¿åˆ›å»ºå°ç« 
 */
export function createSealFromTemplate(data: {
	templateId: string;
    name: string;
	formData?: Record<string, any>;
}): Promise<SealInfo> {
	return post<SealInfo>(`/api/v1/seal/seal-template/use`, data);
}

// ==================== å·¥å…·å‡½æ•° ====================

/**
 * è·å–å°ç« ç±»å‹åç§°
 */
export function getSealTypeName(type: SealType | number): string {
	const typeMap: Record<number, string> = {
		// ä¼ä¸šå°ç« 
		[SealType.ENTERPRISE_OFFICIAL]: 'å…¬ç« ',
		[SealType.ENTERPRISE_FINANCIAL]: 'è´¢åŠ¡ä¸“ç”¨ç« ',
		[SealType.ENTERPRISE_CONTRACT]: 'åˆåŒä¸“ç”¨ç« ',
		[SealType.ENTERPRISE_LEGAL]: 'æ³•äººç« ',
		
		// ä¸ªäººå°ç« 
		[SealType.PERSONAL_SIGNATURE]: 'ä¸ªäººç­¾å',
		[SealType.PERSONAL_SEAL]: 'ä¸ªäººå°ç« ',
		
		// å…¼å®¹æ—§å€¼
		5: 'ä¸ªäººå°ç« ï¼ˆæ—§ï¼‰'
	};
	return typeMap[type as number] || 'æœªçŸ¥';
}

/**
 * è·å–å°ç« çŠ¶æ€åç§°
 */
export function getSealStatusName(status: SealStatus): string {
	const statusMap: Record<number, string> = {
		[SealStatus.NORMAL]: 'æ­£å¸¸',
		[SealStatus.REVOKED]: 'å·²æ³¨é”€'
	};
	return statusMap[status] || 'æœªçŸ¥';
}

/**
 * è·å–å°ç« ç±»å‹åˆ—è¡¨
 * @param ownerType æ‰€æœ‰è€…ç±»å‹ï¼š'personal' æˆ– 'enterprise'
 */
export function getSealTypeList(ownerType?: 'personal' | 'enterprise'): Array<{ value: number; label: string }> {
	// ä¸ªäººå°ç« ç±»å‹
	const personalTypes = [
		{ value: SealType.PERSONAL_SIGNATURE, label: 'ä¸ªäººç­¾å' },
		{ value: SealType.PERSONAL_SEAL, label: 'ä¸ªäººå°ç« ' }
	];
	
	// ä¼ä¸šå°ç« ç±»å‹
	const enterpriseTypes = [
		{ value: SealType.ENTERPRISE_OFFICIAL, label: 'å…¬ç« ' },
		{ value: SealType.ENTERPRISE_FINANCIAL, label: 'è´¢åŠ¡ä¸“ç”¨ç« ' },
		{ value: SealType.ENTERPRISE_CONTRACT, label: 'åˆåŒä¸“ç”¨ç« ' },
		{ value: SealType.ENTERPRISE_LEGAL, label: 'æ³•äººç« ' }
	];
	
	// æ ¹æ®æ‰€æœ‰è€…ç±»å‹è¿”å›å¯¹åº”çš„åˆ—è¡¨
	if (ownerType === 'personal') {
		return personalTypes;
	} else if (ownerType === 'enterprise') {
		return enterpriseTypes;
	}
	
	// é»˜è®¤è¿”å›æ‰€æœ‰ç±»å‹
	return [...personalTypes, ...enterpriseTypes];
}

// ==================== ç­¾ç½²ä»»åŠ¡ç›¸å…³ ====================

/**
 * ç­¾ç½²ä»»åŠ¡çŠ¶æ€æšä¸¾
 */
export enum SignTaskStatus {
	DRAFT = 0,        // è‰ç¨¿
	PENDING = 1,      // å¾…ç­¾ç½²
	SIGNING = 2,      // ç­¾ç½²ä¸­
	COMPLETED = 3,    // å·²å®Œæˆ
	REJECTED = 4,     // å·²æ‹’ç»
	EXPIRED = 5       // å·²è¿‡æœŸ
}

/**
 * ç­¾ç½²ä»»åŠ¡ä¿¡æ¯
 */
export interface SignTask {
	id?: string;
    name: string;
	fileUrl: string;
	status?: SignTaskStatus;
	createTime?: string;
	expireTime?: string;
	signUserCount?: number;
	signedUserCount?: number;
}

/**
 * ç­¾ç½²ä»»åŠ¡åˆ—è¡¨å“åº”
 */
export interface SignTaskListResponse {
	total: number;
	list: SignTask[];
	pageSize: number;
	pageNo: number;
}

/**
 * è·å–ç­¾ç½²ä»»åŠ¡åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰
 */
export function getSignTaskPage(params: PageParams): Promise<SignTaskListResponse> {
	return get<SignTaskListResponse>(`/api/v1/seal/sign-task/page`, params);
}

/**
 * è·å–ç­¾ç½²ä»»åŠ¡è¯¦æƒ…
 */
export function getSignTask(id: string): Promise<SignTask> {
	return get<SignTask>(`/api/v1/seal/sign-task/get`, { id });
}

/**
 * è·å–ç­¾ç½²ä»»åŠ¡ç»Ÿè®¡
 */
export interface SignTaskStatistics {
	draftCount: number;      // è‰ç¨¿æ•°
	signingCount: number;    // ç­¾ç½²ä¸­
	completedCount: number;  // å·²å®Œæˆ
	cancelledCount: number;  // å·²æ’¤é”€
	rejectedCount: number;   // å·²æ‹’ç­¾
	expiredCount: number;    // å·²è¿‡æœŸ
}

export function getSignTaskStatistics(): Promise<SignTaskStatistics> {
	return get<SignTaskStatistics>(`/api/v1/seal/sign-task/statistics`);
}

/**
 * åˆ›å»ºç­¾ç½²ä»»åŠ¡
 * @param data.name - ä»»åŠ¡åç§°
 * @param data.fileUrl - æ–‡ä»¶URLï¼ˆéœ€å…ˆè°ƒç”¨æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼‰
 * @param data.expireTime - è¿‡æœŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰
 */
export function createSignTask(data: {
    name: string;
	fileUrl: string;
	expireTime?: string;
}): Promise<SignTask> {
	return post<SignTask>(`/api/v1/seal/sign-task/create`, data);
}

/**
 * æ’¤é”€ç­¾ç½²ä»»åŠ¡
 * æ³¨æ„ï¼šDELETE è¯·æ±‚çš„å‚æ•°åº”è¯¥åœ¨ URL ä¸­ï¼Œä¸æ˜¯ request body
 */
export function cancelSignTask(id: string): Promise<void> {
	// âœ… ä¿®å¤ï¼šå°† id ä½œä¸º query parameter æ‹¼æ¥åˆ° URL ä¸­
	return del<void>(`/api/v1/seal/sign-task/cancel?id=${id}`);
}

/**
 * åˆ é™¤ç­¾ç½²ä»»åŠ¡
 * æ³¨æ„ï¼šDELETE è¯·æ±‚çš„å‚æ•°åº”è¯¥åœ¨ URL ä¸­ï¼Œä¸æ˜¯ request body
 */
export function deleteSignTask(id: string): Promise<void> {
	// âœ… ä¿®å¤ï¼šå°† id ä½œä¸º query parameter æ‹¼æ¥åˆ° URL ä¸­
	return del<void>(`/api/v1/seal/sign-task/delete?id=${id}`);
}

/**
 * è·å–H5å°ç« ç»Ÿä¸€åº”ç”¨URL
 * 
 * ç»Ÿä¸€çš„H5å°ç« åº”ç”¨ï¼Œæ ¹æ®modeå‚æ•°æ”¯æŒä¸åŒåŠŸèƒ½ã€‚
 * 
 * ç§»åŠ¨ç«¯æ¶æ„ï¼ˆç‹¬ç«‹é¡µé¢ï¼‰ï¼š
 * - pages/contract-create/h5-create.uvue â†’ mode=createï¼ˆåˆ›å»ºåˆåŒï¼‰
 * - pages/contract-sign/h5-sign.uvue â†’ mode=signï¼ˆç­¾ç½²åˆåŒï¼‰
 * - pages/contract-view/h5-view.uvue â†’ mode=viewï¼ˆé¢„è§ˆåˆåŒï¼‰
 * - pages/contract-form/h5-fill.uvue â†’ mode=formï¼ˆå¡«å†™è¡¨å•ï¼‰
 * 
 * åå°ç®¡ç†æ¶æ„ï¼ˆç»Ÿä¸€ç»„ä»¶ï¼‰ï¼š
 * - CreateContractH5.vue â†’ mode=create
 * - SignDocumentH5.vue â†’ mode=sign
 * - ViewDocumentH5.vue â†’ mode=view
 * - FormFillH5.vue â†’ mode=form
 * 
 * @param mode - åŠŸèƒ½æ¨¡å¼
 * @param taskId - ä»»åŠ¡IDï¼ˆåˆ›å»ºæ¨¡å¼ä¸éœ€è¦ï¼‰
 * @param options - é€‰é¡¹
 * @returns é¡µé¢å®Œæ•´URL
 */
/**
 * ç”Ÿæˆ Seal-Tokenï¼ˆç»Ÿä¸€æ¥å£ï¼‰
 * ç§»åŠ¨ç«¯ä½¿ç”¨æ ‡å‡† Authorization Token æ¢å– Seal-Token
 * ä¼ä¸šIDé€šè¿‡TokenåŠ å¯†ä¼ é€’ï¼Œè€ŒéURLæ˜æ–‡å‚æ•°
 * 
 * ğŸ†• ç»Ÿä¸€æ¥å£ï¼š/api/v1/seal/auth/exchange-token
 * å…¼å®¹ç§»åŠ¨ç«¯å’ŒPCç«¯ï¼Œåç«¯æ ¹æ®è¯·æ±‚æ¥æºè‡ªåŠ¨è¯†åˆ«ç”¨æˆ·
 * 
 * @param options å¯é€‰å‚æ•°
 * @param options.expireMinutes Token æœ‰æ•ˆæœŸï¼ˆåˆ†é’Ÿï¼‰ï¼Œé»˜è®¤ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„å€¼ï¼ˆ30å¤©ï¼‰
 * @param options.enterpriseId ä¼ä¸šIDï¼ˆå¯é€‰ï¼ŒåŠ å¯†åˆ°Tokenä¸­ï¼‰
 * @returns Promise<Seal-Token>
 */
export async function generateSealToken(options?: { 
	expireMinutes?: number, 
	enterpriseId?: number
}): Promise<string> {
	try {
		// ğŸ†• ä½¿ç”¨ç»Ÿä¸€é…ç½®ï¼ˆé™æ€å¯¼å…¥ï¼Œå…¼å®¹å°ç¨‹åºç¯å¢ƒï¼‰
		const config = getSealTokenConfig('mobile');
		const finalExpireMinutes = options?.expireMinutes || config.expireMinutes;
		
		// ä¼ä¸šIDåŠ å¯†åˆ°Tokenä¸­ï¼ˆå®‰å…¨å¢å¼ºï¼‰
		if (options?.enterpriseId) {
			console.log(`${LOG_PREFIX} ğŸ¢ ä¼ é€’ä¼ä¸šIDåˆ°Token:`, options.enterpriseId);
		}
		
		console.log(`${LOG_PREFIX} ç§»åŠ¨ç«¯å…‘æ¢ Seal-Token, expireMinutes: ${finalExpireMinutes}, platform: ${config.platform}`);
	
	// ğŸ†• ä½¿ç”¨ç»Ÿä¸€æ¥å£ï¼ˆå…¼å®¹æ—§æ¥å£å’Œæ–°æ¥å£ï¼‰
	const response = await post<any>('/api/v1/seal/auth/exchange-token', {
		enterpriseId: options?.enterpriseId,
		expireMinutes: finalExpireMinutes
	});
	
	// ğŸ”§ è°ƒè¯•æ—¥å¿—ï¼šæ‰“å°åç«¯è¿”å›çš„åŸå§‹æ•°æ®
	console.log(`${LOG_PREFIX} ğŸ“¦ åç«¯è¿”å›æ•°æ®ç±»å‹:`, typeof response);
	console.log(`${LOG_PREFIX} ğŸ“¦ åç«¯è¿”å›æ•°æ®å†…å®¹:`, JSON.stringify(response));
	
	// ğŸ”§ å…¼å®¹ä¸¤ç§è¿”å›æ ¼å¼ï¼š
	// 1. ç›´æ¥è¿”å› token å­—ç¬¦ä¸²ï¼šresponse = "eyJhbGc..."
	// 2. è¿”å›å¯¹è±¡ï¼šresponse = { token: "eyJhbGc..." }
	let token: string;
	if (typeof response === 'string') {
		token = response;
		console.log(`${LOG_PREFIX} âœ… åç«¯ç›´æ¥è¿”å› token å­—ç¬¦ä¸²`);
	} else if (response && typeof response === 'object' && response.token) {
		token = response.token;
		console.log(`${LOG_PREFIX} âœ… åç«¯è¿”å› { token: string } å¯¹è±¡`);
	} else {
		console.error(`${LOG_PREFIX} âŒ æ— æ³•ä»åç«¯å“åº”ä¸­æå– token:`, response);
		throw new Error('åç«¯è¿”å›æ•°æ®æ ¼å¼é”™è¯¯ï¼šæ— æ³•æå– token');
	}
	
	console.log(`${LOG_PREFIX} âœ… Seal-Token ç”ŸæˆæˆåŠŸ, token å‰20ä½:`, token.substring(0, 20) + '...');
	return token;
	} catch (error) {
		console.error('[Seal API] âŒ ç”Ÿæˆ Seal-Token å¤±è´¥:', error);
		throw error;
	}
}

export async function getSealPageUrl(
	mode: 'create' | 'create-file' | 'create-image' | 'sign' | 'view' | 'form' | 'seal-create' | 'template-preview',
	taskId?: string,
	options?: { token?: string, enterpriseId?: number, enterpriseName?: string, templateId?: number, type?: string, draftId?: string, pdfUrl?: string, name?: string }
): Promise<string> {
	// ğŸ†• è·å–ç»Ÿä¸€é…ç½®ï¼ˆé™æ€å¯¼å…¥ï¼Œå…¼å®¹å°ç¨‹åºç¯å¢ƒï¼‰
	const config = getSealTokenConfig('mobile');
	
	// ç”Ÿæˆ Seal-Tokenï¼ˆå®‰å…¨å¢å¼ºï¼šenterpriseId åŠ å¯†åˆ° Token ä¸­ï¼Œè€Œé URL æ˜æ–‡ä¼ é€’ï¼‰
	const sealToken = options?.token || await generateSealToken({
		enterpriseId: options?.enterpriseId  // âœ… ä¼ä¸šIDåŠ å¯†åˆ°Tokenä¸­
	});
	
	// æ ¹æ® mode æ˜ å°„åˆ° seal-core çš„è·¯ç”±è·¯å¾„ï¼ˆç‹¬ç«‹è·¯ç”±è®¾è®¡ï¼‰
	let path = '';
	switch (mode) {
		case 'create': path = '/h5/sign/create'; break;           // æ¨¡æ¿åˆ›å»º
		case 'create-file': path = '/h5/sign/create-file'; break; // ğŸ†• æ–‡ä»¶åˆ›å»º
		case 'create-image': path = '/h5/sign/create-image'; break; // ğŸ†• å›¾ç‰‡åˆ›å»º
		case 'sign': path = '/h5/sign/document'; break;
		case 'view': path = '/h5/preview/contract'; break;
		case 'form': path = '/h5/sign/form'; break;
		case 'seal-create': path = '/h5/seal/create'; break;
		case 'template-preview': path = '/h5/template/preview'; break;
		default: path = '/h5/sign/create';
	}
	
	// ğŸ†• æ„å»ºURLï¼Œä½¿ç”¨ç»Ÿä¸€é…ç½®çš„å¹³å°æ ‡è¯†
	// âš ï¸ å®‰å…¨å¢å¼ºï¼šenterpriseId ä¸å†é€šè¿‡ URL æ˜æ–‡ä¼ é€’ï¼Œè€Œæ˜¯åŠ å¯†åœ¨ Token ä¸­
	let url = `${SEAL_CORE_H5_URL}${path}?token=${encodeURIComponent(sealToken)}&platform=${config.platform}`;
	
	// å¦‚æœæœ‰taskIdï¼Œæ·»åŠ åˆ°URL
	if (taskId) {
		url += `&taskId=${taskId}`;
	}
	
	// ğŸ”§ ä¸´æ—¶æ–¹æ¡ˆï¼šåŒæ—¶é€šè¿‡URLä¼ é€’enterpriseIdï¼ˆç›´åˆ°Tokenç”Ÿæˆé€»è¾‘å®Œå…¨ä¿®å¤ï¼‰
	// TODO: æœªæ¥ç§»é™¤æ­¤URLå‚æ•°ï¼Œå®Œå…¨ä¾èµ–Tokenä¸­çš„enterprise_id
	if (options?.enterpriseId) {
		url += `&enterpriseId=${options.enterpriseId}`;
	}
	
	// ğŸ†• å¦‚æœæœ‰enterpriseNameï¼Œæ·»åŠ åˆ°URLï¼ˆç”¨äºå°ç« åˆ›å»ºæ—¶è‡ªåŠ¨å¡«å……ï¼‰
	// ä¼ä¸šåç§°ä¸æ˜¯æ•æ„Ÿä¿¡æ¯ï¼Œå¯ä»¥æ˜æ–‡ä¼ é€’
	if (options?.enterpriseName) {
		url += `&enterpriseName=${encodeURIComponent(options.enterpriseName)}`;
	}
	
	// ğŸ†• å¦‚æœæœ‰templateIdï¼Œæ·»åŠ åˆ°URLï¼ˆç”¨äºæ¨¡ç‰ˆé¢„è§ˆæ¨¡å¼ï¼‰
	if (options?.templateId) {
		url += `&templateId=${options.templateId}`;
	}
	
	// å¦‚æœæœ‰typeï¼Œæ·»åŠ åˆ°URLï¼ˆåˆ›å»ºç±»å‹ï¼štemplate/file/imageï¼‰
	if (options?.type) {
		url += `&type=${encodeURIComponent(options.type)}`;
	}
	
	// å¦‚æœæœ‰draftIdï¼Œæ·»åŠ åˆ°URLï¼ˆç»§ç»­ç¼–è¾‘è‰ç¨¿ï¼‰
	if (options?.draftId) {
		url += `&draftId=${options.draftId}`;
	}
	
	// å¦‚æœæœ‰pdfUrlï¼Œæ·»åŠ åˆ°URLï¼ˆAIèµ·è‰åŠŸèƒ½ä½¿ç”¨ï¼Œè·³è¿‡æ–‡ä»¶ä¸Šä¼ æ­¥éª¤ï¼‰
	if (options?.pdfUrl) {
		url += `&pdfUrl=${encodeURIComponent(options.pdfUrl)}`;
	}
	
	// å¦‚æœæœ‰nameï¼Œæ·»åŠ åˆ°URLï¼ˆåˆåŒåç§°ï¼ŒAIèµ·è‰åŠŸèƒ½ä½¿ç”¨ï¼‰
	if (options?.name) {
		url += `&name=${encodeURIComponent(options.name)}`;
	}
	
	console.log(`${LOG_PREFIX} ğŸ¯ Seal Core H5é¡µé¢URL:`, url);
	console.log(`${LOG_PREFIX} ğŸ”’ enterpriseId å·²åŠ å¯†åˆ° Token ä¸­:`, options?.enterpriseId || 'null');
	return url;
}

/**
 * è·å–H5ç­¾ç½²/é¢„è§ˆé¡µé¢URLï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰
 * @deprecated å»ºè®®ä½¿ç”¨ getSealPageUrl ä»£æ›¿
 */
export async function getSignPageUrl(
	taskId: string, 
	options?: { mode?: string; token?: string }
): Promise<string> {
	const mode = options?.mode === 'view' ? 'view' : 'sign';
	return await getSealPageUrl(mode as 'sign' | 'view', taskId, { token: options?.token });
}

/**
 * è·å–H5åˆ›å»ºåˆåŒé¡µé¢URLï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰
 * @deprecated å»ºè®®ä½¿ç”¨ getSealPageUrl('create') ä»£æ›¿
 */
export async function getCreatePageUrl(options?: { token?: string }): Promise<string> {
	return await getSealPageUrl('create', undefined, { token: options?.token });
}

/**
 * æäº¤ç­¾ç½²ç»“æœ
 * @param data.taskId - ä»»åŠ¡ID
 * @param data.signedFileUrl - ç­¾ç½²åçš„æ–‡ä»¶URL
 */
export function submitSignResult(data: {
	taskId: string;
	signedFileUrl: string;
}): Promise<void> {
	return post<void>(`/api/v1/seal/seal/sign-task/submit-result`, data);
}

/**
 * è·å–ç­¾ç½²ä»»åŠ¡çŠ¶æ€åç§°
 */
export function getSignTaskStatusName(status: SignTaskStatus): string {
	const statusMap: Record<number, string> = {
		[SignTaskStatus.DRAFT]: 'è‰ç¨¿',
		[SignTaskStatus.PENDING]: 'å¾…ç­¾ç½²',
		[SignTaskStatus.SIGNING]: 'ç­¾ç½²ä¸­',
		[SignTaskStatus.COMPLETED]: 'å·²å®Œæˆ',
		[SignTaskStatus.REJECTED]: 'å·²æ‹’ç»',
		[SignTaskStatus.EXPIRED]: 'å·²è¿‡æœŸ'
	};
	return statusMap[status] || 'æœªçŸ¥';
}

/**
 * è·å–ç­¾ç½²ä»»åŠ¡çŠ¶æ€æ ·å¼ç±»å
 */
export function getSignTaskStatusClass(status: SignTaskStatus): string {
	const classMap: Record<number, string> = {
		[SignTaskStatus.DRAFT]: 'status-draft',
		[SignTaskStatus.PENDING]: 'status-pending',
		[SignTaskStatus.SIGNING]: 'status-signing',
		[SignTaskStatus.COMPLETED]: 'status-completed',
		[SignTaskStatus.REJECTED]: 'status-rejected',
		[SignTaskStatus.EXPIRED]: 'status-expired'
	};
	return classMap[status] || 'status-unknown';
}

// ==================== Token ç®¡ç†å·¥å…· ====================
// ğŸ†• ç»Ÿä¸€ä½¿ç”¨ /utils/sealTokenManager.uts ç®¡ç† Seal Token
// å‚è€ƒ PC ç«¯ SealTokenManager å®ç°ï¼šç¼“å­˜ã€æœ‰æ•ˆæœŸæ£€æŸ¥ã€è‡ªåŠ¨åˆ·æ–°
// 
// ä½¿ç”¨æ–¹å¼ï¼š
// import { getSealToken, clearSealToken } from '@/utils/sealTokenManager'
// await getSealToken() // è·å–æœ‰æ•ˆçš„ tokenï¼ˆè‡ªåŠ¨æ£€æŸ¥è¿‡æœŸã€è‡ªåŠ¨åˆ·æ–°ï¼‰
